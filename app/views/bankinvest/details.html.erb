<%= stylesheet_link_tag "bankinvest.css" %>
<%= javascript_include_tag "highcharts.js" %>

<div class="main-content details">
  <div style="width: 80%;">
        <a href="/">首页</a>
    <br><br>
  <% if @banfinance.trustee =="北京银行" %>
        <a class="btn btn-primary pull-left" href="/sales/index?bid=<%= @banfinance.id%>&favourable=1">预订</a>
  <% else %>
        <a class="btn btn-primary pull-left" href="/sales/index?bid=<%= @banfinance.id%>">预订</a>
  <% end %>
    <br><br><br>
  <div id="rate">
  <h1>收益率介绍</h1>
  <br><br>
      <div id="container" style="width: 100%; height: 400px; "></div>
  <br><br>
      <h1>购买流程</h1>
      <img src="/assets/procedure.png">
      <br><br>
  </div>
    <h1>产品介绍</h1>
  <table class="table table-striped table-bordered">
    <% if @bankproducts %>
        <tr>
          <td class="left">投资币种</td>
          <td class="right"><%= @bankproducts.currencytype%></td>
        </tr>
        <tr>
          <td class="left">收益类型</td>
          <td class="right"><%= @bankproducts.btype%></td>
        </tr>
        <tr>
          <td class="left">是否保本</td>
          <td class="right"><%= @bankproducts.risk%></td>
        </tr>
        <tr>
          <td class="left">投资标的</td>
          <td class="right"><%= @bankproducts.invsetsubject%></td>
        </tr>
        <tr>
          <td class="left">投资方向说明</td>
          <td class="right"><%= @bankproducts.investdirection%></td>
        </tr>
        <tr>
          <td class="left">收益计算方法</td>
          <td class="right"><%= @bankproducts.formula%></td>
        </tr>
        <tr>
          <td class="left">风险提示</td>
          <td class="right"><%= @bankproducts.risktip%></td>
        </tr>
        <tr>
          <td class="left">产品关键字</td>
          <td class="right"><%= @bankproducts.productkeywords%></td>
        </tr>
        <tr>
          <td class="left">其他</td>
          <td class="right"></td>
        </tr>
    <% end %>
    <% if @banfinance.isorgan==true %>
        <tr>
          <td class="left">发行机构</td>
          <td class="right"><%= @banfinance.trustee%></td>
        </tr>
        <tr>
          <td class="left">是否保本</td>
          <td class="right"><%= @banfinance.btype%></td>
        </tr>
        <tr>
          <td class="left">投资标的</td>
          <td class="right"><%= @banfinance.invsetsubject%></td>
        </tr>
        <tr>
          <td class="left">收益计算方法</td>
          <td class="right"><%= @banfinance.formula%></td>
        </tr>
        <tr>
          <td class="left">风险提示</td>
          <td class="right"><%= @banfinance.risktip%></td>
        </tr>
        <tr>
          <td class="left">产品关键字</td>
          <td class="right"><%= @banfinance.productkeywords%></td>
        </tr>
    <% end %>
  </table>
</div>
</div>

<script type="text/javascript">

    window.onload=function(){
        if(Request('rate')!=1){
            $("#rate").remove();
        }
    }

    $(function () {
        var chart;
        $(document).ready(function() {
            var options ={
                chart: {
                    renderTo: 'container',
                    type: 'column'
                },
                title: {
                    text: false
                },
                xAxis: {
                    categories: [ '><%= format("%0.0f",@banfinance.rate1) %>万', '><%= format("%0.0f",@banfinance.rate2) %>万', '><%= format("%0.0f",@banfinance.rate3) %>万']
                },
                yAxis : {
                    title : {
                        text: '收益率 ( % )'
                    },
                    min: 4,
                    plotLines : [{
                        value : 0,
                        width : 1,
                        color : '#808080'
                    } ]
                },
                tooltip: {
                    formatter: function() {
                        if(this.series.name=='通天顺标准'){
                            return '<b>'+ this.x +'</b><br/>'+
                                    this.series.name +': '+ this.point.stackTotal+'%';
                        }
                        else{
                            return '<b>'+ this.x +'</b><br/>'+
                                    this.series.name +': '+ this.y +'%';
                        }
                    }
                },
                plotOptions: {
                    column: {
                        stacking: 'normal',
                        dataLabels: {
                            enabled: false,
                            color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'white'
                        }
                    }
                },
                series: [],
                credits: {
                    enabled: false
                }
            }
            options.series = new Array();
            var i;
            for(i=0;i<2;i++)
            {
                options.series[i] = new Object();
                if(i==0){
                    options.series[i].name = '通天顺标准';
                    options.series[i].data = new Array(<%= @banfinance.tong10-@banfinance.bank10 %>,<%= @banfinance.tong100-@banfinance.bank100 %>,<%= @banfinance.tong500-@banfinance.bank500 %>);
                }
                else{
                    options.series[i].name = '银行标准';
                    options.series[i].data = new Array(<%= @banfinance.bank10 %>,<%= @banfinance.bank100 %>,<%= @banfinance.bank500 %>);
                }
            }
            chart = new Highcharts.Chart(options);
        });
    });

    function Request(sName)
    {
        var sURL = new String(window.location);
        var sURL = document.location.href;
        sURL=decodeURI(sURL);
        var iQMark= sURL.lastIndexOf('?');
        var iLensName=sName.length;
        //retrieve loc. of sName
        var iStart = sURL.indexOf('?' + sName +'=') //limitation 1
        if (iStart==-1)
        {//not found at start
            iStart = sURL.indexOf('&' + sName +'=')//limitation 1
            if (iStart==-1)
            {//not found at end
                return 0; //not found
            }
        }

        iStart = iStart + + iLensName + 2;
        var iTemp= sURL.indexOf('&',iStart); //next pair start
        if (iTemp ==-1)
        {//EOF
            iTemp=sURL.length;
        }
        return sURL.slice(iStart,iTemp ) ;
        sURL=null;//destroy String
    }
</script>