<%= javascript_include_tag "jquery.dataTables.min.js" %>
<%= stylesheet_link_tag "datatables.css" %>
<%= stylesheet_link_tag "bankinvest.css" %>

<div class="main-contents">
  <table>
    <tr>
      <td class="left">
        <div class="main-inputs">
          <div id="inputs" class="content2">
            <div class="padded">
              <h1>关于银行理财产品</h1>
              <p>这里的银行理财产品是由银行自行设计并发行，而不是作为销售渠道，和信托、基金、保险等金融机构合作的产品。
                <span>这种类型的产品风险极低。</span></p>
            </div>
            <div class="overlay">
              <p class="group">银行</p>
              <input class="input-medium" type="text" name="bcolumn" readOnly="true" value="<%= cookies[:bcolumn] %>">
              <p class="group">投入资金</p>
              <input class="input-medium" type="text" name="amount" readOnly="true" value="<%= cookies[:amount] %>">
              <p class="group">投资期限</p>
              <input class="input-medium" type="text" name="deadline" readOnly="true" value="<%= cookies[:deadline] %>">
              <p class="group">风险性</p>
              <input class="input-medium" type="text" name="risk" readOnly="true" value="<%= cookies[:optionsRadios] %>">
            </div>
          </div>
        </div>
      </td>
      <td>
        <div class="main-body">
          <a href="/">首页</a>
          <h2>欢迎</h2>
          <p>我们将根据您输入的实际情况来分析觉得如下几种银行理财产品可能会适合您。<br>
            请您再做仔细筛选：</p>
          <table cellpadding="0" cellspacing="0" border="0" class="display" name="bankfinance" id="bankfinance"  style="text-align:center;">
            <thead><tr>
              <th>发行银行</th><th>产品名称</th><th>投资期限</th><th>起售价</th><th>当天买的年化收益率</th><th>产品类型</th><th>是否开放</th><th>计算收益金额</th><th>操作</th>
            </tr></thead>

            <% @bankfinances.each do |b| %>
                <tr>
                  <td><%= b.trustee%></td>
                  <td><p class="ctl" title="<%= b.bname%>"><%= b.bname%></p></td>
                  <td><%= format("%0.0f",b.investperiod)%>天</td>
                  <td><%= format("%0.0f",b.startvalue/10000)%>万</td>
                  <td><%= format("%0.1f",b.returnrate*100)%>%</td>
                  <td><%= b.btype%></td>
                  <td><%= b.ispatent%></td>
                  <td><a href="#login-box" class='login-window'title="<%= b.returnrate%>|<%= b.investperiod%>"><img src="/assets/calculator.jpg"></a></td>
                  <td>查看详情</td>
                </tr>
            <% end %>
          </table>
          <br><br>
        </div>
      </td>
    </tr>
  </table>
</div>

<script>
    $.fn.dataTableExt.afnFiltering.push(
            function( oSettings, aData, iDataIndex ) {
                var flag1,flag2,flag3,flag4;
                var bcolumn= "<%= cookies[:bcolumn] %>";
                var deadline= "<%= cookies[:deadline] %>";
                var amount= "<%= cookies[:amount] %>";
                var optionsRadios= "<%= cookies[:optionsRadios] %>";

                if(bcolumn==aData[0]){
                    flag1=1;
                }

                aData[2] =aData[2].replace(/天/, "");
                if(deadline=="短期投资 (1个月内)"&&aData[6]=="true"){
                    flag2=1;
                }
                else if(deadline=="中期投资 (3个月内)"&&aData[2]<=95&&aData[6]=="false"){
                    flag2=1;
                }
                else if(deadline=="长期投资 (3个月以上)"&&aData[2]>95&&aData[6]=="false"){
                    flag2=1;
                }

                aData[3] =aData[3].replace(/万/, "");
                if(amount=="5万-10万"&&aData[3]>=5&&aData[3]<=10){
                    flag3=1;
                }
                else if(amount=="10万-20万"&&aData[3]>10&&aData[3]<=20){
                    flag3=1;
                }
                else if(amount=="20万-50万"&&aData[3]>20&&aData[3]<=50){
                    flag3=1;
                }
                else if(amount=="50万以上"&&aData[3]>50){
                    flag3=1;
                }

                if(optionsRadios=="绝对不能亏损本金"&&aData[5]=="保本"){
                    flag4=1;
                }
                else if(optionsRadios=="可以承担本金亏损"){
                    flag4=1;
                }

                if(flag1==1&&flag2==1&&flag3==1&&flag4==1){
                    return true;
                }

            }
    );
    $(document).ready(function(){
        /* Initialise datatables */
        var oTable = $('#bankfinance').dataTable({
            "iDisplayLength": 50
        });

        $("#returnrate,#bank,#period,#optionsRadios").click( function() { oTable.fnDraw(); } );

    });
</script>