<%= javascript_include_tag :defaults %>
<%= javascript_include_tag "prototype.js" %>

<!-- <META HTTP-EQUIV="Refresh" content="10"> -->
<script language="Javascript">
     function loadXML(xmlString){
         var xmlDoc=null;
         if(!window.DOMParser && window.ActiveXObject){
             var xmlDomVersions = ['MSXML.2.DOMDocument.6.0','MSXML.2.DOMDocument.3.0','Microsoft.XMLDOM'];
             for(var i=0;i<xmlDomVersions.length;i++){
                 try{
                     xmlDoc = new ActiveXObject(xmlDomVersions[i]);
                     xmlDoc.async = false;
                     xmlDoc.loadXML(xmlString);
                     break;
                 }catch(e){
	}
             }
         }
         else if(window.DOMParser && document.implementation && document.implementation.createDocument){
             try{
                 domParser = new  DOMParser();
                 xmlDoc = domParser.parseFromString(xmlString, 'text/xml');
             }catch(e){
             }
         }
         else{
             return null;
         }
         return xmlDoc;
     }


    function createxmlhttp()
     {
          xmlhttpobj = false;
          try{
			  xmlhttpobj=new ActiveXObject();
          }catch(e){
              try{
                  xmlhttpobj=new ActiveXObject("MSXML2.XMLHTTP");
              }catch(e2){
                  try{
                      xmlhttpobj=new ActiveXObject("Microsoft.XMLHTTP");
                      }catch(e3){
                      xmlhttpobj = false;
                  }
              }
          }
		  if((!xmlhttpobj)&&(window.XMLHttpRequest))
		  {
			 xmlhttpobj=new XMLHttpRequest();
		  }
		  
          return xmlhttpobj;
     }

     function getAjax()
     {
         var xmlhttpobj = createxmlhttp();
         if(xmlhttpobj){
             url = document.location.href.substring(0,document.location.href.indexOf(window.document.location.pathname))+"/assets/CSpreadCostStrRunOnTime.xml";
			 xmlhttpobj.open("get",url,true);
			 xmlhttpobj.setRequestHeader("Cache-Control","no-cache");
			 xmlhttpobj.setRequestHeader("If-Modified-Since","0");
			 xmlhttpobj.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8");  
             xmlhttpobj.send(null);
             xmlhttpobj.onreadystatechange=function(){
                 if(xmlhttpobj.readyState==4){
                     if(xmlhttpobj.status==200){
                         var htmlxxx = xmlhttpobj.responseText;
                         var xmldoc=loadXML(htmlxxx);
						 if(xmldoc!=null){
                         var elements = xmldoc.getElementsByTagName("pair");
                         var tbstr = '<table class="rttableformat">';
                         var tbttl = '<tr><th>合约号</th><th>近月合约价格</th><th>远月合约价格</th><th>最新价差</th><th>持仓成本</th><th>年化收益率</th><th>更新时间</th></tr>';
                         tbstr +=  tbttl;
                         for (var i = 0; i < elements.length; i++) {
                             tbstr+="<tr>";
                             tbstr+= "<td>"
                                 + elements[i].getElementsByTagName("name")[0].firstChild.nodeValue + "</td>";
								if((elements[i].getElementsByTagName("firstprice")[0].firstChild.nodeValue>0)
									&&(elements[i].getElementsByTagName("secondprice")[0].firstChild.nodeValue>0)){
                             tbstr+= "<td>"
                                 + elements[i].getElementsByTagName("firstprice")[0].firstChild.nodeValue + "</td>";
                             tbstr+= "<td>"
                                 + elements[i].getElementsByTagName("secondprice")[0].firstChild.nodeValue + "</td>";
                             tbstr+= "<td>"
                                 + elements[i].getElementsByTagName("diffprice")[0].firstChild.nodeValue + "</td>";
                             tbstr+= "<td>"
										 + parseFloat(elements[i].getElementsByTagName("computearbfee")[0].firstChild.nodeValue).toFixed(1) + "</td>";
                             tbstr+= "<td>"
										 + (elements[i].getElementsByTagName("computerateofreturn")[0].firstChild.nodeValue*100).toFixed(1) + "% </td>";
								}
								else{
									 tbstr+= "<td> -- </td>";
									 tbstr+= "<td> -- </td>";
									 tbstr+= "<td> -- </td>";
									 tbstr+= "<td> -- </td>";
									 tbstr+= "<td> -- </td>";							    
								}
                             tbstr+= "<td>"
                                 + elements[i].getElementsByTagName("time")[0].firstChild.nodeValue + "</td>";
                             tbstr+="</tr>";
                        }
                        tbstr+='</table>\n';
                        document.getElementById("rtpricetable").innerHTML=tbstr;
                     }
                 }
             }
         }
     }
     }

	function refreshMKData()
	{
		var now= new Date();
		if ((now.getHours()<15)&&(now.getHours()>=9))
		{
		   getAjax();
		}	 	
	}

	getAjax();
    var a = new PeriodicalExecuter(refreshMKData,2.0);
</script>

<div class="slider2">
<div class="slice12">
  <h2>策略性能</h2>
</div>
</div>
<div class="clr"></div>
<div class="body">
  <div class="body_resize">
  <div class="StrategyNews">
  <h2>策略分类</h2>
  <ul>
    <li><%= link_to "无风险套利",:controller =>"strategy",:action =>"show",:id =>"1" %></li>
  </ul>
<p></p>
  </div>

<div class="frame">


<% if(params[:id]=="1") %>
     <div class="ironbars">
        <div class= irontxt>
        <p> <%= @strategyweb.name %></p>
        </div>

      </div>

	<div id="rtpricetable">
	</div>
<% end %>


</div>

<div class="clr"></div>
  </div>
<div class="clr"></div>
</div>
