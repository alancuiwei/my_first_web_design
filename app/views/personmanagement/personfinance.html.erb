<%= stylesheet_link_tag "personmanagement.css" %>
<%= javascript_include_tag "jquery.poshytip.js" %>
<%= stylesheet_link_tag "tip-yellowsimple.css" %>

<div class="main-content">
  <% if session[:webusername]!=nil && @personalfinance%>
  <h1><%= @personalfinance.username%>的投资页面</h1>
      <h2>个人信息：</h2>
          <table class="table table-striped table-bordered">
            <thead><tr>
              <th>用户名</th><th>年龄</th><th>公司</th><th>职务</th><th>流动总资金</th><th>操作</th>
            </tr></thead>
            <tr>
              <td><%= @personalfinance.username%></td>
              <td><%= format("%0.0f",@personalfinance.age)%></td>
              <td><%= @personalfinance.company%></td>
              <td><%= @personalfinance.post%></td>
              <td><strong  style="color: #ff0000;"><%= format("%0.0f",@personalfinance.investamount)%></strong></td>
              <td><a href="/personmanagement/personinfo/1">修改</a></td>
            </tr>
          </table>
      <br>
      <table id="deploy">
        <tr>
          <td class="col1"><h2>资产配置：</h2></td>
          <td class="col"><p style="width: 50px;height: 25px;background-color: #ff0000;"></p></td>
          <td class="col1">未购，等待您的推荐</td>
          <td class="col"><p style="width: 50px;height: 25px;background-color: #9ACD32;"></p></td>
          <td>已购，等待到期后再推荐</td>
          <td class="col1" style="text-align: center;"><a href="/personmanagement/personinformation/0">添加</a></td>
        </tr>
      </table>

      <table class="table table-striped table-bordered" id="info">
        <thead>
        <tr>
          <th>产品种类</th><th>百分比</th><th>可购金额</th>
          <th>状态</th>
          <th class="demo-tip-yellowsimple" title="已购产品 代表着已购产品的到期日期。<br>未购产品 代表着该产品目前等待专家推荐，一旦有合适的产品，应该在1周-2周内资金到账进行购买。">产品推荐日期</th>
          <th>操作</th>
        </tr></thead>

        <% @personalinfo.each do |b| %>
            <tr>
              <td><%= b.producttype%></td>
              <td><%= format("%0.1f",b.percentage*100)%>%</td>
              <td><%= format("%0.0f",b.percentage*@personalfinance.investamount) %></td>
              <% if b.purchasproducts=='未购'%>
                  <td style="background-color: #ff0000;"><%= b.purchasproducts%></td>
                  <td class="date"></td>
              <% else %>
                  <td style="background-color: #9ACD32;"><%= b.purchasproducts%></td>
                  <td><%= b.collectperiod%></td>
              <% end%>
              <td><a href="/personmanagement/personinformation/<%= b.id %>">修改</a></td>
            </tr>
        <% end %>
      </table>

      <h2>信托产品：</h2>
      <p class="text"><%= @personalfinance.contact%></p>

     <div id="favoriteedit">
      <h2>我最喜欢的产品：<button id="edit">修改</button></h2>
      <p class="text"><%= @personalfinance.myfavorite%></p>
      </div>
      <div id="favoritefix">
      <h2>我最喜欢的产品：<button id="fix">确定</button></h2>
      <textarea class="ckeditor" cols="80" rows="8" style="width:100%;" name="myfavorite" id="myfavorite" title="我最喜欢的产品"><%= @personalfinance.myfavorite%></textarea>
      </div>
  <% end %>
</div>

<script>
    window.onload=function(){
        today=new Date();
        var year = today.getFullYear();
        var month = today.getMonth()+1;
        var date = today.getDate();
        $("#favoriteedit").show();
        $("#favoritefix").hide();
        $(".date").html(year+'-'+month+'-'+date);
    }
    $("#edit").click(function(e){
        $("#favoritefix").show();
        $("#favoriteedit").hide();
    });

    $("#fix").click(function(e){
        $("#favoriteedit").show();
        $("#favoritefix").hide();
        $.post("/personmanagement/myfavoriteconfigajax",{ myfavorite:$("#myfavorite").attr("value")
        },function(data){
            if(data=="s1"){
                location.href='';
            }
        });
    });

    $(function(){
        $('.demo-tip-yellowsimple').poshytip({
            className: 'tip-yellowsimple',
            showTimeout: 1,
            alignTo: 'target',
            alignX: 'center',
            offsetY: 5,
            allowTipHover: false
        });
        var flickrFeedsCache = {};
        $('#demo-async-flickr > a').poshytip({
            className: 'tip-darkgray',
            bgImageFrameSize: 11,
            alignY: 'bottom',
            content: function(updateCallback) {
                var rel = $(this).attr('rel');
                if (flickrFeedsCache[rel] && flickrFeedsCache[rel].container)
                    return flickrFeedsCache[rel].container;
                if (!flickrFeedsCache[rel]) {
                    flickrFeedsCache[rel] = { container: null };
                    var tagsComma = rel.substring(4).replace('-', ',');
                    $.getJSON('http://api.flickr.com/services/feeds/photos_public.gne?tags=' + tagsComma + '&tagmode=all&format=json&jsoncallback=?',
                            function(data) {
                                var container = $('<div/>').addClass('flickr-thumbs');
                                $.each(data.items, function(i, item) {
                                    $('<a/>')
                                            .attr('href', item.link)
                                            .append($('<img/>').attr('src', item.media.m))
                                            .appendTo(container)
                                            .data('tip', '<strong>' + (item.title || '(no title)') + '</strong><br />by: ' + item.author.match(/\((.*)\)/)[1]);
                                    if (i == 4)
                                        return false;
                                });
                                // add tips for the images inside the main tip
                                container.find('a').poshytip({
                                    content: function(){return $(this).data('tip');},
                                    className: 'tip-yellowsimple',
                                    showTimeout: 100,
                                    alignTo: 'target',
                                    alignX: 'center',
                                    alignY: 'bottom',
                                    offsetY: 5,
                                    allowTipHover: false,
                                    hideAniDuration: 0
                                });
                                // call the updateCallback function to update the content in the main tooltip
                                // and also store the content in the cache
                                updateCallback(flickrFeedsCache[rel].container = container);
                            }
                    );
                }
                return 'Loading images...';
            }
        });
    });
</script>
