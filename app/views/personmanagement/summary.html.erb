<%= stylesheet_link_tag "common2.css" %>
<%= javascript_include_tag "base.js" %>
<%= stylesheet_link_tag "founder.css" %>
<%= stylesheet_link_tag "red.css" %>
<%= javascript_include_tag "jquery.icheck.js" %>
<script>
    function onReady(fn){onReady.fns.push(fn)}
    onReady.fns=[]
</script>

<%= javascript_include_tag "footable-0.1.js" %>
<script type="text/javascript">
    $(function() {
        $('table').footable();
    });
</script>

<div class="welcomes">
  <div class="ofa-funnel-pages">
    <div id="page-wrapper">
      <div id="top-tabs">
        <div class="top-tabs-content">
          <a href="/usersurvey/startup"><b>1.</b> <span>资产体检</span></a>
          <b>&nbsp;>&nbsp;</b>
          <a href="/home/questions"><b>2.</b> <span>风险评估</span></a>
          <b>&nbsp;>&nbsp;</b>
          <span><b>3.</b> 理财建议</span>
        </div>
      </div>
      <div id="page-content">
        <div class="clearfix"></div>
        <h1>
          <span id="title">理财产品 选择</span>
          <div id="q-numbers" style="right: 205px;"><b class="q-num curr"></b><b class="q-num"></b></div>
        </h1>

        <div id="questionnaire-view">
          <div id="questionnaire">
            <div class="question first" style="padding-right: 0;height: 660px;">
              <p class="q-text" id="risk2"></p>
              <table id="category" class="table table-striped table-bordered footable" style="width: 100%;">
                <thead>
                <tr>
                  <th data-sort-initial="descending" data-class="expand" style="width: 120px;">风险类型</th>
                  <th data-sort-ignore="true" style="width: 150px;">投资品种</th>
                  <th data-hide="phone" style="width: 173px;">亏损概率<br>（近一年）</th>
                  <th data-hide="phone" style="width: 173px;">最高年收益率<br>（近一年）</th>
                  <th data-hide="phone,tablet,hides">投资品种介绍</th>
                  <th data-sort-ignore="true" style="width: 40px;">选择</th>
                </tr>
                </thead>
                <% for i in 0..@category1.size-1 %>
                    <tr class="level1">
                      <td>安逸型</td>
                      <td><%= @category1[i].classify %></td>
                      <td><%= @category1[i].prisk %></td>
                      <td><%= @category1[i].returns %></td>
                      <td><%= @category1[i].ptype %></td>
                      <td><input type="radio" name="iCheck" id="iCheck1" class="<%= @category1[i].id %>,<%= @category1[i].classify %>"></td>
                    </tr>
                <% end %>
                <% for i in 0..@category2.size-1 %>
                    <tr class="level2">
                      <td>保守型</td>
                      <td><%= @category2[i].classify %></td>
                      <td><%= @category2[i].prisk %></td>
                      <td><%= @category2[i].returns %></td>
                      <td><%= @category2[i].ptype %></td>
                      <td><input type="radio" name="iCheck" id="iCheck2" class="<%= @category2[i].id %>,<%= @category2[i].classify %>"></td>
                    </tr>
                <% end %>
                <% for i in 0..@category3.size-1 %>
                    <tr class="level3">
                      <td>稳健型</td>
                      <td><%= @category3[i].classify %></td>
                      <td><%= @category3[i].prisk %></td>
                      <td><%= @category3[i].returns %></td>
                      <td><%= @category3[i].ptype %></td>
                      <td><input type="radio" name="iCheck" id="iCheck3" class="<%= @category3[i].id %>,<%= @category3[i].classify %>"></td>
                    </tr>
                <% end %>
                <% for i in 0..@category4.size-1 %>
                    <tr class="level4">
                      <td>积极型</td>
                      <td><%= @category4[i].classify %></td>
                      <td><%= @category4[i].prisk %></td>
                      <td><%= @category4[i].returns %></td>
                      <td><%= @category4[i].ptype %></td>
                      <td><input type="radio" name="iCheck" id="iCheck4" class="<%= @category4[i].id %>,<%= @category4[i].classify %>"></td>
                    </tr>
                <% end %>
                <% for i in 0..@category5.size-1 %>
                    <tr class="level5">
                      <td>激进型</td>
                      <td><%= @category5[i].classify %></td>
                      <td><%= @category5[i].prisk %></td>
                      <td><%= @category5[i].returns %></td>
                      <td><%= @category5[i].ptype %></td>
                      <td><input type="radio" name="iCheck" id="iCheck5" class="<%= @category5[i].id %>,<%= @category5[i].classify %>"></td>
                    </tr>
                <% end %>
              </table>
              <div id="finance" class="hide">
                <table id="select" class="table table-striped table-bordered footable" style="width: 100%;">
                  <thead>
                  <tr>
                    <th data-sort-initial="descending" data-class="expand" style="width: 120px;">投资品种</th>
                    <th data-sort-ignore="true" style="width: 150px;">理财产品</th>
                    <th data-sort-ignore="true" style="width: 85px;">近1年<br>收益率</th>
                    <th data-sort-ignore="true">排名</th>
                    <th data-sort-ignore="true" style="width: 85px;">近3年<br>收益率</th>
                    <th data-sort-ignore="true">排名</th>
                    <th data-hide="phone,tablet,hides">理财产品详细介绍</th>
                    <th data-sort-ignore="true" style="width: 40px;">选择</th>
                  </tr>
                  </thead>
                  <% @financial2.each do |f| %>
                      <tr class="finance<%= f.id %> hide">
                        <td><%= f.classify %></td>
                        <td><%= f.pname %></td>
                        <td><% if f.rate !=nil %><% if /^[-+]?[0-9]+(\.[0-9]+)?$/ =~f.rate %><%= format("%0.2f",f.rate.to_f*100) %>%<% else %><%= f.rate %><% end %><% end %></td>
                        <td><%= f.rank %></td>
                        <td><% if f.rate1 !=nil %><% if /^[-+]?[0-9]+(\.[0-9]+)?$/ =~f.rate1 %><%= format("%0.2f",f.rate1.to_f*100) %>%<% else %><%= f.rate1 %><% end %><% end %></td>
                        <td><%= f.rank1 %></td>
                        <td><%= f.pintroduction %></td>
                        <td><input type="radio" id="iCheck" name="iCheck2" class="<%= f.id %>"></td>
                      </tr>
                  <% end %>
                </table>
              </div>
              <input type="checkbox" class="hide">
              <div class="mobile"><br></div>
            </div>
            <div class="question">
              <table class="center">
                <tr>
                  <td>
                    <p class="q-text" id="result"></p>
                    <input type="checkbox" class="hide">
                    <table class="table table-striped table-bordered center" style="height: 200px;">
                      <tr>
                        <th>理财产品大类</th>
                        <th>当前比例</th>
                        <th>建议比例</th>
                        <th>建议金额</th>
                      </tr>
                      <tr>
                        <td>流动性资产</td>
                        <td id="xianjin"></td>
                        <td id="xian0"></td>
                        <td>
                          <button id="age-decrease0" class="light-gray" tabindex="-1">−</button>
                          <input id="xian1" name="xian" value="28" type="text" style="width: 60px;margin: 0;text-align: center;" readonly>
                          <button id="age-increase0" class="light-gray" tabindex="-1">+</button>
                        </td>
                      </tr>
                      <tr>
                        <td>保本性资产</td>
                        <td id="wenjian"></td>
                        <td id="wen"></td>
                        <td>
                          <button id="age-decrease1" class="light-gray" tabindex="-1">−</button>
                          <input id="wen1" name="wen" value="28" type="text" style="width: 60px;margin: 0;text-align: center;" readonly>
                          <button id="age-increase1" class="light-gray" tabindex="-1">+</button>
                        </td>
                      </tr>
                      <tr>
                        <td>风险性资产</td>
                        <td id="fengxian"></td>
                        <td id="feng"></td>
                        <td>
                          <button id="age-decrease2" class="light-gray" tabindex="-1">−</button>
                          <input id="feng1" name="feng" value="28" type="text" style="width: 60px;margin: 0;text-align: center;" readonly>
                          <button id="age-increase2" class="light-gray" tabindex="-1">+</button>
                        </td>
                      </tr>
                      <tr>
                        <td>年总积蓄</td>
                        <td>100%</td>
                        <td>100%</td>
                        <td id="total" style="text-align: center;"></td>
                      </tr>
                    </table>
                  </td>
                  <td>
                    <div style="width: 300px;"><div class="percentage" style="margin: 0 auto;" data-percent="0"><span  style="font-size: 20px;font-family: Microsoft YaHei;">0</span>分</div></div>
                  </td>
                </tr>
              </table>
            </div>

            <input type="hidden" name="rec" value="0.1" tabindex="-1">
          </div>
          <div id="q-fade-t"></div>
          <div id="q-fade-b"></div>
        </div>
        <div id="q-buttons">
          <button class="q-button light-gray big-button" style="line-height: 16px;" id="q-back"><span>上一项</span></button>
          <button class="q-button orange-button big-button" id="q-next">下一项</button>
          <button class="q-button orange-button big-button" id="q-submit">个人首页</button>

          <p class="q-privacy">
            <span class="q-privacy-1">这是匿名的，所以你可以如实回答<span class="win">，</span></span>
            <span class="win">我们不会问你的身份识别信息，除非阁下主动联系我们。</span>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
    var risk=0;

    <% if params[:risk]!=nil && params[:risk]!='' %>
       risk= '<%= params[:risk] %>';
    <% elsif session[:webusername]!=nil %>
       risk='<%= @webuser.risktolerance %>'
    <% end %>

    $(function(){
        window.onerror = function(error, url, lineNumber) {
            var payload = {"rev": "80126", "error": error, "agent": navigator.userAgent, "stack": []};

            // begin ie9 only stack trace grabbing
            var value = arguments.callee;
            for(i=0; i!=10; ++i) {
                if(value.caller) {
                    payload.stack.push(value.caller.toString());
                    value = value.caller;
                }
            }

            if (!w.jsErrors[payload]) {
                w.jsErrors[payload] = true;
                w.trackESP("ClientSideError", location.href, JSON.stringify(payload));
            }

            return false;
        }
        $.each(onReady.fns, function(i,f) {f()});
    });
</script>

<script>
    $(function() {

        var $qv = $("#questionnaire-view");
        var $qr = $("#questionnaire");
        var accountMin = 0;

        $("#questionnaire-view .ktip-link").bind("tip.show", function() {
            w.trackEvent("OFA", "questionnaire_faq_show", this.id);
        });

        $("#q-numbers").delegate(".q-num.past", "click", function() {
            var $i = $qr.find(".invalid");
            if ($i.length) {
                $i.focus().select();
            } else {
                showQn($(this).index());
            }
        });

        $qr.data("vals", 0)
                .data("init", function(doCalc) {

                    $("#q-back,#q-next").click(function(e) {
                        var back = this.id == "q-back";
                        if (back) {
                            w.trackEvent("OFA", "questionnaire_back");
                        } else {
                            w.trackEvent("OFA", "questionnaire_next", qPayload());
                        }
                        var new_q_num = $qr.data("q") + (back ? -1 : 1);
                        showQn(new_q_num);
                    });
                    $("#q-submit").click(function(e) {
                        <% if session[:webusername]!=nil %>
                        $.post("/personmanagement/userajax/0",{ username:"<%= session[:webusername] %>",selection: selection,xianp:$("#xian1").attr("value"),
                            wenp: $("#wen1").attr("value"),fengp: $("#feng1").attr("value")
                        },function(data){
                            location.href='/personmanagement/personfinance';
                        });
                        <% else %>
                        location.href='/sales/login?logintype=creat&risk=<%= params[:risk] %>&save=<%= params[:save] %>&age=<%= params[:age] %>&investamount=<%= params[:investamount] %>&investvarieties=<%= params[:investvarieties] %>'+
                                '&score=<%= params[:score] %>&variety=<%= params[:variety] %>&pname=<%= params[:pname] %>&amount=<%= params[:amount] %>&age=<%= params[:age] %>&salary=<%= params[:salary] %>&rent=<%= params[:rent] %>&wages=<%= params[:wages] %>&xian=<%= params[:xian] %>&wen=<%= params[:wen] %>&feng=<%= params[:feng] %>'+
                                '&xianp='+$("#xian1").attr("value")+'&wenp='+$("#wen1").attr("value")+'&fengp='+$("#feng1").attr("value")+'&selection='+selection
                        <% end %>
                    });
                    function qPayload() {
                        var $n = $qr.find("input[tabindex=0]").filter(":checked");
                        if (!$n.length) {
                            $n = $n.end();
                        }
                        return $n.attr("name") + ":" + $n.val();
                    }
                    showQn(0);
                });

        function showQn(i, immediately) {
            var $qns = $qr.children(".question");
            var $qn = $qns.eq(i);
            if(i==0){
                if(risk>8 && risk<=10){
                    $("#risk2").html("您是激进型的投资者，但我们将和您类似的积极型也一起罗列出来，供您选择。另外的类型和您风险评估相差太大，我们将不加以罗列了。");
                    $(".level1").hide();$(".level2").hide();$(".level3").hide();
                    $(".level5").addClass('first');
                }
                else if(risk>6 && risk<=8){
                    $("#risk2").html("您是积极型的投资者，但我们将和您类似的稳健型、激进型也一起罗列出来，供您选择。另外的类型和您风险评估相差太大，我们将不加以罗列了。");
                    $(".level1").hide();$(".level2").hide();
                    $(".level4").addClass('first');
                }
                else if(risk>4 && risk<=6){
                    $("#risk2").html("您是稳健型的投资者，但我们将和您类似的保守型、积极型也一起罗列出来，供您选择。另外的类型和您风险评估相差太大，我们将不加以罗列了。");
                    $(".level1").hide();$(".level5").hide();
                    $(".level3").addClass('first');
                }
                else if(risk>2 && risk<=4){
                    $("#risk2").html("您是保守型的投资者，但我们将和您类似的安益型、稳健型也一起罗列出来，供您选择。另外的类型和您风险评估相差太大，我们将不加以罗列了。");
                    $(".level4").hide();$(".level5").hide();
                    $(".level2").addClass('first');
                }
                else if(risk>=0 && risk<=2){
                    $("#risk2").html("您是安益型的投资者，但我们将和您类似的安益型也一起罗列出来，供您选择。另外的类型和您风险评估相差太大，我们将不加以罗列了。");
                    $(".level3").hide();$(".level4").hide();$(".level5").hide();
                    $(".level1").addClass('first');
                }
                var test_div=document.getElementById("questionnaire-view");
                test_div.style.width="98%";
                test_div.style.height="660px";
            }
            if(i==1){
                $("#title").html("概要总结");
                var test_div=document.getElementById("questionnaire-view");
                test_div.style.width="98%";
                test_div.style.height="326px";
            }
            if (i >= 0 && $qn.length) {
                $qns.eq($qr.data("q")).find("input").attr("tabindex", "-1");
             //   $("#q-back span").text(i === 2 ? "上一项" : "上一项");
                $qr.data({q: i, transition: true});
                var newTop = -i * $qn.height() + "px";
                if(i==1){newTop= "-660px"}
                //  alert(newTop)
                if (immediately) {
                    $qr.css("top", newTop);
                }
                if (immediately || $qr.css("top") === newTop) {
                    setTimeout(onAtQn, 5);
                } else {
                    $qr.animate({"top": newTop}, onAtQn);
                }

                var isLastQn = i == $qns.length - 1;
                $("#q-buttons").toggleClass("q-submit", isLastQn);

                var $i = $qn.find("input");
                var done = $i.is(":radio") ? $i.is(":checked") : !!$i.val();
                done=true;   //下
                $(isLastQn ? "#q-submit" : "#q-next").attr("disabled", !done);
                $qr.trigger("qr:nav", i);

                w.trackEvent("OFA", "question_display", (i+1) + "." + $i.attr("name"));
            }

            function onAtQn() {
                $qr.removeData("transition");
                $qn.find("input").attr("tabindex", "0")
                        .filter("[checked=true],input:first").focus().select();
            }
        }
    });
</script>
<script>
    $(function() {
        var $n = $("#q-numbers"), $qr = $("#questionnaire");
        $qr.bind("qr:nav", function(e, i) {
            var $n = $("#q-numbers");
            $n.children(".q-num.curr").removeClass("curr").addClass("past");
            $n.children().eq(i).removeClass("past").addClass("curr");
        })
                .data("init")(true);
    });
</script>

<script>
    var selection='';
    var variety,amount,pname,jixu,total,xian,feng,wen;
    var xianjin= 0,wenjian= 0,fengxian=0;
    $(document).ready(function(){
        $('[id*="iCheck"]').iCheck({
            checkboxClass: 'icheckbox_square-red',
            radioClass: 'iradio_square-red',
            increaseArea: '20%' // optional
        });
        initPieChart();

        <% if session[:webusername]==nil %>
            location.href="/sales/login?summary=1";
        <% end %>

      <% if params[:score]!=nil &&  params[:score]!='' %>
        variety='<%= params[:variety] %>'.split(",")  //资产品种
        amount='<%= params[:amount] %>'.split(",")  //资产金额
      <% elsif session[:webusername]!=nil %>
        variety='<%= @examination.variety %>'.split(",")  //资产品种
        amount='<%= @examination.amount %>'.split(",")  //资产金额
      <% end %>

        for(j=0;j<variety.length;j++){
            var ccc=amount[j].replace(/,/g, "");
            if(ccc==''){ccc=0;}
            if(variety[j]=="银行活期"){xianjin=xianjin+parseFloat(ccc)}
            else if(variety[j]=="余额宝"){xianjin=xianjin+parseFloat(ccc)}
            else if(variety[j]=="其他货币基金"){xianjin=xianjin+parseFloat(ccc)}
            else if(variety[j]=="银行理财产品"){wenjian=wenjian+parseFloat(ccc)}
            else if(variety[j]=="银行定期"){wenjian=wenjian+parseFloat(ccc)}
            else if(variety[j]=="债券型基金"){wenjian=wenjian+parseFloat(ccc)}
            else if(variety[j]=="股票"){fengxian=fengxian+parseFloat(ccc)}
            else if(variety[j]=="股票型基金"){fengxian=fengxian+parseFloat(ccc)}
            else if(variety[j]=="贵金属"){fengxian=fengxian+parseFloat(ccc)}
            else if(variety[j]=="其它"){fengxian=fengxian+parseFloat(ccc)}
        }
        jixu=xianjin+wenjian+fengxian;//积蓄
        <% if params[:score]!=nil &&  params[:score]!='' %>
        total=parseInt((parseFloat('<%= params[:wages] %>')*12+jixu)/100)*100;//总资产
        xian=parseInt((parseFloat('<%= params[:rent] %>')*3)/100)*100;
        feng=parseInt((total*(80-parseFloat('<%= params[:age] %>'))/100)/100)*100;
        wen=total-xian-feng;
        <% elsif session[:webusername]!=nil %>
        total=parseInt((parseFloat('<%= @examination.wages %>')*12+jixu)/100)*100;//总资产
        xian=parseInt((parseFloat('<%= @examination.rent %>')*3)/100)*100;
        feng=parseInt((total*(80-parseFloat('<%= @examination.age %>'))/100)/100)*100;
        wen=total-xian-feng;
        <% end %>

           $("#xianjin").html((xianjin/jixu*100).toFixed(1).toString()+'%');
           $("#wenjian").html((wenjian/jixu*100).toFixed(1).toString()+'%');
           $("#fengxian").html((fengxian/jixu*100).toFixed(1).toString()+'%');
           $("#xian0").html((xian/total*100).toFixed(1).toString()+'%');
           $("#wen").html((wen/total*100).toFixed(1).toString()+'%');
           $("#feng").html((feng/total*100).toFixed(1).toString()+'%');
           $("#xian1").attr("value",xian);
           $("#wen1").attr("value",wen);
           $("#feng1").attr("value",feng);
           $("#total").html(total);
        if(xianjin/jixu>xian/total){
            $("#result").html("您当期的流动型资产配置过高，")
        }
        else if(xianjin/jixu<xian/total){
            $("#result").html("您当期的流动型资产配置过低，")
        }
        else{
            $("#result").html("您当期的流动型资产配置适中，")
        }
        if(wenjian/jixu>wen/total){
            $("#result").html($("#result").html()+'保本型配置过高，')
        }
        else if(wenjian/jixu<wen/total){
            $("#result").html($("#result").html()+'保本型配置过低，')
        }
        else{
            $("#result").html($("#result").html()+'保本型配置适中，')
        }
        if(fengxian/jixu>feng/total){
            $("#result").html($("#result").html()+'风险型配置过高。')
        }
        else if(fengxian/jixu<feng/total){
            $("#result").html($("#result").html()+'风险型配置过低。')
        }
        else{
            $("#result").html($("#result").html()+'风险型配置适中。')
        }
        <% if params[:score]!=nil &&  params[:score]!='' %>
        animate(0,parseFloat('<%= params[:score] %>'));
        <% elsif session[:webusername]!=nil %>
        animate(0,parseFloat('<%= @webuser.score %>'));
        <% end %>
    });

    $("#age-decrease0").click(function(){
        if(parseInt(xian*0.9)<parseInt($("#xian1").attr("value")) && parseInt(feng*1.1)>parseInt($("#feng1").attr("value")) && parseInt($("#xian1").attr("value"))>=200){
            $("#xian1").attr("value",parseInt($("#xian1").attr("value"))-100);
            $("#feng1").attr("value",parseInt($("#feng1").attr("value"))+100);
            $("#xian0").html((parseInt($("#xian1").attr("value"))/total*100).toFixed(1).toString()+'%');
            $("#feng").html((parseInt($("#feng1").attr("value"))/total*100).toFixed(1).toString()+'%');
            $("#xian1").removeClass("invalid");
            $("#feng1").removeClass("invalid");
            $(".alert").hide();
        }
        else{
            if(parseInt(xian*0.9)>=parseInt($("#xian1").attr("value"))){$("#xian1").addClass("invalid");}
            if(parseInt(feng*1.1)<=parseInt($("#feng1").attr("value"))){$("#feng1").addClass("invalid");}
            $(".alert").show();
        }
    });
    $("#age-increase0").click(function(){
        if(parseInt(xian*1.1)>parseInt($("#xian1").attr("value")) && parseInt(feng*0.9)<parseInt($("#feng1").attr("value"))  && parseInt($("#feng1").attr("value"))>=200){
            $("#xian1").attr("value",parseInt($("#xian1").attr("value"))+100);
            $("#feng1").attr("value",parseInt($("#feng1").attr("value"))-100);
            $("#xian0").html((parseInt($("#xian1").attr("value"))/total*100).toFixed(1).toString()+'%');
            $("#feng").html((parseInt($("#feng1").attr("value"))/total*100).toFixed(1).toString()+'%');
            $("#xian1").removeClass("invalid");
            $("#feng1").removeClass("invalid");
            $(".alert").hide();
        }
        else{
            if(parseInt(xian*1.1)<=parseInt($("#xian1").attr("value"))){$("#xian1").addClass("invalid");}
            if(parseInt(feng*0.9)>=parseInt($("#feng1").attr("value"))){$("#feng1").addClass("invalid");}
            $(".alert").show();
        }
    });

    $("#age-decrease1,#age-increase2").click(function(){
        if(parseInt(wen*0.9)<parseInt($("#wen1").attr("value")) && parseInt(feng*1.1)>parseInt($("#feng1").attr("value")) && parseInt($("#wen1").attr("value"))>=200){
            $("#wen1").attr("value",parseInt($("#wen1").attr("value"))-100);
            $("#feng1").attr("value",parseInt($("#feng1").attr("value"))+100);
            $("#wen").html((parseInt($("#wen1").attr("value"))/total*100).toFixed(1).toString()+'%');
            $("#feng").html((parseInt($("#feng1").attr("value"))/total*100).toFixed(1).toString()+'%');
            $("#wen1").removeClass("invalid");
            $("#feng1").removeClass("invalid");
            $(".alert").hide();
        }
        else{
            if(parseInt(wen*0.9)>=parseInt($("#wen1").attr("value"))){$("#wen1").addClass("invalid");}
            if(parseInt(feng*1.1)<=parseInt($("#feng1").attr("value"))){$("#feng1").addClass("invalid");}
            $(".alert").show();
        }
    });
    $("#age-increase1,#age-decrease2").click(function(){
        if(parseInt(wen*1.1)>parseInt($("#wen1").attr("value")) && parseInt(feng*0.9)<parseInt($("#feng1").attr("value"))  && parseInt($("#feng1").attr("value"))>=200){
            $("#wen1").attr("value",parseInt($("#wen1").attr("value"))+100);
            $("#feng1").attr("value",parseInt($("#feng1").attr("value"))-100);
            $("#wen").html((parseInt($("#wen1").attr("value"))/total*100).toFixed(1).toString()+'%');
            $("#feng").html((parseInt($("#feng1").attr("value"))/total*100).toFixed(1).toString()+'%');
            $("#wen1").removeClass("invalid");
            $("#feng1").removeClass("invalid");
            $(".alert").hide();
        }
        else{
            if(parseInt(wen*1.1)<=parseInt($("#wen1").attr("value"))){$("#wen1").addClass("invalid");}
            if(parseInt(feng*0.9)>=parseInt($("#feng1").attr("value"))){$("#feng1").addClass("invalid");}
            $(".alert").show();
        }
    });

    $('input').on('ifChecked', function(event){
        if(this.name=='iCheck'){
            var eq=this.className.split(",");
            $("#category td").removeClass("second");
            var length=$("#category").find("tr").size();
            for(i=0;i<length;i++){
                if($("#category tr:eq("+i+") td:eq(1)").html()==eq[1]){
                    for(j=0;j<7;j++){
                        $("#category tr:eq("+i+") td:eq("+j+")").addClass("second")
                    }
                }
            }
            $("#finance").show();
            $('[class*="finance"]').hide();
        <%  for i in 0..@hash.size-1 %>
            if(eq[0]=='<%= @hash[i][0] %>'){
                var pid= '<%= @hash[i][2] %>'.split(",");
                for(var k=0;k<pid.length;k++){
                    $('.finance'+pid[k]).show();
                }
            }
        <% end %>
        }
        else if(this.name=='iCheck2'){
            $("tr").removeClass("third");
            $(".finance"+this.className).addClass("third");
            document.getElementById("q-submit").disabled=false;
        <% @financial2.each do |f| %>
            if(this.className=='<%= f.id %>'){
                selection='<%= f.pname %>';
            }
        <% end %>
        }
    });
</script>


<%= javascript_include_tag "excanvas.js" %>
<%= javascript_include_tag "jquery.easy-pie-chart.js" %>
<script type="text/javascript">
    var initPieChart = function() {
        $('.percentage').easyPieChart({
            animate: 1000
        });
    };
    function animate(i,a){
        if(i<a){
            $('.percentage').each(function() {
                $(this).data('easyPieChart').update(i);
                $('span', this).text(i);
            });
            setTimeout("animate("+(i+1).toString()+','+a+")",50);
        }
        else{
            $('.percentage').each(function() {
                $(this).data('easyPieChart').update(a);
                $('span', this).text(a);
            });
        }
    }
</script>