<%= javascript_include_tag "jquery.dataTables.min.js" %>
<%= stylesheet_link_tag "datatables.css" %>
<%= stylesheet_link_tag "admin.css" %>

<div class="main-content">
<%= %>
<div class="main-body">
<div class="content">
<div class="fthb faded">

<table class="body-container" cellspacing="0" cellpadding="0" border="0">

<!-- tr head-->
<tr><td>
  <table width="100%" class="body-header" cellspacing="0" cellpadding="0">
    <tr><td>
      <div class="crumbs">
        <a href="/">首页</a>&nbsp; >&nbsp;
        <a href="/admin/" >admin管理页面</a>
      </div>
    </td></tr>
  </table>
</td>
</tr>

<!-- tr body-content-->
<tr>
<!-- td body-content-->
<td class="body-content">
<div class="body-content-wrapper">
<div class="page-interaction">

<!-- div2-->
<div>
<!-- main table-->
<table class="block">
<% if session[:webusername]=='admin' %>
    <!--
                      <tr>
                        <td>
                          <h2>本金管理</h2><br>

                          <a href="/admin/fundconfig/0">添加本金</a>
                          <table cellpadding="0" cellspacing="0" border="0" class="display" id="funds">
                            <thead><tr>
                              <th>用户名</th><th>投资产品</th><th>本金存入日期</th>
                              <th>本金金额</th>
                              <th>修改</th><th>删除</th><th>查看</th>
                            </tr></thead>
                            <tbody>
                            <% @investfunds.each do |i|  %>
                                <tr>
                                  <td><%= i.username%></td>
                                  <td><%= i.pname%></td>
                                <td><%= i.date.to_s(:stamp)%></td>
                                  <td><%= i.recordvalue%></td>
                                  <td><a href="/admin/fundconfig/<%= i.id %>">修改</a></td>
                                  <td><a href="javascript:void(0)" onclick="if(confirm('确认要删除？'))deleteajax('<%= i.id %>','funddeleteajax')">删除</a></td>
                                <td><a href="/privatefund/investrecord/<%= Webuser.find_by_username(i.username).id%>">查看</a></td>
                                </tr>
                            <% end %>
                            </tbody>
                          </table>

                        </td>
                      </tr>
                      -->
    <!--
                      <tr>
                        <td>
                          <h2>利息管理</h2><br>
                          <h3>下一次提取利息时间：</h3>
                          <table cellpadding="0" cellspacing="0" border="0" class="display" id="interests_r">
                            <thead><tr>
                              <th>用户名</th><th>返还产品</th><th>返还批次</th><th>返还利息日期</th>
                              <th>返还利息金额</th>
                            </tr></thead>
                            <tbody>
                            <% for i in 0..@hash_remind.keys.size-1 %>
                                <tr>
                                  <td><%= @hash_remind[@hash_remind.keys[i]][0]%></td>
                                  <td><%= @hash_remind[@hash_remind.keys[i]][1]%></td>
                                  <td><%= @hash_remind[@hash_remind.keys[i]][2]%></td>
                                  <td><%= @hash_remind[@hash_remind.keys[i]][3]%></td>
                                  <td><%= @hash_remind[@hash_remind.keys[i]][4]%></td>
                                </tr>
                                  <% end %>
                            <% for i in 0..@adminremind.keys.size-1 %>
                                <tr>
                                  <td>admin</td>
                                  <td><%= @adminremind[@adminremind.keys[i]][0]%></td>
                                  <td>0</td>
                                  <td><%= @adminremind[@adminremind.keys[i]][1]%></td>
                                  <td><%= @adminremind[@adminremind.keys[i]][2]%></td>
                                </tr>
                            <% end %>
                            </tbody>
                          </table>

                          <br><h3>还没有确认支付的利息：</h3>
                          <table cellpadding="0" cellspacing="0" border="0" class="display" id="interests_c">
                            <thead><tr>
                              <th>用户名</th><th>返还产品</th><th>返还批次</th><th>返还利息日期</th>
                              <th>返还利息金额</th><th>确认</th>
                            </tr></thead>
                            <tbody>
                            <% for i in 0..@hash_confirm.keys.size-1 %>
                                    <tr>
                                  <td><%= @hash_confirm[@hash_confirm.keys[i]][0]%></td>
                                  <td><%= @hash_confirm[@hash_confirm.keys[i]][1]%></td>
                                  <td><%= @hash_confirm[@hash_confirm.keys[i]][2]%></td>
                                  <td><%= @hash_confirm[@hash_confirm.keys[i]][3]%></td>
                                  <td><input id="<%= @hash_confirm.keys[i]%>" style="display: none;" value="<%= @hash_confirm[@hash_confirm.keys[i]][4]%>"><div id="d<%= @hash_confirm.keys[i]%>"><%= @hash_confirm[@hash_confirm.keys[i]][4]%></div></td>
                                      <% if /^[-+]?[0-9]+(\.[0-9]+)?$/.match(@hash_confirm[@hash_confirm.keys[i]][4])!=nil%>
                                  <td><a href="javascript:void(0)" onclick="if(confirm('确认已经支付？'))interestconfirm('<%= @hash_confirm[@hash_confirm.keys[i]][0]%>','<%= @hash_confirm[@hash_confirm.keys[i]][3]%>','<%= @hash_confirm[@hash_confirm.keys[i]][4]%>','<%= @hash_confirm[@hash_confirm.keys[i]][2]%>','<%= @hash_confirm[@hash_confirm.keys[i]][1]%>')">确认</a></td>
                                      <% else %>
                                          <td><a href="javascript:void(0)" onclick="alert('不可确认！')">确认</a></td>
                                   <% end %>
                                    </tr>
                                <% end %>
                            <% for i in 0..@adminconfirm.keys.size-1 %>
                                <tr>
                                  <td>admin</td>
                                  <td><%= @adminconfirm[@adminconfirm.keys[i]][0]%></td>
                                  <td>0</td>
                                  <td><%= @adminconfirm[@adminconfirm.keys[i]][1]%></td>
                                  <td><%= @adminconfirm[@adminconfirm.keys[i]][2]%></td>
                                  <% if /^[-+]?[0-9]+(\.[0-9]+)?$/.match(@adminconfirm[@adminconfirm.keys[i]][2])!=nil%>
                                  <td><a href="javascript:void(0)" onclick="if(confirm('确认已经支付？'))interestconfirm('admin','<%= @adminconfirm[@adminconfirm.keys[i]][1]%>','<%= @adminconfirm[@adminconfirm.keys[i]][2]%>',0,'<%= @adminconfirm[@adminconfirm.keys[i]][0]%>')">确认</a></td>
                                  <% else %>
                                      <td><a href="javascript:void(0)" onclick="alert('不可确认！')">确认</a></td>
                                  <% end %>
                                </tr>
                            <% end %>
                            </tbody>
                          </table>

                        </td>
                      </tr>
                      -->

    <!--
                      <tr>
                        <td>
                          <h2>产品管理</h2><br>
                          <h3>产品基本信息</h3>
                          <a href="/admin/productconfig/0?optype=edit">添加产品</a>
                          <table cellpadding="0" cellspacing="0" border="0" class="display" id="products">
                            <thead><tr>
                              <th>产品名称</th><th>成立日期</th><th>分红方式</th>
                              <th>分红值</th><th>分红周期</th><th>承受风险</th>
                              <th>修改</th><th>删除</th><th>查看</th>
                            </tr></thead>
                            <tbody>
                            <% @products.each do |p|  %>
                                <tr>
                                  <td><%= p.pname%></td>
                                  <td><%= p.founddate%></td>
                                  <td><%= p.dividendtype%></td>
                                  <td><%= p.dividendvalue%></td>
                                  <td><%= p.period%></td>
                                  <td><%= p.riskvalue%></td>
                                  <td><a href="/admin/productconfig/<%= p.id %>?optype=edit">修改</a></td>
                                  <td><a href="javascript:void(0)" onclick="if(confirm('确认要删除？'))deleteajax('<%= p.id %>','productdeleteajax')">删除</a></td>
                                  <td><a href="/privatefund/index/<%= p.id %>">查看</a></td>
                                </tr>
                            <% end %>
                            </tbody>
                          </table>
                          <h3>产品净值更新表</h3>

  <table cellpadding="0" cellspacing="0" border="0" class="display" id="productsupdate">
    <thead><tr>
      <th>产品名称</th><th>上日结存</th>
      <th>当日盈亏</th><th>更新日期</th>
      <th>更新</th><th>查看净值记录</th><th>查看分红记录</th>
    </tr></thead>
    <tbody>
    <% @products.each do |p|  %>
        <tr>
          <td><%= p.pname%></td>
          <td><%= p.lastprofits%></td>
          <td><%= p.todayprofit%></td>
          <td><%= p.date%></td>
          <td><a href="/admin/productconfig/<%= p.id %>?optype=update">添加/更新</a></td>
          <td> <a href="/admin/productrecords/<%= p.id %>">查看净值</a></td>
          <td> <a href="/admin/interestrecords/<%= p.id %>">查看分红</a></td>
        </tr>
    <% end %>
    </tbody>
  </table>
                        </td>
                      </tr>
                       -->
    <!--
                    <tr><td>
                      <h1>产品预订</h1>
                      <table cellpadding="0" cellspacing="0" border="0" class="display" id="reserve">
                        <thead><tr>
                          <th>产品名</th><th>银行名</th><th>银行支行</th><th>投资金额</th><th>用户名</th>
                          <th>用户电话</th><th>客户经理名字</th><th>客户经理电话</th><th>状态</th>
                          <th>修改</th>
                        </tr></thead>

                        <% @reserves.each do |b| %>
                            <tr>
                              <td><%= b.bname%></td>
                              <td><%= b.trustee%></td>
                              <td><%= b.bankbranch%></td>
                              <td><%= b.investamount%></td>
                              <td><%= b.username%></td>
                              <td><%= b.tel%></td>
                              <td><%= b.managername%></td>
                              <td><%= b.managertel%></td>
                              <td><%= b.state%></td>
                              <td><a href="/admin/reserveconfig/<%= b.id %>?optype=edit">修改</a></td>
                            </tr>
                        <% end %>
                      </table>
                    </td></tr>
   -->
<% end %>

<% if session[:webusername]=='admin' %>
    <tr>
      <td>
        <h1>投资人管理</h1><br>
        <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered display" id="users">
          <thead><tr>
            <th class="hide">ID</th>
            <th style="width: 20%;">用户名</th>
            <th class="hide">密码</th>
            <th>电子邮件</th>
            <th style="width: 12%;">联系电话</th>
            <th style="width: 12%;">资金量</th>
            <th style="width: 8%;">修改</th>
            <th style="width: 8%;">删除</th>
            <th style="width: 8%;">投资信息</th>
          </tr></thead>
          <tbody>
          <% @webusers.each do |w|  %>
              <tr>
                <td class="hide"><%= w.id%></td>
                <td><%= w.username%></td>
                <td class="hide"><%= @hash_password[w.id]%></td>
                <td><% if w.email!="1" %><%= w.email %><% end %></td>
                <td><% if w.tel!="1" %><%= w.tel%><% end %></td>
                <td>
                  <% @personalfinance.each do |t|  %>
                      <% if t.username==w.username && t.investamount!=nil %>
                          <%= format("%0.0f",t.investamount) %>
                      <% end %>
                  <% end %>
                </td>
                <td><a href="/admin/userconfig/<%= w.id %>">修改</a></td>
                <td><a href="javascript:void(0)" onclick="if(confirm('确认要删除？'))deleteajax('<%= w.id %>','userdeleteajax')">删除</a></td>
                <td><a href="/usersurvey/userinfo/<%= w.id %>">查看</a></td>
              </tr>
          <% end %>
          </tbody>
        </table>
        <br> <br>
      </td>
    </tr>

    <tr>
      <td>
        <h1>理财师管理</h1><br>
        <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered display" id="organuser">
          <thead><tr>
            <th class="hide">ID</th>
            <th style="width: 20%;">用户名</th>
            <th class="hide">密码</th>
            <th>电子邮件</th>
            <th style="width: 12%;">联系电话</th>
            <th style="width: 12%;">资金量</th>
            <th style="width: 8%;">修改</th>
            <th style="width: 8%;">删除</th>
            <th style="width: 8%;">投资信息</th>
          </tr></thead>
          <tbody>
          <% @organuser.each do |w|  %>
              <tr>
                <td class="hide"><%= w.id%></td>
                <td><%= w.username%></td>
                <td class="hide"><%= @hash_password[w.id]%></td>
                <td><% if w.email!="1" %><%= w.email %><% end %></td>
                <td><% if w.tel!="1" %><%= w.tel%><% end %></td>
                <td>
                  <% @personalfinance.each do |t|  %>
                      <% if t.username==w.username && t.investamount!=nil %>
                          <%= format("%0.0f",t.investamount) %>
                      <% end %>
                  <% end %>
                </td>
                <td><a href="/admin/userconfig/<%= w.id %>">修改</a></td>
                <td><a href="javascript:void(0)" onclick="if(confirm('确认要删除？'))deleteajax('<%= w.id %>','userdeleteajax')">删除</a></td>
                <td><a href="/usersurvey/userinfo/<%= w.id %>">查看</a></td>
              </tr>
          <% end %>
          </tbody>
        </table>
        <br> <br>
      </td>
    </tr>
<% end %>
<% if session[:webusername]=='admin' %>
    <tr><td>
      <h1>经纪人上传产品管理</h1>
      <a href="/admin/bankfinanceconfig/0?organ=1">添加</a>
      <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered display" id="organ">
        <thead><tr>
          <th>经纪人用户名</th><th>机构名</th><th>是否为精选</th>
          <th>产品名称</th><th>操作</th>
        </tr></thead>

        <% @bankfinance2.each do |b| %>
            <tr>
              <td><%= b.name%></td>
              <td><%= b.trustee%></td>
              <% if b.ischosen=='1'%>
                  <td>是</td>
              <% else %>
                  <td>否</td>
              <% end %>
              <td><%= b.bname%></td>
              <td><a href="/admin/bankfinanceconfig/<%= b.id %>?optype=edit&organ=1">修改</a></td>
            </tr>
        <% end %>
      </table>
    </td></tr>

<% end%>

<tr><td>
  <h1>博客</h1>
  <a href="/admin/blogconfig/0">添加</a>
  <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered display" id="blog">
    <thead><tr>
      <th>博客标题</th><th>发表人</th><th>发表时间</th>
      <th>栏目</th><th>图片</th><th class="hide">ID</th><th>修改</th><th>删除</th><th>查看</th>
    </tr></thead>

    <% @blogs.each do |b| %>
        <tr>
          <td><%=raw b.btitle%></td>
          <td><%= b.blname%></td>
          <td style="white-space:nowrap;"><%= b.publishdate%></td>
          <td style="white-space:nowrap;"><%= b.bcolumn%></td>
          <td><%= b.imagepath%></td>
          <td class="hide"><%= b.id%></td>
          <td><a href="/admin/blogconfig/<%= b.id %>">修改</a></td>
          <td><a href="javascript:void(0)" onclick="if(confirm('确认要删除？'))deleteajax('<%= b.id %>','blogdeleteajax')">删除</a></td>
          <td><a href="/blog/blogarticle/<%= b.id%>">查看</a></td>
        </tr>
    <% end %>
  </table>
</td></tr>

</table>
</div>
</div>

</div>
</td>
</tr>

</table>
</div>
</div>
</div>
</div>

<script>

    $(document).ready(function(){
        $('#products,#funds,#interests_r,#interests_c,#productsupdate,#bankfinance,#reserve,#bankproducts,#organ').dataTable();
        var oTable = $('#bankfinance').dataTable();
        $("#keywords").click( function() { oTable.fnDraw(); } );

        /* Initialise datatables */
        var oTable = $('#blog').dataTable({
            "aaSorting": [[ 5, "desc" ]]
        });
        var oTable = $('#users').dataTable({
            "aaSorting": [[ 0, "desc" ]]
        });
        var oTable = $('#organuser').dataTable({
            "aaSorting": [[ 0, "desc" ]]
        });
    });
    function deleteajax(id,type){
        $.get("/admin/"+type+"/"+id,function(data){
            if(data=="s"){
                alert("删除成功！");
                location.reload();
            }
            else{
                alert("删除失败！");
                location.reload();
            }
        });
    }

    function interestconfirm(username,date,value,ordernum,pname){
        $.get("/admin/interestconfirm",{username:username,date:date,recordvalue:value,ordernum:ordernum,pname:pname},function(data){
            if(data=="s"){
                alert("确认成功！");
                location.reload();
            }
            else if(data=="f"){
                alert("确认失败！");
                location.reload();
            }

        })
    }
</script>