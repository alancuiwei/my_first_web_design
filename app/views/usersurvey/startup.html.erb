<%= stylesheet_link_tag "common2.css" %>
<%= javascript_include_tag "base.js" %>
<%= javascript_include_tag "d3.js" %>
<%= javascript_include_tag "plan.js" %>
<%= javascript_include_tag "risk.js" %>
<%= javascript_include_tag "bootstrap.min.js" %>
<%= stylesheet_link_tag "founder.css" %>
<%= javascript_include_tag "highcharts.js" %>
<%= javascript_include_tag "footable-0.1.js" %>
<script type="text/javascript">
    $(function() {
        $('table').footable();
    });
</script>
<script>
    t0=new Date
    function onReady(fn){onReady.fns.push(fn)}
    onReady.fns=[]
</script>

<div class="welcomes startup">
<div class="ofa-funnel-pages">
<div id="page-wrapper">
<div id="top-tabs">
  <div class="top-tabs-content">
    <b>1.</b> <span> 资产体检</span>
    <b>&nbsp;&gt;&nbsp;</b>
    <% if session[:webusername]!=nil && @webuser.risktolerance!=nil %>
        <a href="/usersurvey/measure/2"><b>2.</b> 风险评估</a>
    <% else %>
        <span class="disabled"><b>2.</b> 风险评估</span>
    <% end %>
    <b>&nbsp;&gt;&nbsp;</b>
    <% if session[:webusername]!=nil && @webuser.selection!=nil %>
        <a href="/usersurvey/measure/3"><b>3.</b> 理财建议</a>
    <% else %>
        <span class="disabled"><b>3.</b> 理财建议</span>
    <% end %>
  </div>
</div>

<div id="page-content">
<div class="clearfix"></div>
<h1>
  <span id="title">基本信息</span>
  <div id="q-numbers"><b class="q-num curr"></b><b class="q-num"></b><b class="q-num"></b><b class="q-num"></b><b class="q-num"></b><b class="q-num"></b><b class="q-num"></b><b class="q-num"></b><b class="q-num"></b><b class="q-num"></b></div>
</h1>

<div id="questionnaire-view">
<div id="questionnaire">
<div class="question first">
  <div class="well-c">
    <table class="center">
      <tr>
        <td>
          <p class="q-text">我们将以解决月光为目标，从流动性、保本性、风险性的角度，进行资产体检，以方便你找到月光的根源。</p>
          <p class="q-text">良好的资产体检得分意味着您的投资组合好，多元化，波动幅度小，如果您的体检得分小于60分，我们建议您应该做一些变动调整。</p>
        </td>
        <td style="width: 168px;text-align: center;">
          <a class="introduce" href="#myModal" role="button" data-toggle="modal">资产体检原理介绍</a>
        </td>
        <td>
          <div class="image"><img src="/assets/morningstar2.png"><br><img src="/assets/logo.jpg"></div>
        </td>
      </tr>
    </table>
    <input type="checkbox" class="hide">
  </div>
  <div class="mobile"><br></div>
</div>
<div class="question">
  <div class="well-c">
    <table class="center">
      <tr>
        <td>
          <p class="q-text">个人、家庭都有可能遭遇到突发情况，例如失业、自然灾害（地震、泥石流)、突然死亡（参考微博）。</p>
          <p class="q-text">您作为家庭的顶梁柱，有必要准备应急基金。</p>
          <p class="q-text">这个应急金额大约为3个月日常生活费用总额，是由流动性资产组成的。</p>
          <p class="q-text">下面几种流动性资产可以作为应急资金：现金、活期储蓄、余额宝、货币基金。</p>
        </td>
        <td style="width: 168px;text-align: center;">
          <a class="introduce" href="#myModal2" role="button" data-toggle="modal">我真的需要应急基金吗？</a>
        </td>
        <td>
          <div class="image"><img src="/assets/121058.png"></div>
        </td>
      </tr>
    </table>
    <input type="checkbox" class="hide">
  </div>
  <div class="mobile"><br></div>
</div>
<div class="question">
  <div class="well-c">
    <table class="center">
      <tr>
        <td>
          <p class="q-text">保本性资产是家庭资产配置不可或缺的一部分，他将作为资金增值的安全保护带。这部分资产投资周期将会较长，收益率也相对较高。</p>
          <p class="q-text">随着年龄的增长和家庭风险偏好的下降，该类的比例还将逐渐提高。</p>
        </td>
        <td style="width: 168px;text-align: center;">
          <a class="introduce" href="#myModal8" role="button" data-toggle="modal">我真的需要保本性资产吗？</a>
        </td>
        <td>
          <div class="image"><img src="/assets/121057.png"></div>
        </td>
      </tr>
    </table>
    <input type="checkbox" class="hide">
  </div>
  <div class="mobile"><br></div>
</div>
<div class="question">
  <div class="well-c">
    <table class="center">
      <tr>
        <td class="top">
          <p class="q-text">在这个通货膨胀的时代背景下，风险承担由不得我们自行选择，我们每个人都必须面对，现在不承担风险，将来会承担更大的风险。</p>
          <p class="q-text">风险就像我们要做出“收益”这个美食的刀具，如果因为害怕风险而放弃机会，这就和害怕刀的锋利而不敢使用刀一样。</p>
          <p class="q-text">对于理财规划而言，年龄是个核心的因素。年轻人的资产比例中，风险性投资产品应该占有大比重。</p>
        </td>
        <td>
          <div class="image"><img src="/assets/121056.png"></div>
        </td>
      </tr>
    </table>
    <input type="checkbox" name="income" class="hide">
  </div>
  <div class="mobile"><br></div>
</div>
<div class="question">
  <div class="well-c">
    <table class="center">
      <tr>
        <td class="top">
          <p class="q-text">您的年纪、性别将直接影响到您的资产配置比例。</p>
          <table>
            <tr>
              <td class="q-text" style="width: 120px;">年龄：</td>
              <td><input type="text" name="age" id="age" tabindex="-1"></td>
            </tr>
            <tr>
              <td class="q-text">性别：</td>
              <td><select id="sex"><option value="男">男</option><option value="女">女</option></select></td>
            </tr>
          </table>
        </td>
        <td>
          <div class="image"><img src="/assets/121079.png"></div>
        </td>
      </tr>
    </table>
  </div>
  <div class="mobile"><br></div>
</div>
<div class="question">
  <div class="well-c">
    <table class="center">
      <tr>
        <td class="top">
          <p class="q-text">该类数据分析将帮助您查明每月支出趋向和储蓄力度，确保您的消费符合轻重缓急。</p>
          <p class="q-text">右图是较为常见的月收入分配4321法则。</p>
          <table style="width: 100%;">
            <tr>
              <td class="q-text" style="width: 120px;">月收入：</td>
              <td style="width: 220px;">
                <div class="input-prepend">
                  <span class="add-on">￥</span>
                  <% if @detailedmonth!=nil %>
                      <input type="text" name="lnw" id="salary" tabindex="-1" readonly>
                  <% else %>
                      <input type="text" name="lnw" id="salary" tabindex="-1">
                  <% end %>
                </div>
              </td>
              <td></td>
            </tr>
            <tr>
              <td class="q-text">每月衣食住行：</td>
              <td>
                <div class="input-prepend">
                  <span class="add-on">￥</span>
                  <% if @detailedmonth!=nil %>
                      <input type="text" name="lnw" id="rent" tabindex="-1" readonly>
                  <% else %>
                      <input type="text" name="lnw" id="rent" tabindex="-1">
                  <% end %>
                </div>
              </td>
              <td></td>
            </tr>
            <tr>
              <td class="q-text">每月至少存储：</td>
              <td>
                <div class="input-prepend">
                  <span class="add-on">￥</span>
                  <% if @detailedmonth!=nil %>
                      <input type="text" name="lnw" id="wages" tabindex="-1" readonly>
                  <% else %>
                      <input type="text" name="lnw" id="wages" tabindex="-1">
                  <% end %>
                </div>
              </td>
              <td></td>
            </tr>
            <tr>
              <td colspan="2"><a class="xtip pull-right" href="#myModal3" role="button" data-toggle="modal" id="jinque"> 精确输入 </a></td>
            </tr>
          </table>
        </td>
        <td>
          <div class="image"><img src="/assets/121060.png"></div>
        </td>
      </tr>
    </table>
  </div>
  <div class="mobile"><br></div>
</div>
<div class="question">
  <div class="well-c">
    <table class="center">
      <tr>
        <td>
          <p class="q-text">年度收入主要是指年终奖等额外年末收入。</p>
          <table style="width: 100%;">
            <% for i in 0..@incomeannual.size-1 %>
            <tr>
              <td class="q-text" style="width: 140px;"><%= @incomeannual[i].income_name %>：</td>
              <td style="width: 220px;">
                <div class="input-prepend">
                  <span class="add-on">￥</span>
                  <input type="text" name="exect2" onkeyup="updatenum(this)" id="in<%= i %>" tabindex="-1">
                </div>
              </td>
              <td></td>
            </tr>
            <% end %>
            </table>
          <p class="q-text">年度开销主要是指年计划开销，例如每年旅游费用，每年保险费用等。</p>
          <table style="width: 100%;">
            <% for i in 0..@expenseannual.size-1 %>
            <tr>
              <td class="q-text" style="width: 140px;"><%= @expenseannual[i].expense_name %>：</td>
              <td>
                <div class="input-prepend">
                  <span class="add-on">￥</span>
                  <input type="text" name="exect2" onkeyup="updatenum(this)" id="expen<%= i %>" tabindex="-1">
                </div>
              </td>
              <td></td>
            </tr>
            <% end %>
          </table>
        </td>
      </tr>
    </table>
  </div>
  <div class="mobile"><br></div>
</div>
<div class="question">
  <div class="well-c well-b">
    <p class="q-text">已有资产表是您资产阶段性总结，分析它可以帮助你及时发现财务危机，规划理财方式，并确保实现梦想目标。<br>切记，填写的应该是资产的当期市值，而不是购买价格。</p>
    <div class="row op-label win">
      <div class="span3">资产品种</div>
      <div class="span3" style="text-align: left;">产品简介</div>
      <div class="span2" style="text-align: left;">资产金额</div>
      <div class="span1"></div>
    </div>
    <div class="seperator thick"></div>
    <div class="founder-inputs">
      <div class="op-input first" fid="founder">
        <div class="seperator bottom"></div>
        <div class="row">
          <div class="span3 control-group">
            <div class="mobile">资产品种:</div>
            <select  name="variety" id="variety" class="founder-name" title="资产品种"  onchange="updateintro(this)">
              <% @assettype.each do |a| %>
                  <option value="<%= a.asset_typename %>"><%= a.asset_typename %></option>
              <% end %>
            </select>
          </div>
          <div class="span3 control-group" style="text-align: left;">
            <div class="mobile">产品简介:</div>
            <blockquote><small class="pname" id="pname" style="font-size: 12px;"><%= @assettype[0].asset_intro %></small></blockquote>
          </div>
          <div class="span2" style="text-align: center;">
            <div class="mobile">资产金额:</div>
            <div class="input-prepend">
              <span class="add-on">￥</span>
              <input class="init-share" name="lnw" id="amount" style="width: 180px;" onkeyup="updatenum(this)" onMouseOver="if(this.value==0){this.value='';}"value="0" type="text">
            </div>
          </div>
          <div class="span1 top5" style="margin-top: 10px;margin-left: 40px;height: 20px;overflow: hidden;"><i class="icon-remove-sign" style="display: none;margin-left: 20px;font-size: 30px;" onclick="removeFounder(this);">&nbsp;&nbsp;</i></div>
        </div>
      </div>
    </div>
    <div class="seperator bottom thick"></div>
    <a data-original-title="Click here to add another company founder" class="xtip pull-right"style="padding: 0 20px 10px 0;" onclick="addFounder(null, false);"> + 添加资产 </a>
  </div>
  <div class="mobile"><br></div>
</div>
<div class="question">
  <div class="well-c well-b">
    <div class="row op-label win">
      <div class="span2">贷款类型</div>
      <div class="span2" style="text-align: left;">总负债</div>
      <div class="span2" style="text-align: left;">每月还贷</div>
      <div class="span2" style="text-align: left;">贷款年限</div>
      <div class="span1"></div>
    </div>
    <div class="seperator thick"></div>
    <div class="found-inputs">

      <div class="op-input first" fid="found">
        <div class="seperator bottom"></div>

        <div class="row">
          <div class="span2 control-group">
            <div class="mobile">贷款类型:</div>
            <select  name="variety" id="debttype" class="found-name" title="贷款类型" style="width: 140px;">
              <% @debttype.each do |d| %>
                  <option value="<%= d.debt_typename %>"><%= d.debt_typename %></option>
              <% end %>
            </select>
          </div>
          <div class="span2 control-group" style="text-align: left;">
            <div class="mobile">总负债:</div>
            <div class="input-prepend">
              <span class="add-on">￥</span>
              <input class="init" name="lnw" id="loan" style="width: 120px;" onkeyup="updatenum(this)" onMouseOver="if(this.value==0){this.value='';}"value="0" type="text">
            </div>
          </div>
          <div class="span2">
            <div class="mobile">每月还贷:</div>
            <div class="input-prepend">
              <span class="add-on">￥</span>
              <input class="repayment" name="lnw" id="repayment" onkeyup="updatenum(this)" style="width: 120px;" type="text">
            </div>
          </div>
          <div class="span2">
            <div class="mobile">贷款年限:</div>
            <input class="period" id="period" style="width: 120px;" type="text">
          </div>
          <div class="span1 top5" style="margin-top: 10px;margin-left: 0;height: 20px;overflow: hidden;"><i class="icon-remove-sign" style="display: none;margin-left: 20px;font-size: 30px;" onclick="removeFounder(this);">&nbsp;&nbsp;</i></div>
        </div>
      </div>
    </div>
    <div class="seperator bottom thick"></div>
    <a data-original-title="Click here to add another company found" class="xtip pull-right"style="padding: 0 20px 10px 0;" onclick="add(null, false);"> + 添加贷款 </a>
  </div>
  <div class="mobile"><br></div>
</div>
<div class="question" style="height: 3830px;">
  <div id="num9" style="padding-right: 80px;height: 3800px;overflow: auto;">
    <table>
      <tr>
        <td>
          <h2>体检简报：</h2>
          <% @moonlite.each do |m| %>
              <% if m.typename=='负翁' %>
                  <div id="level0" class="hide">
                    <p class="q-text"><%=raw m.type_intro %></p>
                    <p class="q-text result" style="color: red;"></p>
                  </div>
              <% elsif m.typename=='重度月光族' %>
                  <div id="level1" class="hide">
                    <p class="q-text"><%=raw m.type_intro %></p>
                    <p class="q-text result" style="color: red;"></p>
                  </div>
              <% elsif m.typename=='中度月光族' %>
                  <div id="level2" class="hide">
                    <p class="q-text"><%=raw m.type_intro %></p>
                    <p class="q-text result" style="color: red;"></p>
                  </div>
              <% elsif m.typename=='轻度月光族' %>
                  <div id="level3" class="hide">
                    <p class="q-text"><%=raw m.type_intro %></p>
                    <p class="q-text result" style="color: red;"></p>
                  </div>
              <% end %>
          <% end %>
          <h2>家庭财务报表分析：</h2>
          <div id="detailedreport">
            <p class="q-text">对家庭财务现状进行体检剖析是家庭理财规划的起点。如果没有健康的财务现状，则一切美好的未来都无从叹气，根据您的家庭财务输入，我们为您绘制了相应比例结构图，并做出了各项结构图的分析：</p>
            <h1 class="h1">1、家庭资产负债表：</h1>
            <p class="q-text">家庭当前经济状况是进行理财规划的常用起始点。家庭资产负债表，又叫净资产表或经济状况表，报告了您的资产和负债情况。</p>
            <p class="q-text">该表可以衡量您向家庭财富积累的进展。每当您发现您的进资产增长，这说明您的经济状况一直在改善。</p>
            <table id="asset" class="table table-striped table-bordered footable">
              <thead>
              <tr class="mobile"><th data-sort-initial="descending" data-class="expand" class="grey">资产项目</th>
                <th data-sort-ignore="true">金额(元)</th>
                <th data-hide="phone" class="grey">负债项目</th>
                <th data-hide="phone">金额(元)</th></tr>
              <tr class="win"><th class="grey">资产项目</th><th>金额(元)</th><th class="grey">负债项目</th><th>金额(元)</th></tr>
              </thead>
              <tbody>
              <tr><td class="grey">&nbsp;</td><td></td><td class="grey"></td><td></td></tr>
              <% for k in 0..@assettype1.size-1 %>
                  <tr class="asset line1<%= k %>"><td class="grey"><%= @assettype1[k].asset_typename %></td><td></td><td class="grey"></td><td></td></tr>
              <% end %>
              <tr class="sum1"><td class="grey right strong">流动资产合计</td><td class="right strong"></td><td class="grey"></td><td></td></tr>
              <% for k in 0..@assettype2.size-1 %>
                  <tr class="asset line2<%= k %>"><td class="grey"><%= @assettype2[k].asset_typename %></td><td></td><td class="grey"></td><td></td></tr>
              <% end %>
              <tr class="sum2"><td class="grey right strong">保本资产合计</td><td class="right strong"></td><td class="grey"></td><td></td></tr>
              <% for k in 0..@assettype3.size-1 %>
                  <tr class="asset line3<%= k %>"><td class="grey"><%= @assettype3[k].asset_typename %></td><td></td><td class="grey"></td><td></td></tr>
              <% end %>
              <tr class="sum3"><td class="grey right strong">投资资产合计</td><td class="right strong"></td><td class="grey"></td><td></td></tr>
              <% for k in 0..@assettype4.size-1 %>
                  <tr class="asset line4<%= k %>"><td class="grey"><%= @assettype4[k].asset_typename %></td><td></td><td class="grey"></td><td></td></tr>
              <% end %>
              <tr class="sum4"><td class="grey right strong">固定资产</td><td class="right strong"></td><td class="grey"></td><td></td></tr>
              <tr><td class="grey">&nbsp;</td><td></td><td class="grey"></td><td></td></tr>
              <tr class="red"><td class="grey right">总资产</td><td class="total0 right"></td><td class="grey right">总负债</td><td class="total1 right"></td></tr>
              <tr class="red"><td class="grey strong right">家庭资产净值</td><td class="total2 right strong"></td><td class="grey"></td><td></td></tr>
              </tbody>
            </table>
            <h1 class="h1">2、家庭现金流量表：</h1>
            <p class="q-text">现金流量表，又称家庭收入和支出表，是对某段时间，例如一个月或一年，现金流入和流出情况的总结。这个报表对于您做家庭财政规划非常有帮助。
              通俗的概括，这张表将告诉您，您的钱到什么地方去了？</p>
            <input type="checkbox" class="hide">
          </div>
        </td>
        <td>
          <div id="percent" style="width: 300px;text-align: center;">
            <div class="percentage" style="margin: 0 auto;" data-percent="0"><span  style="font-size: 20px;font-family: Microsoft YaHei;">0</span>分</div>
            <br>
            <blockquote><small class="intro"></small></blockquote>
            <a class="introduce" href="#myModal6" role="button" data-toggle="modal">分数如何计算得到的？</a>
          </div>
          <p class="q-text tips">资产分布图</p>
          <div id="container3" class="win" style="width: 300px;height: 200px;"></div>
          <div id="container3" class="mobile" style="width: 240px;height: 300px;"></div>
          <p class="q-text tip">资产负债对比</p>
          <div id="container4" class="win" style="width: 300px;height: 200px;"></div>
          <div id="container4" class="mobile" style="width: 240px;height: 300px;"></div>
        </td>
      </tr>
      <tr>
        <td class="detailleft">
          <p class="q-text">月收入开销表</p>
          <table id="detailed" class="table table-striped table-bordered footable">
            <thead>
            <tr class="mobile"><th data-sort-initial="descending" data-class="expand" class="grey">家庭收入项目</th>
              <th data-sort-ignore="true">金额(元)</th>
              <th data-hide="phone" class="grey">家庭支出项目</th>
              <th data-hide="phone">金额(元)</th></tr>
            <tr class="win"><th class="grey">家庭收入项目</th><th>金额(元)</th><th class="grey">家庭支出项目</th><th>金额(元)</th></tr>
            </thead>
            <tr><td class="grey">工资</td><td></td><td class="grey"><%= @expensetype[0].expense_name %></td> <td></td></tr>
            <tr><td class="grey">额外收入</td><td></td><td class="grey"><%= @expensetype[1].expense_name %></td> <td></td></tr>
            <tr><td class="grey">&nbsp;</td><td></td><td class="grey"><%= @expensetype[5].expense_name %></td> <td></td></tr>
            <tr><td class="grey">&nbsp;</td><td></td><td class="grey right">生活必要支出</td><td class="right"></td></tr>
            <tr><td class="grey">&nbsp;</td><td></td><td class="grey"><%= @expensetype[2].expense_name %></td> <td></td></tr>
            <tr><td class="grey">&nbsp;</td><td></td><td class="grey"><%= @expensetype[3].expense_name %></td> <td></td></tr>
            <tr><td class="grey">&nbsp;</td><td></td><td class="grey"><%= @expensetype[4].expense_name %></td> <td></td></tr>
            <tr><td class="grey">&nbsp;</td><td></td><td class="grey"><%= @expensetype[6].expense_name %></td> <td></td></tr>
            <tr><td class="grey">&nbsp;</td><td></td><td class="grey right">消费性支出</td><td class="right"></td></tr>
            <tr><td class="grey">&nbsp;</td><td></td><td class="grey"><%= @debttype[0].debt_typename %></td> <td></td></tr>
            <tr><td class="grey">&nbsp;</td><td></td><td class="grey"><%= @debttype[1].debt_typename %></td> <td></td></tr>
            <tr><td class="grey">&nbsp;</td><td></td><td class="grey"><%= @debttype[2].debt_typename %></td> <td></td></tr>
            <tr><td class="grey">&nbsp;</td><td></td><td class="grey right">贷款支出</td><td class="right"></td></tr>
            <tr><td class="grey">&nbsp;</td>      <td></td> <td class="grey"></td>             <td></td></tr>
            <tr class="red"><td class="grey right">月总收入</td><td class="right"></td><td class="grey right">月总支出</td><td class="right"></td></tr>
            <tr class="red"><td class="grey right strong">家庭月度结余</td><td class="right strong"></td><td class="grey"></td><td></td></tr>
          </table>
        </td>
        <td class="align">
          <p class="q-text tip">月收入开销图</p>
          <div id="container" class="win" style="width: 300px;height: 200px;"></div>
          <div id="container" class="mobile" style="width: 240px;height: 300px;"></div>
          <blockquote><small class="acta2"></small></blockquote>
          <a class="btn btn-primary" id="expense"> 月支配 明细 </a>
        </td>
      </tr>
      <tr>
        <td class="detailleft">
          <p class="q-text">年收入开销表</p>
          <table id="detailannual" class="table table-striped table-bordered footable">
            <thead>
            <tr class="mobile"><th data-sort-initial="descending" data-class="expand" class="grey">家庭收入项目</th>
              <th data-sort-ignore="true">金额(元)</th>
              <th data-hide="phone" class="grey">家庭支出项目</th>
              <th data-hide="phone">金额(元)</th></tr>
            <tr class="win"><th class="grey">家庭收入项目</th><th>金额(元)</th><th class="grey">家庭支出项目</th><th>金额(元)</th></tr>
            </thead>
            <tr><td class="grey">工资</td><td></td><td class="grey">生活必要支出</td><td></td></tr>
            <tr><td class="grey">额外收入</td><td></td><td class="grey">消费性支出</td><td></td></tr>
            <tr><td class="grey">年终奖</td><td></td><td class="grey">贷款支出</td><td></td></tr>
            <tr><td class="grey">其他年终收入</td><td></td><td class="grey"><%= @expenseannual[0].expense_name %></td><td></td></tr>
            <tr><td class="grey">&nbsp;</td><td></td><td class="grey"><%= @expenseannual[1].expense_name %></td><td></td></tr>
            <tr><td class="grey">&nbsp;</td><td></td><td class="grey"><%= @expenseannual[2].expense_name %></td><td></td></tr>
            <tr><td class="grey">&nbsp;</td><td></td><td class="grey"><%= @expenseannual[3].expense_name %></td><td></td></tr>
            <tr><td class="grey">&nbsp;</td><td></td><td class="grey"></td><td></td></tr>
            <tr class="red"><td class="grey right">年度收入</td><td class="right"></td><td class="grey right">年度支出</td><td  class="right"></td></tr>
            <tr class="red"><td class="grey strong right">年结余金额</td><td class="strong right"></td><td class="grey"></td><td></td></tr>
          </table>
        </td>
        <td>
          <div id="container2" class="win" style="width: 300px;height: 300px;"></div>
          <div id="container2" class="mobile" style="width: 240px;height: 300px;"></div>
        </td>
      </tr>
    </table>
    <div class="detailleft">
      <h1 class="h1">3、家庭财务指数：</h1>
      <table id="indicators" class="table table-striped table-bordered footable">
        <thead>
        <tr class="win"><th>家庭财务比率</th><th>定义</th><th>反映情况</th><th>合理范围</th><th>实际比率</th></tr>
        <tr class="mobile"><th data-sort-initial="descending" data-class="expand">家庭财务比率</th>
          <th data-hide="phone">定义</th>
          <th data-hide="phone">反映情况</th>
          <th data-hide="phone">合理范围</th>
          <th data-sort-ignore="true">实际比率</th>
        </tr>
        </thead>
        <% @indicators.each do |i| %>
            <tr>
              <td class="detailed"><%= i.indicators_names %></td>
              <td class="detailed"><%= i.indicators_defination %></td>
              <td class="left"><%=raw i.indicators_intro %></td>
              <% if i.indicators_recomn_max!=nil && i.indicators_recomn_min!=nil %>
                  <td><%= i.indicators_recomn_min %>-<%= i.indicators_recomn_max %></td>
              <% elsif i.indicators_recomn_max==nil && i.indicators_recomn_min!=nil %>
                  <td>><%= i.indicators_recomn_min %></td>
              <% elsif i.indicators_recomn_max!=nil && i.indicators_recomn_min==nil %>
                  <td><<%= i.indicators_recomn_max %></td>
              <% else %>
                  <td></td>
              <% end %>
              <td></td>
            </tr>
        <% end %>
      </table>
    </div>
    <div class="mobile"><br></div>
  </div>
</div>

<input type="hidden" name="rec" value="0.1" tabindex="-1">
</div>
<div id="q-fade-t"></div>
<div id="q-fade-b"></div>
</div>
<div id="q-buttons">
  <button class="q-button light-gray big-button" id="q-back" disabled="disabled">◄&nbsp; <span>上一题</span>&nbsp;</button>
  <button class="q-button orange-button big-button" id="q-next" disabled="disabled">&nbsp;下一题 &nbsp;►</button>
  <button class="q-button orange-button big-button" id="q-submit">风险评估</button>

  <p class="q-privacy">
    <span class="q-privacy-1">这是匿名的，所以你可以如实回答<span class="win">，</span></span>
    <span class="win">我们不会问你的身份识别信息，除非阁下主动联系我们。</span>
  </p>
</div>
</div>
</div>
</div>
</div>

<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>资产体检原理介绍</h3>
  </div>
  <div class="modal-body">
    <% if @blog!=nil %>
        <img class="alignleft size-medium " id="img" src="/assets/BE83E81B-484E-4E7F-B75B-CC39315067D4.png"><br><br>
        <%=raw @blog.barticle %>
    <% end %>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
  </div>
</div>
<div id="myModal2" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>我真的需要应急基金吗？</h3>
  </div>
  <div class="modal-body">
    <% if @blog2!=nil %>
        <img class="alignleft size-medium " id="img" src="/assets/personal-finance.jpg"><br><br>
        <%=raw @blog2.barticle %>
    <% end %>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
  </div>
</div>
<div id="myModal8" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>我真的需要保本性资产吗？</h3>
  </div>
  <div class="modal-body">
    <% if @blog4!=nil %>
        <img class="alignleft size-medium " id="img" src="/assets/20110916496090.jpg"><br><br>
        <%=raw @blog4.barticle %>
    <% end %>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
  </div>
</div>
<div id="myModal3" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 class="h3">月收入支出 明细</h3>
  </div>
  <div class="modal-body">
    <table id="exact2" class="table table-striped table-bordered">
      <thead>
      <tr><th>收入明细</th><th class="win">说明</th><th>金额</th></tr>
      </thead>
      <% for i in 0..@incometype.size-1 %>
          <tr>
            <td><%= @incometype[i].income_name %></td>
            <td class="win"><%= @incometype[i].income_intro %></td>
            <td class="last">
              <div class="input-prepend">
                <span class="add-on">￥</span>
                <input type="text" onkeyup="inva(this);" name="exect" id="income<%= i %>">
              </div>
            </td>
          </tr>
      <% end %>
    </table>
    <table id="exact1" class="table table-striped table-bordered">
      <thead>
      <tr><th>支出明细</th><th class="win">说明</th><th>金额</th><th class="update hide">建议金额</th></tr>
      </thead>
      <% for i in 0..@expensetype.size-1 %>
          <tr>
            <td><%= @expensetype[i].expense_name %></td>
            <td class="win"><%= @expensetype[i].expense_intro %></td>
            <td class="last">
              <div class="input-prepend">
                <span class="add-on">￥</span>
                <input type="text" onkeyup="inva(this);" name="exect" id="expense<%= i %>">
              </div>
            </td>
            <td class="update<%= i %> hide last"></td>
          </tr>
      <% end %>
    </table>
    <a class="xtip update hide" href="#myModal5" role="button" data-toggle="modal"> 为什么这么建议我的各项支出金额？ </a>
  </div>
  <div class="modal-footer">
    <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true" id="sum">确认</button>
  </div>
</div>
<div id="myModal4" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>提示</h3>
  </div>
  <div class="modal-body">
    <p style="color: red;">理想情况下，您应该用25%左右的月收入比例用来投资。</p>
    <p id="text"></p>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true" id="that">就这样</button>
    <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true" id="update">调整</button>
  </div>
</div>
<div id="myModal5" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>为什么这么建议我的各项支出金额？</h3>
  </div>
  <div class="modal-body">
    <% if @blog3!=nil %>
        <img class="alignleft size-medium " id="img" src="/assets/0843A8AE-ADFD-4A53-938B-336712606D5E.png"><br><br>
        <%=raw @blog3.barticle %>
    <% end %>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true" id="open3">关闭</button>
  </div>
</div>
<div id="myModal6" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>分数如何计算得到的？</h3>
  </div>
  <div class="modal-body">
    <% if @blog!=nil %>
        <img class="alignleft size-medium " id="img" src="/assets/BE83E81B-484E-4E7F-B75B-CC39315067D4.png"><br><br>
        <%=raw @blog.barticle %>
    <% end %>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
  </div>
</div>

<script>
    var numfor=/^[-+]?[0-9]+(\.[0-9]+)?$/;
    var tot1= 0,tot2= 0,avge= 0,tot3= 0,mid=0;
    var normal=0; //月收入支出 明细1/2
    <% if @detailedmonth!=nil %>
    var acta= 1;
    <% else %>
    var acta= 0;
    <% end %>
    <% if @detailedannual!=nil %>
    var actb=1; //普通/精确
    <% else %>
    var actb= 0;
    <% end %>
    var srw=[];
    var array1=[],array2=[],array4=[];
    var ie = !-[1,];

    if(ie){
        document.getElementsByClassName = function(){
            var tTagName ="*";
            if(arguments.length > 1){
                tTagName = arguments[1];
            }
            if(arguments.length > 2){
                var pObj = arguments[2]
            }
            else{
                var pObj = document;
            }
            var objArr = pObj.getElementsByTagName(tTagName);
            var tRObj = new Array();
            for(var k=0; k<objArr.length; k++){
                if(objArr[k].className == arguments[0]){
                    tRObj.push(objArr[k]);
                }
            }
            return tRObj;
        }
    }
    <% @assettype.each do |a| %>
    array1.push('<%= a.asset_typename %>');
    <% end %>
    <% @expensetype.each do |a| %>
    array2.push('<%= a.expense_name %>');
    <% end %>
    <% @debttype.each do |a| %>
    array4.push('<%= a.debt_typename %>');
    <% end %>
    $('#jinque').click(function() {
        mid=0;
        normal=0;
        $(".h3").html("月收入支出 明细");
        $("[class*='update']").hide();
        $("#exact2").show();
    })

    $('#update,#expense').click(function() {
        if(normal==1 || this.id=="expense"){

            $(".h3").html("月支出详细调节");
            var exect=document.getElementsByName('exect');
            if(acta==1){
                avge=parseInt(exect[0].value)+parseInt(exect[1].value)+parseInt(exect[2].value);
            }
            else{
                avge=parseInt($("#salary").attr("value").replace(/,/g, ""));
            }
        <% for i in 0..@expensetype.size-1 %>
        <% if @expensetype[i].expense_expect!=nil %>
            $(".update<%= i %>").html(avge*parseFloat('<%= @expensetype[i].expense_expect/100 %>'));
        <% end %>
        <% end %>
            $("[class*='update']").show();
            $("#exact2").hide();
            if(this.id=='expense'){
                mid=1;
                if(acta==0){
                $("#income0").attr("value",$("#salary").attr("value"));
                $("#income1,#income2").attr("value",0);
            }
            }
            else{
                mid=0;
            }
        }
        else{
            mid=0;
            $(".h3").html("月收入支出 明细");
            $("[class*='update']").hide();
            $("#exact2").show();
        }
        $('#myModal3').modal('show');
    })
    $('#open3').click(function() {
        $('#myModal3').modal('show');
    })

    function inva(e){
        if(numfor.test(e.value)==false){
            $("#"+e.id).addClass('invalid');
        }
        else{
            $("#"+e.id).removeClass('invalid');
        }
    }
</script>


<script type="text/javascript">
    //平台、设备和操作系统
    var system ={
        win : false,
        mac : false,
        xll : false
    };
    //检测平台
    var p = navigator.platform;
    system.win = p.indexOf('Win') == 0;
    system.mac = p.indexOf('Mac') == 0;
    system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);
    //跳转语句
    if(system.win||system.mac||system.xll){
        $(".mobile").remove();
    }else{
        $(".win").remove();
    }
</script>

<script>
    _gaq = [["_setAccount","UA-1329988-4"],["_trackPageview"]];
    w.requestId = "1092152607";

    function updatenum(e){
        var val = amountFromDom(e);
        if (val != null) {
            e.value = w.formatNum(val, 0);
        }
    }

    function updateintro(e){
        var pid=e.id.replace('variety','pname')
    <% @assettype.each do |a| %>
        if('<%= a.asset_typename %>'== e.value){
            $("#"+pid).html('<%= a.asset_intro %>')
        }
    <% end %>
    }

    $(function(){
        window.onerror = function(error, url, lineNumber) {
            var payload = {"rev": "80126", "error": error, "agent": navigator.userAgent, "stack": []};

            // begin ie9 only stack trace grabbing
            var value = arguments.callee;
            for(i=0; i!=10; ++i) {
                if(value.caller) {
                    payload.stack.push(value.caller.toString());
                    value = value.caller;
                }
            }

            if (!w.jsErrors[payload]) {
                w.jsErrors[payload] = true;
                w.trackESP("ClientSideError", location.href, JSON.stringify(payload));
            }

            return false;
        }
        $.each(onReady.fns, function(i,f) {f()});
    });
</script>

<script>
    var variety,amount,jixu,total,xian,feng,wen,level='',bili= 0,debttype,loan,repayment,period;
    var xianjin= 0,wenjian= 0,fengxian=0;
    var mea1= 0,mea2= 0,mea3= 0,mea4= 0,mea5= 0,mea6= 0,mea7= 0,arr= 0,bi=0;
    var arrayObj = new Array();


    $('#that').click(function() {
        showQn(6,'',1);
    });

    $('#sum').click(function() {
        var exect=document.getElementsByName('exect');
        if(mid==0){
            for(i=0;i<exect.length;i++){
                if(numfor.test(exect[i].value)==false){
                    $("#"+exect[i].id).addClass('invalid');
                    return false;
                }
                else{
                    $("#"+exect[i].id).removeClass('invalid');
                }
            }
        }
        else{
            for(i=3;i<exect.length;i++){
                if(numfor.test(exect[i].value)==false){
                    $("#"+exect[i].id).addClass('invalid');
                    return false;
                }
                else{
                    $("#"+exect[i].id).removeClass('invalid');
                }
            }
        }

        if(acta==0 && mid==1){
            var income1=parseInt($("#salary").attr("value").replace(/,/g, ""));
            var income2=0;
            var income3=0;
        }
        else{
            var income1=exect[0].value;
            var income2=exect[1].value;
            var income3=exect[2].value;
        }

        $.post("/usersurvey/userdatadetailedmonth",{username:'<%= session[:webusername] %>',expense1:exect[3].value,expense2:exect[4].value,expense3:exect[5].value,expense4:exect[6].value,expense5:exect[7].value,expense6:exect[8].value,expense7:exect[9].value,income1:income1,income2:income2,income3:income3,mid:mid},function(data){
            var datas=data.split(",");
            if(mid==0){
                if(normal==1){
                    showQn(6,'',1);
                }
                else if(parseInt(datas[0])>30){
                    $("#text").html('而现在，您用的是<span style="color: red;">'+datas[0]+'%</span>的月收入比例，您会不会对自己过去苛刻了点？过于苛刻也许会让您无法长久的实施该计划，您觉得呢？')
                    $("#update").html('调整');
                    $('#myModal4').modal('show')
                    normal=1;
                }
                else if(parseInt(datas[0])<20){
                    if(parseInt(datas[0])>=0){
                    $("#text").html('而现在，您用的是<span style="color: red;">'+datas[0]+'%</span>的月收入比例，会不会有点消费过度？您觉得呢？')
                    }
                    else{
                        $("#text").html('而现在，您月消费金额超过您的月收入，您肯定是消费过度。')
                    }
                    $("#update").html('调整');
                    $('#myModal4').modal('show')
                    normal=1;
                }
                else{
                    showQn(6,'',1);
                }
            }
            else{
                showQn(9,'',2);
            }
            $("#salary").attr("value",datas[1]);
            document.getElementById("salary").disabled=true;
            $("#rent").attr("value",datas[2]);
            document.getElementById("rent").disabled=true;
            $("#wages").attr("value",datas[3]);
            document.getElementById("wages").disabled=true;
            bi=data;
        });

        avge=parseInt(exect[0].value)+parseInt(exect[1].value)+parseInt(exect[2].value);          //1
        tot1=avge*12;
        tot2=parseInt(exect[3].value)+parseInt(exect[4].value)+parseInt(exect[5].value)+parseInt(exect[6].value)+parseInt(exect[7].value)+parseInt(exect[8].value)+parseInt(exect[9].value)
        tot3=0;
        if('<%= @hash2[100][0]%>'=='must_expense'){tot3=tot3+parseInt(exect[3].value);}
        if('<%= @hash2[200][0]%>'=='must_expense'){tot3=tot3+parseInt(exect[4].value);}
        if('<%= @hash2[300][0]%>'=='must_expense'){tot3=tot3+parseInt(exect[5].value);}
        if('<%= @hash2[400][0]%>'=='must_expense'){tot3=tot3+parseInt(exect[6].value);}
        if('<%= @hash2[500][0]%>'=='must_expense'){tot3=tot3+parseInt(exect[7].value);}
        if('<%= @hash2[600][0]%>'=='must_expense'){tot3=tot3+parseInt(exect[8].value);}
        if('<%= @hash2[700][0]%>'=='must_expense'){tot3=tot3+parseInt(exect[9].value);}
        acta=1;
    });

    var $qv = $("#questionnaire-view");
    var $qr = $("#questionnaire");
    var accountMin = 0;

    $("#questionnaire-view .ktip-link").bind("tip.show", function() {
        w.trackEvent("OFA", "questionnaire_faq_show", this.id);
    });

    $("#q-numbers").delegate(".q-num.past", "click", function() {
        var $i = $qr.find(".invalid");
        if ($i.length) {
            $i.focus().select();
        } else {
            showQn($(this).index());
        }
    });

    $(document).ready(function(){
        <% if session[:webusername]==nil %>
        location.href="/sales/login?start=1";
        <% end %>

        <% if session[:webusername]!=nil %>
        <% if @webuser.age!=nil %>$("#age").attr("value",parseInt('<%= @webuser.age %>'));<% end %>
        <% if @webuser.sex!=nil %>$("#sex").attr("value",'<%= @webuser.sex %>');<% end %>
        <% if @userdatamonth!=nil %>
        <% if @userdatamonth.income!=nil %>$("#salary").attr("value",parseInt('<%= @userdatamonth.income %>'));<% end %>
        <% if @userdatamonth.must_expense!=nil %>$("#rent").attr("value",parseInt('<%=  @userdatamonth.must_expense %>'));<% end %>
        <% if @userdatamonth.invest_expense!=nil %>$("#wages").attr("value",parseInt('<%= @userdatamonth.invest_expense %>'));<% end %>
        <% end %>
        <% if @userdateannual!=nil %>
        <% if @userdateannual.income_annual!=nil %>$("#incomeannual").attr("value",parseInt('<%= @userdateannual.income_annual %>'));<% end %>
        <% if @userdateannual.expense_annual!=nil %>$("#expenseannual").attr("value",parseInt('<%=  @userdateannual.expense_annual %>'));<% end %>
        <% end %>
        <% if @detailedannual!=nil %>
        <% if @detailedannual.income1_account!=nil %>$("#in0").attr("value",parseInt('<%= @detailedannual.income1_account %>'));<% end %>
        <% if @detailedannual.income2_account!=nil %>$("#in1").attr("value",parseInt('<%= @detailedannual.income2_account %>'));<% end %>
        <% if @detailedannual.income3_account!=nil %>$("#in2").attr("value",parseInt('<%= @detailedannual.income3_account %>'));<% end %>
        <% if @detailedannual.expense1_account!=nil %>$("#expen0").attr("value",parseInt('<%=  @detailedannual.expense1_account %>'));<% end %>
        <% if @detailedannual.expense2_account!=nil %>$("#expen1").attr("value",parseInt('<%=  @detailedannual.expense2_account %>'));<% end %>
        <% if @detailedannual.expense3_account!=nil %>$("#expen2").attr("value",parseInt('<%=  @detailedannual.expense3_account %>'));<% end %>
        <% if @detailedannual.expense4_account!=nil %>$("#expen3").attr("value",parseInt('<%=  @detailedannual.expense4_account %>'));<% end %>
        <% end %>
        <% if @detailedmonth!=nil %>
        <% for i in 0..@incometype.size-1 %>
        <% if i==0 %>
        <% if @detailedmonth.income1_account!=nil %>$("#income0").attr("value",parseInt('<%= @detailedmonth.income1_account %>'));<% end %>
        <% elsif i==1 %>
        <% if @detailedmonth.income2_account!=nil %>$("#income1").attr("value",parseInt('<%= @detailedmonth.income2_account %>'));<% end %>
        <% elsif i==2 %>
        <% if @detailedmonth.income3_account!=nil %>$("#income2").attr("value",parseInt('<%= @detailedmonth.income3_account %>'));<% end %>
        <% end %>
        <% end %>
        <% for i in 0..@expensetype.size-1 %>
        <% if i==0 %>
        <% if @detailedmonth.expense1_account!=nil %>$("#expense0").attr("value",parseInt('<%= @detailedmonth.expense1_account %>'));<% end %>
        <% elsif i==1 %>
        <% if @detailedmonth.expense2_account!=nil %>$("#expense1").attr("value",parseInt('<%= @detailedmonth.expense2_account %>'));<% end %>
        <% elsif i==2 %>
        <% if @detailedmonth.expense3_account!=nil %>$("#expense2").attr("value",parseInt('<%= @detailedmonth.expense3_account %>'));<% end %>
        <% elsif i==3 %>
        <% if @detailedmonth.expense4_account!=nil %>$("#expense3").attr("value",parseInt('<%= @detailedmonth.expense4_account %>'));<% end %>
        <% elsif i==4 %>
        <% if @detailedmonth.expense5_account!=nil %>$("#expense4").attr("value",parseInt('<%= @detailedmonth.expense5_account %>'));<% end %>
        <% elsif i==5 %>
        <% if @detailedmonth.expense6_account!=nil %>$("#expense5").attr("value",parseInt('<%= @detailedmonth.expense6_account %>'));<% end %>
        <% elsif i==6 %>
        <% if @detailedmonth.expense7_account!=nil %>$("#expense6").attr("value",parseInt('<%= @detailedmonth.expense7_account %>'));<% end %>
        <% end %>
        <% end %>
        <% end %>

        var first=0;
        <% if @userassetsheet!=nil %>
        var array0=[<%= @userassetsheet.asset1_account %>,<%= @userassetsheet.asset2_account %>,<%= @userassetsheet.asset3_account %>,
            <%= @userassetsheet.asset4_account %>,<%= @userassetsheet.asset5_account %>,<%= @userassetsheet.asset6_account %>,
            <%= @userassetsheet.asset7_account %>,<%= @userassetsheet.asset8_account %>,<%= @userassetsheet.asset9_account %>,<%= @userassetsheet.asset10_account %>]
        for(i=0;i<10;i++){
            if(array0[i]!=0){
                if(first==0){
                    $("#variety").attr("value",array1[i])
                    $("#amount").attr("value",array0[i])
                <% @assettype.each do |a| %>
                    if('<%= a.asset_typename %>'==array1[i]){
                        $("#pname").html('<%= a.asset_intro %>')
                    }
                <% end %>
                }
                else{
                    addFounder(null, false);
                    $("#variety"+first).attr("value",array1[i])
                    $("#amount"+first).attr("value",array0[i]);
                <% @assettype.each do |a| %>
                    if('<%= a.asset_typename %>'==array1[i]){
                        $("#pname"+first).html('<%= a.asset_intro %>')
                    }
                <% end %>
                }
                first=first+1;
            }
        }
        <% end %>
        var second=first;
        <% if @userdebtsheet!=nil %>
        var array3=[[<%= @userdebtsheet.debt1_account_totally %>,<%= @userdebtsheet.debt1_account_monthly %>,<%= @userdebtsheet.debt1_years %>],
            [<%= @userdebtsheet.debt2_account_totally %>,<%= @userdebtsheet.debt2_account_monthly %>,<%= @userdebtsheet.debt2_years %>],
            [<%= @userdebtsheet.debt99_account_totally %>,<%= @userdebtsheet.debt99_account_monthly %>,<%= @userdebtsheet.debt99_years %>]]
        for(i=0;i<3;i++){
            if(array3[i][0]!=0){
                if(first==second){
                    $("#debttype").attr("value",array4[i])
                    $("#loan").attr("value",array3[i][0])
                    $("#repayment").attr("value",array3[i][1])
                    $("#period").attr("value",array3[i][2])
                }
                else{
                    add(null, false);
                    $("#debttype"+(first-1).toString()).attr("value",array4[i])
                    $("#loan"+(first-1).toString()).attr("value",array3[i][0])
                    $("#repayment"+(first-1).toString()).attr("value",array3[i][1])
                    $("#period"+(first-1).toString()).attr("value",array3[i][2])
                }
                first=first+1;
            }
        }
        <% end %>

        <% end %>
        initPieChart();
        showQn(5,'','load');
        showQn(6,'','load');
        showQn(7,'','load');
        showQn(8,'','load');
        showQn(9,'','load');
        showQn(0,'','load');
    });

    $qr.data("vals", valsFromDom($qr.find("input")))
            .data("init", function(doCalc) {
                $qr.data("init", function() { showQn(0, true); })
                        .keydown(function(e) {
                            if ($qr.data("transition")) {
                                return false;
                            }
                            if (e.keyCode == 9 || e.keyCode == 13 && !e.shiftKey) {
                                var $b = $(e.shiftKey ? "#q-back" :
                                        ("#q-next:visible" + (e.keyCode == 13 ? ",#q-submit:visible" : "")));
                                if ($b.is(":enabled")) {
                                    e.preventDefault();
                                    $b.triggerHandler("click");
                                }
                            }
                        })
                        .find("a[href]").attr("tabindex", "-1").end()
                        .find("input").attr("tabindex", "-1")
                        .filter("[type=radio]").click(function(e) {
                            this.focus();
                            updateButtons(e, this, true);
                            if (this.value !== $qr.data("vals")[this.name]) {
                                calculateRiskTol();
                            }
                        }).end()
                        .filter("[type=checkbox]").click(function(e) {
                            this.focus();
                            updateButtons(e, this, true);
                            if (this.value !== $qr.data("vals")[this.name]) {
                                calculateRiskTol();
                            }
                        }).end()
                        .filter("[name=age]").each(function(){
                            // jquery does not yet support on input
                            this.oninput = function(e) {
                                $(this).keypress();
                            }
                        }).bind("keypress keyup", function(e) {
                            var raw = this.value, val = ageFromDom(this), done = val != null;
                            $(this).toggleClass("invalid", !!raw && !done);
                            updateButtons(e, this, done);
                            if (val !== $qr.data("vals")[this.name]) {
                                calculateRiskTol();
                            }
                        }).end()
                        .filter("[name=lnw]").bind("keypress keyup", function(e) {
                            var raw = this.value, val = amountFromDom(this), done = val != null && val >= accountMin;
                            $(this).toggleClass("invalid", !!raw && !done);
                            if(this.id=='salary'|| this.id=='rent' || this.id=='wages'){
                                if($("#salary").attr("value")=="" || $("#rent").attr("value")=="" || $("#wages").attr("value")==""){
                                    done=false;
                                }
                                if(this.id=='rent'){
                                    $("#rents").html(parseFloat($("#rent").attr("value").replace(/,/g,'')));
                                    $("#xian").html(parseFloat($("#rent").attr("value").replace(/,/g,''))*3);
                                }
                            }
                            updateButtons(e, this, done);
                            if (val !== $qr.data("vals")[this.name]) {
                                calculateRiskTol();
                            }
                            if (done && this.selectionStart === raw.length) {
                                this.value = w.formatNum(val, 0);
                            }
                        }).blur(function() {
                            var val = amountFromDom(this);
                            if (val != null) {
                                this.value = w.formatNum(val, 0);
                            }
                        });

                $("#q-back,#q-next").click(function(e) {
                    $("html,body").animate({"scrollTop":"0"},"slow")
                    var back = this.id == "q-back";
                    if (back) {
                        w.trackEvent("OFA", "questionnaire_back");
                    } else {
                        w.trackEvent("OFA", "questionnaire_next", qPayload());
                    }
                    var new_q_num = $qr.data("q") + (back ? -1 : 1);
                    showQn(new_q_num);
                });
                $("#q-submit").click(function(e) {
                    if(acta==1){

                        var salary= avge;
                        var rent= tot3;
                        var wages= avge-tot2;
                        if(level==4){
                            var score=run();
                        }
                        else{
                            var score=0;
                        }
                        $.post("/usersurvey/savescore2",{username:'<%= session[:webusername] %>',score:score,amount:amounts,variety:varietys,age:$("#age").attr("value"),arr:arr.toFixed(4),
                            salary:salary,rent:rent,wages:wages,xian:xian,wen:wen,feng:feng,acta:1,level:level,meals:$("#meals").attr("value"),fare:$("#fare").attr("value"),shop:$("#shop").attr("value"),taste:$("#taste").attr("value"),education:$("#education").attr("value"),
                            family:$("#family").attr("value"),intercourse:$("#intercourse").attr("value"),income1:$("#income1").attr("value"),income2:$("#income2").attr("value"),income3:$("#income3").attr("value"),
                            income4:$("#income4").attr("value"),income5:$("#income5").attr("value"),income6:$("#income6").attr("value"),income7:$("#income7").attr("value"),income8:$("#income8").attr("value"),
                            income9:$("#income9").attr("value"),income10:$("#income10").attr("value"),income11:$("#income11").attr("value"),income12:$("#income12").attr("value")},function(data){
                            location.href='/usersurvey/measure/2';
                        });
                    }
                    else{
                    <% if session[:webusername]!=nil %>
                        $.post("/usersurvey/savescore",{username:'<%= session[:webusername] %>',score:score,amount:amounts,variety:varietys,age:$("#age").attr("value"),arr:arr.toFixed(4),
                            xian:xian,wen:wen,feng:feng,acta:0,level:level},function(data){
                            location.href='/usersurvey/measure/2';
                        });
                    <% end %>
                    }
                });
                function qPayload() {
                    var $n = $qr.find("input[tabindex=0]").filter(":checked");
                    if (!$n.length) {
                        $n = $n.end();
                    }
                    return $n.attr("name") + ":" + $n.val();
                }

                showQn(0);
                if (doCalc) {
                    calculateRiskTol();
                }
            });

    var num=0;num2=0,num3=0,num4=0;
    function showQn(i, immediately,e,annual) {
        if(num4==4){
            $.post("/usersurvey/saveage",{username:'<%= session[:webusername] %>',age:$("#age").attr("value"),sex:$("#sex").attr("value")},function(data){
            });
        }
        else if(num4==5){
            if(acta==0){
                $.post("/usersurvey/userdatamonth",{username:'<%= session[:webusername] %>',salary:$("#salary").attr("value").replace(/,/g, ""),rent:$("#rent").attr("value").replace(/,/g, ""),wages:$("#wages").attr("value").replace(/,/g, "")},function(data){
                });
            }
        }
        else if(num4==6){
            var exect=document.getElementsByName('exect2');

            $.post("/usersurvey/userdatadetailedannual",{username:'<%= session[:webusername] %>',income1:exect[0].value.replace(/,/g, ""),income2:exect[1].value.replace(/,/g, ""),income3:exect[2].value.replace(/,/g, ""),expense1:exect[3].value.replace(/,/g, ""),expense2:exect[4].value.replace(/,/g, ""),expense3:exect[5].value.replace(/,/g, ""),expense4:exect[6].value.replace(/,/g, "")},function(data){
            });
        }
        else if(num4==7){
            variety=document.getElementsByClassName("founder-name")  //资产品种
            amount=document.getElementsByClassName("init-share")  //资产金额
            arrayObj = [0,0,0,0,0,0,0,0,0,0];
            for(j=0;j<variety.length;j++){
                var ccc=amount[j].value.replace(/,/g, "");
                if(ccc==''){ccc=0;}
            <% for k in 0..@assettype.size-1 %>
                if('<%= @assettype[k].asset_typename %>'==variety[j].value){
                    arrayObj[<%= k %>]=arrayObj[<%= k %>]+parseFloat(ccc);
                }
            <% end %>
            }

            $.post("/usersurvey/userassetsheet",{username:'<%= session[:webusername] %>',asset1_account:arrayObj[0],asset2_account:arrayObj[1],asset3_account:arrayObj[2],asset4_account:arrayObj[3],asset5_account:arrayObj[4],asset6_account:arrayObj[5],asset7_account:arrayObj[6],asset8_account:arrayObj[7],asset9_account:arrayObj[8],asset10_account:arrayObj[9]},function(data){
                $("#indicators tr:eq(11) td:eq(4)").html(data.split(",")[0]);
                $("#indicators tr:eq(12) td:eq(4)").html(data.split(",")[1]);
                $("#indicators tr:eq(13) td:eq(4)").html(data.split(",")[2]);
            });
        }
        else if (num4==8){
            debttype=document.getElementsByClassName("found-name")  //贷款类型
            loan=document.getElementsByClassName("init")  //总负债
            repayment=document.getElementsByClassName("repayment")  //每月还贷
            period=document.getElementsByClassName("period")  //贷款年限
            var arrayObj0 = [[0,0,0],[0,0,0],[0,0,0]];

            for(k=0;k<debttype.length;k++){
                var c1=loan[k].value.replace(/,/g, "");
                var c2=repayment[k].value.replace(/,/g, "");
                if(c1==''){c1=0;}
                if(c2==''){c2=0;}
            <% for k in 0..@debttype.size-1 %>
                if('<%= @debttype[k].debt_typename %>'==debttype[k].value){
                    arrayObj0[<%= k %>][0]=arrayObj0[<%= k %>][0]+parseFloat(c1);
                    arrayObj0[<%= k %>][1]=arrayObj0[<%= k %>][1]+parseFloat(c2);
                    arrayObj0[<%= k %>][2]=arrayObj0[<%= k %>][2]+parseFloat(period[k].value);
                }
            <% end %>
            }
            $.post("/usersurvey/userdebtsheet",{username:'<%= session[:webusername] %>',debt1_account_totally:arrayObj0[0][0],debt1_account_monthly:arrayObj0[0][1],debt1_years:arrayObj0[0][2],
                debt2_account_totally:arrayObj0[1][0],debt2_account_monthly:arrayObj0[1][1],debt2_years:arrayObj0[1][2],debt99_account_totally:arrayObj0[2][0],debt99_account_monthly:arrayObj0[2][1],debt99_years:arrayObj0[2][2]},function(data){
                $("#indicators tr:eq(6) td:eq(4)").html(data.toFixed(2));
            });
        }
        num4=i;
        //if(e==1){复杂输入}
        if(i==0){$("#title").html("资产体检 系统介绍");}
        if(i==1){$("#title").html("流动性资产 介绍");}
        if(i==2){$("#title").html("保本型资产 介绍");}
        if(i==3){$("#title").html("风险型资产 介绍");}
        if(i==4){$("#title").html("基本信息");}
        if(i==5){$("#title").html("月收入支出");num=1;}else if(i!=6){num=0;}
        if(i==6){
            if(e!=1){
                if(num==1){
                    var a1=parseInt($("#wages").attr("value").replace(/,/g, ""));
                    var a2=parseInt($("#salary").attr("value").replace(/,/g, ""));
                    var a3=parseInt($("#rent").attr("value").replace(/,/g, ""));
                    srw=[a2,a3,a1]
                    bi=parseInt(a1/a2*100);
                    if(bi>30){
                        $("#text").html('而现在，您用的是<span style="color: red;">'+bi+'%</span>的月收入比例，您会不会对自己过去苛刻了点？过于苛刻也许会让您无法长久的实施该计划，您觉得呢？')
                        $("#update").html('精确输入');
                        if(e!='load'){$('#myModal4').modal('show');}
                        normal=2;
                        return false;
                    }
                    else if(bi<20){
                        if(bi>=0){
                            $("#text").html('而现在，您用的是<span style="color: red;">'+bi+'%</span>的月收入比例，会不会有点消费过度？您觉得呢？')
                        }
                        else{
                            $("#text").html('而现在，您月消费金额超过您的月收入，您肯定是消费过度。')
                        }
                        $("#update").html('精确输入');
                        if(e!='load'){$('#myModal4').modal('show');}
                        normal=2;
                        return false;
                    }
                }
            }
            $("#title").html("年收入支出");
        }
        if(i==7){
            $("#title").html("已有资产情况");
            num2=1;
        }
        else if(i!=8){
            num2=0;
        }

        if(i==8){                                                              //2
            if(num2==1){
                variety=document.getElementsByClassName("founder-name")  //资产品种
                amount=document.getElementsByClassName("init-share")  //资产金额
                $.post("/usersurvey/step8",{username:'<%= session[:webusername] %>'},function(data){
                    var datas=data.split(",");
                    xianjin=datas[0];
                    wenjian=datas[1];
                    fengxian=datas[2];

                    for(j=0;j<variety.length;j++){
                        var ccc=amount[j].value.replace(/,/g, "");
                        if(ccc==''){ccc=0;}
                        if(variety[j].value=="银行活期"){mea1=mea1+parseFloat(ccc)}
                        else if(variety[j].value=="银行定期"){mea4=mea4+parseFloat(ccc)}
                        else if(variety[j].value=="银行理财产品"){mea3=mea3+parseFloat(ccc)}
                        else if(variety[j].value=="货币基金"){mea2=mea2+parseFloat(ccc)}
                        else if(variety[j].value=="股票及同类基金"){mea6=mea6+parseFloat(ccc)}
                        else if(variety[j].value=="债券及同类基金"){mea5=mea5+parseFloat(ccc)}
                        else if(variety[j].value=="其它"){mea7=mea7+parseFloat(ccc)}
                        if(j==0){
                            varietys=variety[j].value;
                            amounts=ccc;
                        }
                        else{
                            varietys=varietys+','+variety[j].value;
                            amounts=amounts+','+ccc;
                        }
                    }

                    jixu=parseInt(datas[0])+parseInt(datas[1])+parseInt(datas[2]);//积蓄
                    if(acta==0){
                        total=parseInt((parseFloat($("#wages").attr("value").replace(/,/g, ""))*12+jixu)/100)*100;//总资产
                        xian=parseInt((parseFloat($("#rent").attr("value").replace(/,/g, ""))*3)/100)*100;
                    }
                    else{
                        total=parseInt((tot1+jixu)/100)*100;//总资产
                        xian=parseInt((parseFloat(tot3)*3)/100)*10;
                    }
                    feng=parseInt((total*(80-parseFloat($("#age").attr("value").replace(/,/g, "")))/100)/100)*100;
                    wen=total-xian-feng;
                    arr=parseFloat('<%= @hash["活期存款"][0] %>')*mea1/jixu+parseFloat('<%= @hash["货币基金"][0] %>')*mea2/jixu+parseFloat('<%= @hash["银行理财产品"][0] %>')*mea3/jixu+parseFloat('<%= @hash["定期存款"][0] %>')*mea4/jixu+
                            parseFloat('<%= @hash["债券基金"][0] %>')*mea5/jixu+parseFloat('<%= @hash["股票型基金"][0] %>')*mea6/jixu+0.03*mea7/jixu;
                });
            }
            $("#title").html("资产净值估算-负债");
            num3=1;
        }
        else if(i!=9){
            num3=0;
        }
        if(i==9){
            var test_div=document.getElementById("questionnaire-view");
            test_div.style.width="108%";
            test_div.style.height="3860px";

            var test_div=document.getElementsByClassName("question");
            for(k=0;k<test_div.length-1;k++){
                test_div[k].style.height="296px";
            }

            var arrayObj0 = [[0,0],[0,0],[0,0]];
            $.post("/usersurvey/step9",{username:'<%= session[:webusername] %>'},function(data){
                arrayObj0=[[parseInt(data[0][0]),parseInt(data[0][1])],[parseInt(data[0][2]),parseInt(data[0][3])],[parseInt(data[0][4]),parseInt(data[0][5])]];
                var salarymonth=0;//每月工资
                var debtmonth=parseInt(arrayObj0[0][1])+parseInt(arrayObj0[1][1])+parseInt(arrayObj0[2][1]); //每月还贷
                var mustmonth=0; //每月必要开销
                var funmonth=0; //每月零花娱乐开销

                if(acta==1){
                    $("#expense").html("调整月收入支配");
                    var acta2="";
                    <% for i in 0..@expensetype.size-1 %>
                    if(acta2==""){
                        if(parseInt(data[1][<%= i+3 %>])>parseInt(data[1][<%= i+10 %>])){
                            acta2=acta2+'<%= @expensetype[i].expense_name %>开销 略显偏高<br>'
                        }
                    }
                    else{
                        if(parseInt(data[1][<%= i+3 %>])>parseInt(data[1][<%= i+10 %>])){
                            acta2=acta2+'<span style="padding-left: 15px;"><%= @expensetype[i].expense_name %>开销 略显偏高</span><br>'
                    }
                    }
                     <% end %>

                    $(".acta2").html(acta2);
                    salarymonth=parseInt(data[1][0])+parseInt(data[1][1])+parseInt(data[1][2]);
                    mustmonth=parseInt(data[1][3])+parseInt(data[1][4])+parseInt(data[1][8]);
                    funmonth=parseInt(data[1][5])+parseInt(data[1][6])+parseInt(data[1][7])+parseInt(data[1][9]);
                    $("#detailed tr:eq(1) td:eq(1)").html(parseInt(data[1][0])+parseInt(data[1][1]));
                    $("#detailed tr:eq(2) td:eq(1)").html(parseInt(data[1][2]));
                    $("#detailed tr:eq(1) td:eq(3)").html(parseInt(data[1][3]));
                    $("#detailed tr:eq(2) td:eq(3)").html(parseInt(data[1][4]));
                    $("#detailed tr:eq(3) td:eq(3)").html(parseInt(data[1][8]));
                    $("#detailed tr:eq(4) td:eq(3)").html(mustmonth);
                    $("#detailed tr:eq(5) td:eq(3)").html(parseInt(data[1][5]));
                    $("#detailed tr:eq(6) td:eq(3)").html(parseInt(data[1][6]));
                    $("#detailed tr:eq(7) td:eq(3)").html(parseInt(data[1][7]));
                    $("#detailed tr:eq(8) td:eq(3)").html(parseInt(data[1][9]));
                    $("#detailed tr:eq(9) td:eq(3)").html(funmonth);
                    $("#detailed tr:eq(10) td:eq(3)").html(parseInt(data[0][1]));
                    $("#detailed tr:eq(11) td:eq(3)").html(parseInt(data[0][3]));
                    $("#detailed tr:eq(12) td:eq(3)").html(parseInt(data[0][5]));
                    $("#detailed tr:eq(13) td:eq(3)").html(debtmonth);
                    $("#detailed tr:eq(15) td:eq(1)").html(salarymonth);
                    $("#detailed tr:eq(15) td:eq(3)").html(mustmonth+funmonth+debtmonth);
                    $("#detailed tr:eq(16) td:eq(1)").html(salarymonth-mustmonth-funmonth-debtmonth);
                    $("#indicators tr:eq(1) td:eq(4)").html(((salarymonth-mustmonth-funmonth-debtmonth)/salarymonth).toFixed(2));
                    $("#indicators tr:eq(2) td:eq(4)").html(((parseInt(data[1][0])+parseInt(data[1][1]))/salarymonth).toFixed(2));
                    $("#indicators tr:eq(3) td:eq(4)").html((mustmonth/salarymonth).toFixed(2));
                    $("#indicators tr:eq(4) td:eq(4)").html((funmonth/(mustmonth+funmonth)).toFixed(2));
                    $("#indicators tr:eq(5) td:eq(4)").html(((salarymonth-mustmonth-funmonth-debtmonth)/salarymonth).toFixed(2));
                    $("#indicators tr:eq(10) td:eq(4)").html((debtmonth/salarymonth).toFixed(2));

                    if(salarymonth<mustmonth+funmonth || parseInt($("#detailed tr:eq(16) td:eq(1)").html())<0){
                        level=1;
                    }
                    else if(jixu+salarymonth*12<xian){
                        level=2;
                    }
                    else if(jixu+salarymonth*12<xian+feng){
                        level=3;
                    }
                    else{
                        level=4;
                    }
                }
                else{
                    $("#expense").html("月支配 明细");
                    $(".acta2").html("因为月支出数据太少，可能会导致分析不够完整。请点击下面按钮进行完善。");
                    salarymonth=parseInt(data[2][0]);
                    mustmonth=parseInt(data[2][1]);
                    funmonth=parseInt(data[2][2]);
                    $("#detailed tr:eq(1) td:eq(1)").html(parseInt(data[2][0]));
                    $("#detailed tr:eq(2) td:eq(1)").html(0);
                    $("#detailed tr:eq(1) td:eq(3)").html('--');
                    $("#detailed tr:eq(2) td:eq(3)").html('--');
                    $("#detailed tr:eq(3) td:eq(3)").html('--');
                    $("#detailed tr:eq(4) td:eq(3)").html(parseInt(data[2][1]));
                    $("#detailed tr:eq(5) td:eq(3)").html('--');
                    $("#detailed tr:eq(6) td:eq(3)").html('--');
                    $("#detailed tr:eq(7) td:eq(3)").html('--');
                    $("#detailed tr:eq(8) td:eq(3)").html('--');
                    $("#detailed tr:eq(9) td:eq(3)").html(parseInt(data[2][2]));
                    $("#detailed tr:eq(10) td:eq(3)").html(parseInt(data[0][1]));
                    $("#detailed tr:eq(11) td:eq(3)").html(parseInt(data[0][3]));
                    $("#detailed tr:eq(12) td:eq(3)").html(parseInt(data[0][5]));
                    $("#detailed tr:eq(13) td:eq(3)").html(parseInt(data[2][2]));
                    $("#detailed tr:eq(15) td:eq(1)").html(parseInt(data[2][0]));
                    $("#detailed tr:eq(15) td:eq(3)").html(parseInt(data[2][1])+parseInt(data[2][2])+debtmonth);
                    $("#detailed tr:eq(16) td:eq(1)").html(parseInt(data[2][3])-debtmonth);
                    $("#indicators tr:eq(1) td:eq(4)").html(((parseInt(data[2][3])-debtmonth)/parseInt(data[2][0])).toFixed(2));
                    $("#indicators tr:eq(2) td:eq(4)").html(1);
                    $("#indicators tr:eq(3) td:eq(4)").html((parseInt(data[2][1])/parseInt(data[2][0])).toFixed(2));
                    $("#indicators tr:eq(4) td:eq(4)").html((parseInt(data[2][2])/(parseInt(data[2][1])+parseInt(data[2][2]))).toFixed(2));
                    $("#indicators tr:eq(5) td:eq(4)").html(((parseInt(data[2][3])-debtmonth)/parseInt(data[2][0])).toFixed(2));
                    $("#indicators tr:eq(10) td:eq(4)").html((debtmonth/parseInt(data[2][0])).toFixed(2));

                    if(salarymonth<mustmonth+funmonth || parseInt($("#detailed tr:eq(16) td:eq(1)").html())<0){
                        level=1;
                    }
                    else if(total<xian){
                        level=2;
                    }
                    else if(total<xian+feng){
                        level=3;
                    }
                    else{
                        level=4;
                    }
                }
                $("#indicators tr:eq(8) td:eq(4)").html((parseInt(data[6][3])/(debtmonth*12)).toFixed(2));
                if(parseInt(data[6][0])!=0){
                   $("#indicators tr:eq(7) td:eq(4)").html((parseInt(data[6][2])/parseInt(data[6][0])).toFixed(2));
                   $("#indicators tr:eq(9) td:eq(4)").html(((parseInt(data[6][3])+parseInt(data[6][4])+parseInt(data[6][5]))/parseInt(data[6][0])).toFixed(2));
                }
                $("#indicators tr td").removeClass("red")
                <% for i in 0..@indicators.size-1 %>
                   if(parseFloat('<%= @indicators[i].indicators_recomn_min %>')>parseFloat($("#indicators tr:eq(<%= i+1 %>) td:eq(4)").html()) || parseFloat('<%= @indicators[i].indicators_recomn_max %>')<parseFloat($("#indicators tr:eq(<%= i+1 %>) td:eq(4)").html())){
                       $("#indicators tr:eq(<%= i+1 %>) td:eq(4)").addClass("red");
                   }
                <% end %>
                var dataarray=[];
                var dataarray1=[];
                if(acta==1){
                    dataarray=[array2[0],array2[1],array2[2],array2[3],array2[4],array2[5],array2[6],'<%= @debttype[0].debt_typename %>','<%= @debttype[1].debt_typename %>','<%= @debttype[2].debt_typename %>']
                    dataarray1=[parseInt(data[1][3]),parseInt(data[1][4]),parseInt(data[1][5]),parseInt(data[1][6]),parseInt(data[1][7]),parseInt(data[1][8]),parseInt(data[1][9]),parseInt(arrayObj0[0][1]),parseInt(arrayObj0[1][1]),parseInt(arrayObj0[2][1])]
                }
                else{
                    dataarray=['生活必要支出', '消费性支出', '<%= @debttype[0].debt_typename %>','<%= @debttype[1].debt_typename %>','<%= @debttype[2].debt_typename %>']
                    dataarray1=[ mustmonth,funmonth,parseInt(arrayObj0[0][1]),parseInt(arrayObj0[1][1]),parseInt(arrayObj0[2][1])]
                }
                var chart = new Highcharts.Chart({
                    chart: {
                        renderTo: 'container',
                        type: 'column'
                    },
                    title: {
                        text: false
                    },
                    subtitle: {
                        text: false
                    },
                    xAxis: {
                        categories: dataarray ,
                        labels: {
                            rotation: -45,
                            align: 'right',
                            style: {
                                fontSize: '13px',
                                fontFamily: 'Verdana, sans-serif'
                            }
                                        }
                    },
                    yAxis: {
                        min: 0,
                        title: {
                            text: '金额'
                        },
                        labels:{
                            formatter: function() {
                                return this.value
                                    }
                                }
                            },
                    legend: {
                        enabled: false
                    },
                    tooltip: {
                        pointFormat: '{point.y} '
                    },
                    plotOptions: {
                        column: {
                            pointPadding: 0.2,
                            borderWidth: 0
                        }
                    },
                    series: [{
                        data: dataarray1
                    }],
                    credits: {
                        enabled: false
                    }
                });

                var dataarray2=[];
                if(actb==1){
                    $("#detailannual tr:eq(1) td:eq(1)").html(parseInt(data[4][0]));
                    $("#detailannual tr:eq(2) td:eq(1)").html(parseInt(data[1][2])*12);
                    $("#detailannual tr:eq(3) td:eq(1)").html(parseInt(data[3][0])+parseInt(data[3][1]));
                    $("#detailannual tr:eq(4) td:eq(1)").html(parseInt(data[3][2]));
                    $("#detailannual tr:eq(1) td:eq(3)").html(parseInt(data[4][3]));
                    $("#detailannual tr:eq(2) td:eq(3)").html(parseInt(data[4][4]));
                    $("#detailannual tr:eq(3) td:eq(3)").html(parseInt(data[4][5]));
                    $("#detailannual tr:eq(4) td:eq(3)").html(parseInt(data[3][3]));
                    $("#detailannual tr:eq(5) td:eq(3)").html(parseInt(data[3][4]));
                    $("#detailannual tr:eq(6) td:eq(3)").html(parseInt(data[3][5]));
                    $("#detailannual tr:eq(7) td:eq(3)").html(parseInt(data[3][6]));
                    $("#detailannual tr:eq(10) td:eq(1)").html(parseInt(data[4][8])+parseInt(data[1][2])*12);
                    dataarray2=[
                        ['生活必须开销', parseInt(data[4][3])],
                        ['零花娱乐开销', parseInt(data[4][4])],
                        ['贷款支出', parseInt(data[4][5])],
                        ['<%= @expenseannual[0].expense_name %>', parseInt(data[3][3])],
                        ['<%= @expenseannual[1].expense_name %>', parseInt(data[3][4])],
                        ['<%= @expenseannual[2].expense_name %>', parseInt(data[3][5])],
                        ['<%= @expenseannual[3].expense_name %>', parseInt(data[3][6])]
                    ];
                }
                else{
                    $(".actb1").hide();
                    $(".actb0").show();
                    $("#detailannual tr:eq(1) td:eq(1)").html(parseInt(data[4][0]));
                    $("#detailannual tr:eq(2) td:eq(1)").html(parseInt(data[4][6]));
                    $("#detailannual tr:eq(1) td:eq(3)").html(parseInt(data[4][3]));
                    $("#detailannual tr:eq(2) td:eq(3)").html(parseInt(data[4][4]));
                    $("#detailannual tr:eq(3) td:eq(3)").html(parseInt(data[4][5]));
                    $("#detailannual tr:eq(4) td:eq(3)").html(parseInt(data[4][7]));
                    $("#detailannual tr:eq(14) td:eq(1)").html(parseInt(data[4][8]));
                    dataarray2=[
                        ['生活必须开销', parseInt(data[4][3])],
                        ['零花娱乐开销', parseInt(data[4][4])],
                        ['贷款支出', parseInt(data[4][5])],
                        ['年度开销', parseInt(data[4][7])]
                    ];
                }
                $("#detailannual tr:eq(9) td:eq(1)").html(parseInt(data[4][0])+parseInt(data[1][2])*12+parseInt(data[4][6]));
                $("#detailannual tr:eq(9) td:eq(3)").html(parseInt(data[4][3])+parseInt(data[4][4])+parseInt(data[4][5])+parseInt(data[4][7]));
                var chart = new Highcharts.Chart({
                    chart: {
                        renderTo: 'container2',
                        plotBackgroundColor: null,
                        plotBorderWidth: null,
                        plotShadow: false
                    },
                    title: {
                        text: false
                    },
                    tooltip: {
                        pointFormat: '{point.y} '
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: false,
                            cursor: 'pointer',
                            dataLabels: {
                                enabled: true,
                                color: '#000000',
                                distance: 10,
                                connectorColor: '#000000',
                                formatter:function(index) {
                                    if(this.point.percentage>0){
                                        var str=this.point.name,str1,aa='';
                                        for(var i=0,len=str.length/4;i<len;i++) {
                                            str1 = str.substr(0,4);
                                            str = str.replace(str1,'');
                                            if(i==0){aa=str1}
                                            else{aa=aa+"<br>"+str1}
                                        }
                                        return  '<span>'+aa + ':<br>'+this.point.percentage.toFixed(1)+'%</span>';
                                    }
                                }
                            },
                            showInLegend: true,
                            size: 120,
                            borderWidth: 0
                        }
                    },
                    series: [{
                        type: 'pie',
                        name: 'Browser share',
                        data: dataarray2
                    }],
                    legend: false,
                    credits: {
                        enabled: false
                    }
                });
                $.post("/usersurvey/moonlite",{username:'<%= session[:webusername] %>',moonlite_typeid:level},function(data){
                });

                var dataarray3=[];
                <% for k in 0..@assettype.size-1 %>
                dataarray3.push(['<%= @assettype[k].asset_typename %>',parseInt(data[5][<%= k %>])])
                <% end %>

                var chart = new Highcharts.Chart({
                    chart: {
                        renderTo: 'container3',
                        plotBackgroundColor: null,
                        plotBorderWidth: null,
                        plotShadow: false
                    },
                    title: {
                        text: false
                    },
                    tooltip: {
                        pointFormat: '{point.y} '
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: false,
                            cursor: 'pointer',
                            dataLabels: {
                                enabled: true,
                                color: '#000000',
                                distance: 10,
                                connectorColor: '#000000',
                                formatter:function(index) {
                                    if(this.point.percentage>0){
                                        var str=this.point.name,str1,aa='';
                                        for(var i=0,len=str.length/4;i<len;i++) {
                                            str1 = str.substr(0,4);
                                            str = str.replace(str1,'');
                                            if(i==0){aa=str1}
                                            else{aa=aa+"<br>"+str1}
                                        }
                                        return  '<span>'+aa + ':<br>'+this.point.percentage.toFixed(1)+'%</span>';
                                    }
                                }
                            },
                            showInLegend: true,
                            size: 120,
                            borderWidth: 0
                        }
                    },
                    series: [{
                        type: 'pie',
                        name: 'Browser share',
                        data: dataarray3
                    }],
                    legend: false,
                    credits: {
                        enabled: false
                    }
                });


                var chart = new Highcharts.Chart({
                    chart: {
                        renderTo: 'container4',
                        type: 'column'
                    },
                    title: {
                        text: false
                    },
                    subtitle: {
                        text: false
                    },
                    xAxis: {
                        categories: ["总资产","总负债"]
                    },
                    yAxis: {
                        min: 0,
                        title: {
                            text: '金额'
                        },
                        labels:{
                            formatter: function() {
                                return this.value
                            }
                        }
                    },
                        legend: {
                    enabled: false
                },
                    tooltip: {
                        pointFormat: '{point.y} '
                    },
                    plotOptions: {
                        column: {
                            pointPadding: 0.2,
                            borderWidth: 0
                        }
                    },
                    series: [{
                        data: [parseInt(data[6][0]),parseInt(data[6][1])]
                    }],
                    credits: {
                        enabled: false
                    }
                });

                if(bi<20){
                    $(".result").show();
                    if(bi>=0){
                    $(".result").html("您当前用"+bi+"%的月工资收入用来做储蓄投资，我们建议您能提高到20%~25%左右。")
                }
                else{
                        $(".result").html("您月消费金额超过您的月收入，我们建议您用20%~25%左右的月工资收入用来做储蓄投资。")
                    }
                }
                else{
                    $(".result").hide();
                }

                if(level==1){
                    $("#level0").show();
                    $("#level1").hide();
                    $("#level2").hide();
                    $("#level3").hide();
                    animate(0,0);
                    $(".intro").html("您属于负翁，您当前家庭资产体检得分约等于0分。")
                }
                else if(level==2){
                    $("#level0").hide();
                    $("#level1").show();
                    $("#level2").hide();
                    $("#level3").hide();
                    animate(0,0);
                    $(".intro").html("您属于重度月光族，您当前家庭资产体检得分约等于0分。")
                }
                else if(level==3){
                    $("#level0").hide();
                    $("#level1").hide();
                    $("#level2").show();
                    $("#level3").hide();
                    animate(0,0);
                    $(".intro").html("您属于中度月光族，您当前家庭资产体检得分约等于0分。")
                }
                else if(level==4){
                    $("#level0").hide();
                    $("#level1").hide();
                    $("#level2").hide();
                    $("#level3").show();
                    animate(0,run());
                    $(".intro").html("您属于轻度月光族，您当前家庭资产体检得分约等于"+run()+"分。")
                }

                $(".line10 td:eq(1)").html(parseInt(data[5][0]));
                $(".line11 td:eq(1)").html(parseInt(data[5][3]));
                $(".line20 td:eq(1)").html(parseInt(data[5][1]));
                $(".line21 td:eq(1)").html(parseInt(data[5][2]));
                $(".line22 td:eq(1)").html(parseInt(data[5][5]));
                $(".line30 td:eq(1)").html(parseInt(data[5][4]));
                $(".line31 td:eq(1)").html(parseInt(data[5][8]));
                $(".line32 td:eq(1)").html(parseInt(data[5][9]));
                $(".line40 td:eq(1)").html(parseInt(data[5][6]));
                $(".line41 td:eq(1)").html(parseInt(data[5][7]));

                $(".line10 td:eq(2)").html(array4[0]);
                $(".line10 td:eq(3)").html(arrayObj0[0][0]);
                $(".line11 td:eq(2)").html(array4[1]);
                $(".line11 td:eq(3)").html(arrayObj0[1][0]);
                $(".sum1 td:eq(2)").html(array4[2]);
                $(".sum1 td:eq(3)").html(arrayObj0[2][0]);

                $(".sum1 td:eq(1)").html(data[6][3]);
                $(".sum2 td:eq(1)").html(data[6][4]);
                $(".sum3 td:eq(1)").html(data[6][5]);
                $(".sum4 td:eq(1)").html(parseInt(data[5][6])+parseInt(data[5][7]));

                $(".total0").html(parseInt(data[6][0]));
                $(".total1").html(parseInt(data[6][1]));
                $(".total2").html(parseInt(data[6][2]));

            });
            $("#title").html("资产体检 总结");
        }
        else{
            if(system.win||system.mac||system.xll){
            if(i==7){
                var test_div=document.getElementById("questionnaire-view");
                test_div.style.height="600px";
                var test_div=document.getElementsByClassName("question");
                for(k=0;k<test_div.length-1;k++){
                    test_div[k].style.height="570px";
                }
                var test_div=document.getElementsByClassName("well-b");
                for(k=0;k<test_div.length-1;k++){
                    test_div[k].style.height="540px";
                }
            }
            else if(i==6){
                var test_div=document.getElementById("questionnaire-view");
                test_div.style.height="400px";
                var test_div=document.getElementsByClassName("question");
                for(k=0;k<test_div.length-1;k++){
                    test_div[k].style.height="370px";
                }
                var test_div=document.getElementsByClassName("well-b");
                for(k=0;k<test_div.length-1;k++){
                    test_div[k].style.height="340px";
                }
            }
            else{
            var test_div=document.getElementById("questionnaire-view");
            test_div.style.width="100%";
            test_div.style.height="326px";
                var test_div=document.getElementsByClassName("question");
                for(k=0;k<test_div.length-1;k++){
                    test_div[k].style.height="296px";
                }
                var test_div=document.getElementsByClassName("well-b");
                for(k=0;k<test_div.length-1;k++){
                    test_div[k].style.height="266px";
                }
            }
            }
        }
        if(system.win||system.mac||system.xll){
        }else{
            if(i!=9 && i!=5 && i!=2 && i!=6){
                var test_div=document.getElementById("questionnaire-view");
                test_div.style.height="500px";
                var test_div=document.getElementsByClassName("question");
                for(k=0;k<test_div.length-1;k++){
                    test_div[k].style.height="470px";
                }
                var test_div=document.getElementById("num9");
                test_div.style.height="440px";
                var test_div=document.getElementsByClassName("well-c");
                for(k=0;k<test_div.length-1;k++){
                    test_div[k].style.height="440px";
                }
            }
            else if(i==5){
                var test_div=document.getElementById("questionnaire-view");
                test_div.style.height="660px";
                var test_div=document.getElementsByClassName("question");
                for(k=0;k<test_div.length-1;k++){
                    test_div[k].style.height="630px";
                }
                var test_div=document.getElementsByClassName("well-c");
                for(k=0;k<test_div.length-1;k++){
                    test_div[k].style.height="600px";
                }
            }
            else if(i==2 || i==6){
                var test_div=document.getElementById("questionnaire-view");
                test_div.style.height="400px";
                var test_div=document.getElementsByClassName("question");
                for(k=0;k<test_div.length-1;k++){
                    test_div[k].style.height="370px";
                }
                var test_div=document.getElementsByClassName("well-c");
                for(k=0;k<test_div.length-1;k++){
                    test_div[k].style.height="340px";
                }
            }
            else{
                if(acta==1){
                    var test_div=document.getElementById("questionnaire-view");
                    test_div.style.height="2760px";
                    var test_div=document.getElementsByClassName("question");
                    test_div[test_div.length-1].style.height="2730px";
                    var test_div=document.getElementById("num9");
                    test_div.style.height="2700px";
                }
                else{
                    var test_div=document.getElementById("questionnaire-view");
                    test_div.style.height="2460px";
                    var test_div=document.getElementsByClassName("question");
                    test_div[test_div.length-1].style.height="2430px";
                    var test_div=document.getElementById("num9");
                    test_div.style.height="2400px";
                }
            }
        }
        var $qns = $qr.children(".question");
        var $qn = $qns.eq(i);
        if (e!='load' && i >= 0 && $qn.length) {
            $qns.eq($qr.data("q")).find("input").attr("tabindex", "-1");

            $qr.data({q: i, transition: true});
            var newTop = -i * $qn.height() + "px";
            if(system.win||system.mac||system.xll){
                if(i==9){newTop= (-i * 296).toString()+"px"}
            }else{
                if(i==9){newTop= (-i * 470).toString()+"px"}
            }
            //  alert(newTop)
            if (immediately) {
                $qr.css("top", newTop);
            }
            if (immediately || $qr.css("top") === newTop) {
                setTimeout(onAtQn, 5);
            } else {
                $qr.animate({"top": newTop}, onAtQn);
            }
            $("#q-back span").text(i === 0 ? "上一题" : "上一题");
            $("#q-back").attr("disabled", i == 0);

            var isLastQn = i == $qns.length - 1;
            $("#q-buttons").toggleClass("q-submit", isLastQn);

            var $i = $qn.find("input");
            var done = $i.is(":radio") ? $i.is(":checked") : !!$i.val();
        <% if session[:webusername]!=nil %>
            if(i==4 && '<%= @webuser.age %>'!=""){done=true;}
        <% end %>
            $(isLastQn ? "#q-submit" : "#q-next").attr("disabled", !done);
            $qr.trigger("qr:nav", i);

            w.trackEvent("OFA", "question_display", (i+1) + "." + $i.attr("name"));
        }

        function onAtQn() {
            $qr.removeData("transition");
            $qn.find("input").attr("tabindex", "0")
                    .filter("[checked=true],input:first").focus().select();
        }
    }

    function updateButtons(e, inputEl, isDone) {
        if (e.keyCode == 9 || e.keyCode == 13) {
            return;
        }
        var $i = $(inputEl), $q = $i.closest(".question");
        var isLastQn = $q.nextAll(".question:first").length == 0;
        $(isLastQn ? "#q-submit" : "#q-next").attr("disabled", !isDone);
        $("#q-back").attr("disabled", $i.hasClass("invalid") || $q.is(".first"));
    }

    function calculateRiskTol() {
        var min = 0.1;
        var max = 10;
        var granularity = 10.0;
        var $i = $qr.find("input");
        var vals = valsFromDom($i);
        var tol = recommendRiskTolerance2(vals, min, max, granularity);
        var rec = tol.toFixed(1);
        $i.filter("[name=rec]").val(rec);
        vals.rec = +rec;
        $qr.data("vals", vals);
        $qr.triggerHandler("qr:change", +rec);
    }

</script>
<script>
    $(function() {
        var currentModelNumber = "4"; //SAA201210
        var moveMeter = attachRiskMeter("#risk-meter");

        var $n = $("#q-numbers"), $qr = $("#questionnaire"), $qs = $qr.find(".question");
        $n.find(".q-num").each(function(i) {
            if ($qs.eq(i).find("input").filter(function() {return this.type == "radio" ? this.checked : !!this.value}).length) {
                $(this).addClass("past");
            } else {
                if(i==4 && '<%= @webuser.age %>'!="" && '<%= @webuser.sex %>'!=""){
                    $(this).addClass("past");
                }
                else{
                    if(i==5){
                    <% if @userdatamonth!=nil %>
                    <% if @userdatamonth.income!=nil && @userdatamonth.must_expense!=nil && @userdatamonth.invest_expense!=nil %>
                        $(this).addClass("past");
                    <% else %>
                        return false;
                    <% end %>
                    <% else %>
                        return false;
                    <% end %>
                    }
                    else if(i==6){
                    <% if @userdateannual!=nil %>
                    <% if @userdateannual.income_annual!=nil && @userdateannual.expense_annual!=nil %>
                        $(this).addClass("past");
                    <% else %>
                        return false;
                    <% end %>
                    <% else %>
                        return false;
                    <% end %>
                    }
                    else{
                        return false;
                    }
                }
            }
        });
        $qr.bind("qr:nav", function(e, i) {
            var $n = $("#q-numbers");
            $n.children(".q-num.curr").removeClass("curr").addClass("past");
            $n.children().eq(i).removeClass("past").addClass("curr");
        })
                .bind("qr:change", function(e, tol) {
                    moveMeter(tol / 10);
                })
                .submit(function(e) {
                    e.preventDefault();
                    var $qr = $(this);
                    if (!$qr.data("submitted")) {
                        $qr.data("submitted", true);
                        var cookieName = "asset_allocation";
                        var o = deserializePlan(w.cookie(cookieName)) || {};
                        $.each($qr.serializeArray(), function(i,v) {
                            o[v.name] = v.value.replace(/[$,]/g, "");
                        });
                        o.tol = o.rec;
                        o.amount = o.amount || o.lnw;
                        var check=document.getElementsByName("stability");
                        o.stability="";
                        for(var i=0;i<check.length;i++){
                            if(check[i].checked==true){
                                if(o.stability==""){
                                    o.stability=check[i].value;
                                }
                                else{
                                    o.stability=o.stability+check[i].value;
                                }
                            }
                        }
                        w.cookie(cookieName, serializePlan(o, currentModelNumber), 14);
                        location = $qr.attr("action");
                    }
                })
                .data("init")(true);
    });
</script>

<script>
    var eCalcShareHolders = new Object();
    var debug = false;

    function addFounder(founder, isFirst)
    {
        var aaa = genId(eCalcShareHolders);
        var f = founder;
        if(f == null) // create a new share holder
        {
            f = new ShareHolder();
            f.setupShareHolder(true, false, false);
            f.id= "founder-" + aaa;
            f.name = "Founder " + getNewNameNumber(eCalcShareHolders, "founder");
            eCalcShareHolders[f.id] = f;
        }

        if(!isFirst)
        {
            var fi = $("div.founder-inputs div.op-input").last().clone().removeClass("first");
            $(fi).find(".icon-remove-sign").show();
            var fid = f.id;
            $(fi).attr("fid", fid);
            // put values in
            $(fi).find(".founder-name").attr("id",'variety'+aaa);
            $(fi).find(".init-share").val(0);
            $(fi).find(".init-share").attr("id",'amount'+aaa);
            $(fi).find(".pname").attr("id",'pname'+aaa);
            $("div.founder-inputs").append(fi);
        }
    }

    function add(found, isFirst)
    {
        var aaa = genId(eCalcShareHolders);
        var f = found;
        if(f == null) // create a new share holder
        {
            f = new ShareHolder();
            f.setupShareHolder(true, false, false);
            f.id= "found-" + aaa;
            f.name = "Found " + getNewNameNumber(eCalcShareHolders, "found");
            eCalcShareHolders[f.id] = f;
        }

        if(!isFirst)
        {
            var fi = $("div.found-inputs div.op-input").last().clone().removeClass("first");
            $(fi).find(".icon-remove-sign").show();
            var fid = f.id;
            $(fi).attr("fid", fid);
            // put values in
            $(fi).find(".found-name").attr("id",'debttype'+aaa);
            $(fi).find(".init").val(0);
            $(fi).find(".init").attr("id",'loan'+aaa);
            $(fi).find(".repayment").attr("id",'repayment'+aaa);
            $(fi).find(".period").attr("id",'period'+aaa);
            $("div.found-inputs").append(fi);
        }
    }

    var ShareHolder = function()
    {
        this.isFounder = true;
        this.isEmployee = false;
        this.isSeries = false;
        this.percentStake = 0;
        this.exitValue = 0;
        this.totalShares = 0;
        this.name = "name";
        this.id = null;

        this.setFounder = function()
        {
            this.isFounder = true;
            this.isEmployee = false;
            this.isSeries = false;
        }

        this.setSeries = function()
        {
            this.isFounder = false;
            this.isEmployee = false;
            this.isSeries = true;
        }

        this.setEmployee = function()
        {
            this.isFounder = false;
            this.isEmployee = true;
            this.isSeries = false;
        }

        this.setupShareHolder = function(isFounder, isEmployee, isSeries)
        {
            if(isFounder)
            {
                this.isFounder = true;
                this.isEmployee = false;
                this.isSeries = false;
            }
            else if(isEmployee)
            {
                this.isFounder = false;
                this.isEmployee = true;
                this.isSeries = false;
            }
            else if(isSeries)
            {
                this.isFounder = false;
                this.isEmployee = false;
                this.isSeries = true;
            }
        }

        // Use to create a JSON object from the Founder
        this.renderJson = function()
        {
            return {
                isFounder: this.isFounder, isEmployee: this.isEmployee,
                isSeries: this.isSeries, percentStake: this.percentStake,
                totalShares: this.totalShares, id: this.id, name:this.name
            };
        }
    }

    function genId(map)
    {
        //cslog("Generating id for object.");
        var tId = 0;
        for(var id in map)
        {
            var count = id.split("-")[1];
            if(getInteger(count) > tId)
            {
                tId = count;
            }
        }
        return getInteger(tId) + 1;
    }

    function getInteger(v)
    {
        if (v != null && typeof(v) == 'string' & v != "")
        {
            v = v.replace(/\$/, "");
            v = v.replace(/,/g, "");
            v = v.replace(/\..*/g, "");
            var r = parseInt(v, 10);
            if (!isNaN(r))
                return r;
        }
        if (typeof(v) == "number")
        {
            return parseInt(v, 10);
        }

        return 0;
    }


    function getNewNameNumber(shareHolders, type)
    {
        var fRegex = /founder\s\d/i;
        if(type == "employee")
        {
            fRegex = /employee\s\d/i;
        }
        var latestId = 1;
        for(var id in shareHolders)
        {
            if(type != "employee" && shareHolders[id].isFounder && fRegex.test(shareHolders[id].name))
            {
                var curNum = getInteger(fRegex.exec(shareHolders[id].name)[0].split(" ")[1]);
                if(curNum >= latestId)
                {
                    latestId  = curNum + 1;
                }
            }
            else if(type == "employee" && shareHolders[id].isEmployee && fRegex.test(shareHolders[id].name))
            {
                var curNum = getInteger(fRegex.exec(shareHolders[id].name)[0].split(" ")[1]);
                if(curNum >= latestId)
                {
                    latestId  = curNum + 1;
                }
            }
        }
        return latestId;
    }

    function removeFounder(e)
    {
        var fi = $(e).closest("div.op-input");
        var fid = $(fi).attr("fid");
        delete eCalcShareHolders[fid];
        $(fi).detach();
    }

    function run(){
        if(jixu!=0 && total!=0){
            var score=(3-(Math.abs(xian/total-xianjin/jixu)+Math.abs(wen/total-wenjian/jixu)+Math.abs(feng/total-fengxian/jixu)))*100/3
        }
        else{
            var score=0;
        }
        return  score.toFixed(1);
    }

</script>

<%= javascript_include_tag "excanvas.js" %>
<%= javascript_include_tag "jquery.easy-pie-chart.js" %>
<script type="text/javascript">
    var initPieChart = function() {
        $('.percentage').easyPieChart({
            animate: 1000
        });
    };
    function animate(i,a){
        if(i<a){
            $('.percentage').each(function() {
                $(this).data('easyPieChart').update(i);
                $('span', this).text(i);
            });
            setTimeout("animate("+(i+1).toString()+','+a+")",50);
        }
        else{
            $('.percentage').each(function() {
                $(this).data('easyPieChart').update(a);
                $('span', this).text(a);
            });
        }
    }
</script>