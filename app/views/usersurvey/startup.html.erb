<%= stylesheet_link_tag "common2.css" %>
<%= javascript_include_tag "base.js" %>
<%= javascript_include_tag "d3.js" %>
<%= javascript_include_tag "plan.js" %>
<%= javascript_include_tag "risk.js" %>
<%= javascript_include_tag "bootstrap.min.js" %>
<%= stylesheet_link_tag "founder.css" %>

<script>
    t0=new Date
    function onReady(fn){onReady.fns.push(fn)}
    onReady.fns=[]
</script>

<div class="welcomes startup">
<div class="ofa-funnel-pages">
<div id="page-wrapper">
<div id="top-tabs">
  <div class="top-tabs-content">
    <b>1.</b> <span> 资产体检</span>
    <b>&nbsp;&gt;&nbsp;</b><div class="mobile"><br></div>
    <% if session[:webusername]!=nil && @webuser.risktolerance!=nil %>
        <a href="/usersurvey/measure/2"><b>2.</b> 风险评估</a>
    <% else %>
        <span class="disabled"><b>2.</b> 风险评估</span>
    <% end %>
    <b>&nbsp;&gt;&nbsp;</b><div class="mobile"><br></div>
    <% if session[:webusername]!=nil && @webuser.selection!=nil %>
        <a href="/usersurvey/measure/3"><b>3.</b> 理财建议</a>
    <% else %>
        <span class="disabled"><b>3.</b> 理财建议</span>
    <% end %>
  </div>
</div>

<div id="page-content">
<div class="clearfix"></div>
<h1>
  <span id="title">基本信息</span>
  <div id="q-numbers"><b class="q-num curr"></b><b class="q-num"></b><b class="q-num"></b><b class="q-num"></b><b class="q-num"></b><b class="q-num"></b><b class="q-num"></b><b class="q-num"></b><b class="q-num"></b></div>
</h1>

<div id="questionnaire-view">
<div id="questionnaire">
<div class="question first">
  <table class="center">
    <tr>
      <td>
        <p class="q-text">我们将以解决月光为目标，从流动性、保本性、风险性的角度，进行资产体检，以方便你找到月光的根源。</p>
        <p class="q-text">良好的资产体检得分意味着您的投资组合好，多元化，波动幅度小，如果您的体检得分小于60分，我们建议您应该做一些变动调整。</p>
      </td>
      <td style="width: 168px;text-align: center;">
        <a class="introduce" href="#myModal" role="button" data-toggle="modal">资产体检原理介绍</a>
      </td>
      <td>
        <div style="width: 300px;float: right;"><img src="/assets/morningstar2.png"><br><img src="/assets/logo.jpg"></div>
      </td>
    </tr>
  </table>
  <input type="checkbox" class="hide">
  <div class="mobile"><br></div>
</div>
<div class="question">
  <table class="center">
    <tr>
      <td>
        <p class="q-text">个人、家庭都有可能遭遇到突发情况，例如失业、自然灾害（地震、泥石流)、突然死亡（参考微博）。</p>
        <p class="q-text">您作为家庭的顶梁柱，有必要准备应急基金。</p>
        <p class="q-text">这个应急金额大约为3个月日常生活费用总额，是由流动性资产组成的。</p>
        <p class="q-text">下面几种流动性资产可以作为应急资金：现金、活期储蓄、余额宝、货币基金。</p>
      </td>
      <td style="width: 168px;text-align: center;">
        <a class="introduce" href="#myModal2" role="button" data-toggle="modal">我真的需要应急基金吗？</a>
      </td>
      <td>
        <div style="width: 300px;float: right;"><img src="/assets/121058.png"></div>
      </td>
    </tr>
  </table>
  <input type="checkbox" class="hide">
  <div class="mobile"><br></div>
</div>
<div class="question">
  <table class="center">
    <tr>
      <td class="top">

        <p class="q-text">保本性资产是家庭资产配置不可或缺的一部分，他将作为资金增值的安全保护带。这部分资产投资周期将会较长，收益率也相对较高。</p>
        <p class="q-text">随着年龄的增长和家庭风险偏好的下降，该类的比例还将逐渐提高。</p>


      </td>
      <td>
        <div style="width: 300px;float: right;"><img src="/assets/121057.png"></div>
      </td>
    </tr>
  </table>
  <input type="checkbox" class="hide">
  <div class="mobile"><br></div>
</div>
<div class="question">
  <table class="center">
    <tr>
      <td class="top">
        <p class="q-text">在这个通货膨胀的时代背景下，风险承担由不得我们自行选择，我们每个人都必须面对，现在不承担风险，将来会承担更大的风险。</p>
        <p class="q-text">风险就像我们要做出“收益”这个美食的刀具，如果因为害怕风险而放弃机会，这就和害怕刀的锋利而不敢使用刀一样。</p>
        <p class="q-text">对于理财规划而言，年龄是个核心的因素。年轻人的资产比例中，风险性投资产品应该占有大比重。</p>
      </td>
      <td>
        <div style="width: 300px;float: right;"><img src="/assets/121056.png"></div>
      </td>
    </tr>
  </table>
  <input type="checkbox" name="income" class="hide">
  <div class="mobile"><br></div>
</div>
<div class="question">
  <table class="center">
    <tr>
      <td class="top">
        <p class="q-text">您的年纪、性别将直接影响到您的资产配置比例。</p>
        <table>
          <tr>
            <td class="q-text" style="width: 120px;">年龄：</td>
            <td><input type="text" name="age" id="age" tabindex="-1"></td>
          </tr>
          <tr>
            <td class="q-text">性别：</td>
            <td><select id="sex"><option value="男">男</option><option value="女">女</option></select></td>
          </tr>
        </table>
      </td>
      <td>
        <div style="width: 300px;float: right;"><img src="/assets/121079.png"></div>
      </td>
    </tr>
  </table>
  <div class="mobile"><br></div>
</div>
<div class="question">
  <table class="center">
    <tr>
      <td class="top">
        <p class="q-text">该类数据分析将帮助您查明每月支出趋向和储蓄力度，确保您的消费符合轻重缓急。</p>
        <p class="q-text">右图是较为常见的月收入分配4321法则。</p>
        <table style="width: 100%;">
          <tr>
            <td class="q-text" style="width: 120px;">月收入：</td>
            <td style="width: 220px;"><input type="text" name="lnw" id="salary" tabindex="-1"></td>
            <td></td>
          </tr>
          <tr>
            <td class="q-text">每月衣食住行：</td>
            <td><input type="text" name="lnw" id="rent" tabindex="-1"></td>
            <td></td>
          </tr>
          <tr>
            <td class="q-text">每月至少存储：</td>
            <td><input type="text" name="lnw" id="wages" tabindex="-1"></td>
            <td></td>
          </tr>
          <tr>
            <td colspan="2"><a class="xtip pull-right" href="#myModal3" role="button" data-toggle="modal" id="jinque"> 精确输入 </a></td>
          </tr>
        </table>
      </td>
      <td>
        <div style="width: 300px;float: right;"><img src="/assets/121060.png"></div>
      </td>
    </tr>
  </table>
  <div class="mobile"><br></div>
</div>
<div class="question">
  <div class="well-c">
    <p class="q-text">已有资产表是您资产阶段性总结，分析它可以帮助你及时发现财务危机，规划理财方式，并确保实现梦想目标。<br>切记，填写的应该是资产的当期市值，而不是购买价格。</p>
    <div class="row op-label win">
      <div class="span3">资产品种</div>
      <div class="span3" style="text-align: left;">资产金额</div>
      <div class="span2" style="text-align: left;">产品名称（可选）</div>
      <div class="span1"></div>
    </div>
    <div class="seperator thick"></div>
    <div class="founder-inputs">

      <div class="op-input first" fid="founder">
        <div class="seperator bottom"></div>

        <div class="row">
          <div class="span3 control-group">
            <div class="mobile">资产品种</div>
            <select  name="variety" id="variety" class="founder-name" title="资产品种">
              <option value="银行活期">银行活期</option>
              <option value="银行定期">银行定期</option>
              <option value="银行理财产品">银行理财产品</option>
              <option value="余额宝">余额宝</option>
              <option value="其他货币基金">其他货币基金</option>
              <option value="债券型基金">债券型基金</option>
              <option value="股票">股票</option>
              <option value="股票型基金">股票型基金</option>
              <option value="贵金属">贵金属</option>
              <option value="房产">房产</option>
              <option value="汽车">汽车</option>
              <option value="其它">其它</option>
            </select>
          </div>
          <div class="span3 control-group" style="text-align: left;">
            <div class="mobile">资产金额</div>
            <div class="input-prepend">
              <span class="add-on">￥</span>
              <input class="init-share" name="lnw" id="amount" style="width: 180px;"  onMouseOver="if(this.value==0){this.value='';}"value="0" type="text">
            </div>
          </div>
          <div class="span2" style="text-align: center;">
            <div class="mobile">产品名称</div>
            <input class="pname" id="pname" style="width: 206px;" type="text" placeholder="产品名称">
          </div>
          <div class="span1 top5" style="margin-top: 10px;margin-left: 40px;height: 20px;overflow: hidden;"><i class="icon-remove-sign" style="display: none;margin-left: 20px;font-size: 30px;" onclick="removeFounder(this);">&nbsp;&nbsp;</i></div>
        </div>
      </div>
    </div>
    <div class="seperator bottom thick"></div>
    <a data-original-title="Click here to add another company founder" class="xtip pull-right"style="padding: 0 20px 10px 0;" onclick="addFounder(null, false);"> + 添加资产 </a>
  </div>
  <div class="mobile"><br></div>
</div>
<div class="question">
  <div class="well-c">
    <div class="row op-label win">
      <div class="span2">贷款类型</div>
      <div class="span2" style="text-align: left;">总负债</div>
      <div class="span2" style="text-align: left;">每月还贷</div>
      <div class="span2" style="text-align: left;">贷款年限</div>
      <div class="span1"></div>
    </div>
    <div class="seperator thick"></div>
    <div class="found-inputs">

      <div class="op-input first" fid="found">
        <div class="seperator bottom"></div>

        <div class="row">
          <div class="span2 control-group">
            <div class="mobile">贷款类型</div>
            <select  name="variety" id="debttype" class="found-name" title="贷款类型" style="width: 140px;">
              <option value="房贷">房贷</option>
              <option value="车贷">车贷</option>
              <option value="其他贷款">其他贷款</option>
            </select>
          </div>
          <div class="span2 control-group" style="text-align: left;">
            <div class="mobile">总负债</div>
            <div class="input-prepend">
              <span class="add-on">￥</span>
              <input class="init" name="lnw" id="loan" style="width: 120px;"  onMouseOver="if(this.value==0){this.value='';}"value="0" type="text">
            </div>
          </div>
          <div class="span2">
            <div class="mobile">每月还贷</div>
            <input class="repayment" name="lnw" id="repayment" style="width: 120px;" type="text">
          </div>
          <div class="span2">
            <div class="mobile">贷款年限</div>
            <input class="period" id="period" style="width: 120px;" type="text">
          </div>
          <div class="span1 top5" style="margin-top: 10px;margin-left: 0;height: 20px;overflow: hidden;"><i class="icon-remove-sign" style="display: none;margin-left: 20px;font-size: 30px;" onclick="removeFounder(this);">&nbsp;&nbsp;</i></div>
        </div>
      </div>
    </div>
    <div class="seperator bottom thick"></div>
    <a data-original-title="Click here to add another company found" class="xtip pull-right"style="padding: 0 20px 10px 0;" onclick="add(null, false);"> + 添加贷款 </a>
  </div>
  <div class="mobile"><br></div>
</div>
<div class="question">
  <table class="center">
    <tr>
      <td>
        <div id="level0" class="hide">
          <p class="q-text">“看上去您是名最严重级别的月光族，您每个月的收入不够您的开销，我们猜测您是通过信用卡、借债等方式维持正常生活。”</p>
          <p class="q-text">“您现在是典型的负翁，我们建议您能每个月至少能保存3%~5%的月收入用来做储蓄投资”。</p>
          <p class="q-text">不能控制好金钱的使用，不仅在金钱方面，即使在实现人生目标方面也会有困难。<br>
            长期处于您这种极其严重月光的状态，会让您心情一直处于紧张状态，不论是面对工作还是家庭，都无法从容处理。<br>
            极度严重月光族的您，必须立刻行动起来。</p>
        </div>
        <div id="level1" class="hide">
          <p class="q-text">“看上去您是名重度月光族，您的年收入储蓄不能维持您三个月的基本生活费。”</p>
          <p class="q-text result"></p>
          <p class="q-text">不能控制好金钱的使用，不仅在金钱方面，即使在实现人生目标方面也会有困难。<br>
            长期处于这种重度月光的状态，会让您心情总是不太好，总有一些不安、寂寞和精神压力，不论是面对工作还是家庭，人际关系也总处理的不满意。<br>
            重度月光族的您，很有必要审视和改变您现在的生活。</p>
        </div>
        <div id="level2" class="hide">
           <p class="q-text">“看上去您是名中度月光族，您现在已有积蓄和每个月的存款只能维持家庭应急资金池，您没有太多资金可以用作风险性投资，这将使得您没有太多机会获得利润高的收益机会。”</p>
           <p class="q-text result"></p>
           <p class="q-text">您当前的风险资产比例过低，且没有足够的财力来完成这个。个人或家庭的财富增长的速度较慢，当然，风险资产比率过高，一旦投资失败，可能使得家庭财务陷入危机。<br>
                  请进入下一步风险评估环节，您可以仔细审查您的投资风格，来得到您合适的风险资产比例。</p>
        </div>
        <div id="level3" class="hide">
          <p class="q-text">“看上去您是名轻度月光族，您当前的流动性资产占有比例<span class="liu">过高</span>，风险性资产占有比例<span class="feng">过低</span>，保本型资产占有比例<span class="bao">过高</span>。”</p>
          <p class="q-text result"></p>
          <p class="q-text">您当前的风险资产比例<span class="feng">过低</span>，且没有足够的财力来完成这个。个人或家庭的财富增长的速度较慢，当然，风险资产比率过高，一旦投资失败，可能使得家庭财务陷入危机。该比率越小，则会降低家庭投资组合的收益，导致资产缩水。<br>
                   请进入下一步风险评估环节，您可以仔细审查您的投资风格，来得到您合适的风险资产比例。</p>
        </div>


        <input type="checkbox" class="hide">
      </td>
      <td style="width: 168px;text-align: center;">
        <a class="introduce" href="#myModal6" role="button" data-toggle="modal">分数如何计算得到的？</a>
      </td>
      <td>
        <div style="width: 300px;"><div class="percentage" style="margin: 0 auto;" data-percent="0"><span  style="font-size: 20px;font-family: Microsoft YaHei;">0</span>分</div></div>
      </td>
    </tr>
  </table>
  <div class="mobile"><br></div>
</div>

<input type="hidden" name="rec" value="0.1" tabindex="-1">
</div>
<div id="q-fade-t"></div>
<div id="q-fade-b"></div>
</div>
<div id="q-buttons">
  <button class="q-button light-gray big-button" id="q-back" disabled="disabled">◄&nbsp; <span>上一题</span>&nbsp;</button>
  <button class="q-button orange-button big-button" id="q-next" disabled="disabled">&nbsp;下一题 &nbsp;►</button>
  <button class="q-button orange-button big-button" id="q-submit">风险评估</button>

  <p class="q-privacy">
    <span class="q-privacy-1">这是匿名的，所以你可以如实回答<span class="win">，</span></span>
    <span class="win">我们不会问你的身份识别信息，除非阁下主动联系我们。</span>
  </p>
</div>
</div>
</div>
</div>
</div>

<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>资产体检原理介绍</h3>
  </div>
  <div class="modal-body">
    <% if @blog!=nil %>
        <img class="alignleft size-medium " id="img" src="/assets/BE83E81B-484E-4E7F-B75B-CC39315067D4.png"><br><br>
        <%=raw @blog.barticle %>
    <% end %>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
  </div>
</div>
<div id="myModal2" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>我真的需要应急基金吗？</h3>
  </div>
  <div class="modal-body">
    <% if @blog2!=nil %>
        <img class="alignleft size-medium " id="img" src="/assets/personal-finance.jpg"><br><br>
        <%=raw @blog2.barticle %>
    <% end %>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
  </div>
</div>
<div id="myModal3" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>月收入支出 明细</h3>
  </div>
  <div class="modal-body">
    <table>
      <tr>
         <td style="width: 50%;">
           <p>月支出</p>
           <table id="exact1"  class="table table-striped table-bordered">
             <tr><td>支出明细</td><td>金额</td><td class="update hide" style="width: 70px;">建议金额</td></tr>
             <tr><td>餐饮</td><td><input type="text" onkeyup="inva(this);" name="exect" id="meals"></td><td class="update1 hide"></td></tr>
             <tr><td>交通</td><td><input type="text" onkeyup="inva(this);" name="exect" id="fare"></td><td class="update2 hide"></td></tr>
             <tr><td>购物</td><td><input type="text" onkeyup="inva(this);" name="exect" id="shop"></td><td class="update3 hide"></td></tr>
             <tr><td>娱乐</td><td><input type="text" onkeyup="inva(this);" name="exect" id="taste"></td><td class="update4 hide"></td></tr>
             <tr><td>医教</td><td><input type="text" onkeyup="inva(this);" name="exect" id="education"></td><td class="update5 hide"></td></tr>
             <tr><td>居家</td><td><input type="text" onkeyup="inva(this);" name="exect" id="family"></td><td class="update6 hide"></td></tr>
             <tr><td>人情</td><td><input type="text" onkeyup="inva(this);" name="exect" id="intercourse"></td><td class="update7 hide"></td></tr>
           </table>
           <a class="xtip update hide" href="#myModal5" role="button" data-toggle="modal"> 为什么这么建议我的各项支出金额？ </a>
           <div id="remark">
             <blockquote>
               <small>购物：衣服鞋帽、日用百货、婴幼用品、数码产品、化妆护肤、首饰、烟酒、电器、家具、报刊书籍、玩具、摄影文印、保健品</small>
               <small>娱乐：卡拉OK、电影、电视、网络电玩、运动健身、洗浴足浴、茶酒咖啡、旅游度假、歌舞演出</small>
               <small>医教：求医买药、培训考试、学杂教材、家教补习、助学贷款</small>
               <small>居家：房款房贷、水电煤气、物业、 美发美容、手机电话、宽带、住宿房租、保险费、消费贷款、税费、材料建材、家政服务、快递邮政、漏记账</small>
             </blockquote>
           </div>
         </td>
         <td style="width: 30px;"></td>
         <td>
           <p>月收入</p>
           <table id="exact2" class="table table-striped table-bordered">
             <tr><td>月份</td><td>收入</td>
             <tr><td>一月</td><td><input type="text" onkeyup="inva(this);" name="exect" id="income1"></td></tr>
             <tr><td>二月</td><td><input type="text" onkeyup="inva(this);" name="exect" id="income2"></td></tr>
             <tr><td>三月</td><td><input type="text" onkeyup="inva(this);" name="exect" id="income3"></td></tr>
             <tr><td>四月</td><td><input type="text" onkeyup="inva(this);" name="exect" id="income4"></td></tr>
             <tr><td>五月</td><td><input type="text" onkeyup="inva(this);" name="exect" id="income5"></td></tr>
             <tr><td>六月</td><td><input type="text" onkeyup="inva(this);" name="exect" id="income6"></td></tr>
             <tr><td>七月</td><td><input type="text" onkeyup="inva(this);" name="exect" id="income7"></td></tr>
             <tr><td>八月</td><td><input type="text" onkeyup="inva(this);" name="exect" id="income8"></td></tr>
             <tr><td>九月</td><td><input type="text" onkeyup="inva(this);" name="exect" id="income9"></td></tr>
             <tr><td>十月</td><td><input type="text" onkeyup="inva(this);" name="exect" id="income10"></td></tr>
             <tr><td>十一月</td><td><input type="text" onkeyup="inva(this);" name="exect" id="income11"></td></tr>
             <tr><td>十二月</td><td><input type="text" onkeyup="inva(this);" name="exect" id="income12"></td></tr>
           </table>
         </td>
      <tr>
    </table>
  </div>
  <div class="modal-footer">
    <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true" id="sum">确认</button>
  </div>
</div>
<div id="myModal4" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>提示</h3>
  </div>
  <div class="modal-body">
     <p style="color: red;">理想情况下，您应该用25%左右的月收入比例用来投资。</p>
     <p id="text" style="color: red;"></p>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true" id="that">就这样吧</button>
    <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true" id="update">调整</button>
  </div>
</div>
<div id="myModal5" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>为什么这么建议我的各项支出金额？</h3>
  </div>
  <div class="modal-body">
    <% if @blog3!=nil %>
        <img class="alignleft size-medium " id="img" src="/assets/0843A8AE-ADFD-4A53-938B-336712606D5E.png"><br><br>
        <%=raw @blog3.barticle %>
    <% end %>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true" id="open3">关闭</button>
  </div>
</div>
<div id="myModal6" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>分数如何计算得到的？</h3>
  </div>
  <div class="modal-body">
    <% if @blog!=nil %>
        <img class="alignleft size-medium " id="img" src="/assets/BE83E81B-484E-4E7F-B75B-CC39315067D4.png"><br><br>
        <%=raw @blog.barticle %>
    <% end %>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
  </div>
</div>

<script>
    var numfor=/^[-+]?[0-9]+(\.[0-9]+)?$/;
    var tot1= 0,tot2= 0,avge= 0,tot3=0;
    var normal=0; //月收入支出 明细1/2
    var acta=0; //普通/精确
    $('#jinque').click(function() {
        $("[class*='update']").hide();
        $("#remark").show();
    })

    $('#update').click(function() {
       if(normal==1){
        $(".update1").html(parseInt(avge*0.18));
        $(".update2").html(parseInt(avge*0.04));
        $(".update3").html(parseInt(avge*0.1));
        $(".update4").html(parseInt(avge*0.03));
        $(".update5").html(parseInt(avge*0.1));
        $(".update6").html(parseInt(avge*0.3));
        $(".update7").html(parseInt(avge*0.03));
        $("[class*='update']").show();
        $("#remark").hide();
       }
       else if(normal==2){
           var a2=parseInt($("#salary").attr("value").replace(/,/g, ""));
           $(".update1").html(parseInt(a2*0.18));
           $(".update2").html(parseInt(a2*0.04));
           $(".update3").html(parseInt(a2*0.1));
           $(".update4").html(parseInt(a2*0.03));
           $(".update5").html(parseInt(a2*0.1));
           $(".update6").html(parseInt(a2*0.3));
           $(".update7").html(parseInt(a2*0.03));
           $("[class*='update']").show();
           $("#remark").hide();
       }
        else{
           $("[class*='update']").hide();
           $("#remark").show();
       }
        $('#myModal3').modal('show');
    })
    $('#open3').click(function() {
        $('#myModal3').modal('show');
    })

   function inva(e){
       if(numfor.test(e.value)==false){
           $("#"+e.id).addClass('invalid');
       }
       else{
           $("#"+e.id).removeClass('invalid');
    }
    }
</script>


<script type="text/javascript">
    //平台、设备和操作系统
    var system ={
        win : false,
        mac : false,
        xll : false
    };
    //检测平台
    var p = navigator.platform;
    system.win = p.indexOf('Win') == 0;
    system.mac = p.indexOf('Mac') == 0;
    system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);
    //跳转语句
    if(system.win||system.mac||system.xll){
        $(".mobile").remove();
    }else{
        $(".win").remove();
    }
</script>

<script>
    _gaq = [["_setAccount","UA-1329988-4"],["_trackPageview"]];
    w.requestId = "1092152607";

    $(function(){
        window.onerror = function(error, url, lineNumber) {
            var payload = {"rev": "80126", "error": error, "agent": navigator.userAgent, "stack": []};

            // begin ie9 only stack trace grabbing
            var value = arguments.callee;
            for(i=0; i!=10; ++i) {
                if(value.caller) {
                    payload.stack.push(value.caller.toString());
                    value = value.caller;
                }
            }

            if (!w.jsErrors[payload]) {
                w.jsErrors[payload] = true;
                w.trackESP("ClientSideError", location.href, JSON.stringify(payload));
            }

            return false;
        }
        $.each(onReady.fns, function(i,f) {f()});
    });
</script>

<script>
    var variety,amount,pname,jixu,total,xian,feng,wen,level='',bili= 0,debttype,loan,repayment,period,debttypes,loans,repayments,periods;
    var xianjin= 0,wenjian= 0,fengxian=0;
    var mea1= 0,mea2= 0,mea3= 0,mea4= 0,mea5= 0,mea6= 0,mea7= 0,arr=0;
    $(function() {

        $('#that').click(function() {
            showQn(6,'',1);
        });
        $('#sum').click(function() {
            var exect=document.getElementsByName('exect');
            for(i=0;i<exect.length;i++){
                if(numfor.test(exect[i].value)==false){
                    $("#"+exect[i].id).addClass('invalid');
                    return false;
                }
                else{
                    $("#"+exect[i].id).removeClass('invalid');
                }
            }
            tot1= 0; //年总收入
            tot2= 0; //月总消费=衣食住行+零花钱
            tot3= 0; // 衣食住行
            avge= 0; //月收入
            for(i=7;i<exect.length;i++){
                tot1=tot1+parseInt(exect[i].value);
            }
            avge=parseInt(tot1/12);
            for(i=0;i<7;i++){
                tot2=tot2+parseInt(exect[i].value);
                if(i==0 || i==1 || i==5){
                    tot3=tot3+parseInt(exect[i].value);
                }
            }
             bili=parseInt((1-tot2/avge)*100);
            if(bili>30){
                $("#text").html('而现在，您用的是'+bili+'%的月收入比例，您会不会对自己过去苛刻了点？过于苛刻也许会让您无法长久的实施该计划，您觉得呢？')
                $('#myModal4').modal('show')
                normal=1;

            }
            else if(bili<20){
                $("#text").html('而现在，您用的是'+bili+'%的月收入比例，会不会有点消费过度？您觉得呢？')
                $('#myModal4').modal('show')
                normal=1;
            }
            else{
                showQn(6,'',1);
            }
            acta=1;
        })

        var $qv = $("#questionnaire-view");
        var $qr = $("#questionnaire");
        var accountMin = 0;

        $("#questionnaire-view .ktip-link").bind("tip.show", function() {
            w.trackEvent("OFA", "questionnaire_faq_show", this.id);
        });

        $("#q-numbers").delegate(".q-num.past", "click", function() {
            var $i = $qr.find(".invalid");
            if ($i.length) {
                $i.focus().select();
            } else {
                showQn($(this).index());
            }
        });

        $qr.data("vals", valsFromDom($qr.find("input")))
                .data("init", function(doCalc) {
                    $qr.data("init", function() { showQn(0, true); })
                            .keydown(function(e) {
                                if ($qr.data("transition")) {
                                    return false;
                                }
                                if (e.keyCode == 9 || e.keyCode == 13 && !e.shiftKey) {
                                    var $b = $(e.shiftKey ? "#q-back" :
                                            ("#q-next:visible" + (e.keyCode == 13 ? ",#q-submit:visible" : "")));
                                    if ($b.is(":enabled")) {
                                        e.preventDefault();
                                        $b.triggerHandler("click");
                                    }
                                }
                            })
                            .find("a[href]").attr("tabindex", "-1").end()
                            .find("input").attr("tabindex", "-1")
                            .filter("[type=radio]").click(function(e) {
                                this.focus();
                                updateButtons(e, this, true);
                                if (this.value !== $qr.data("vals")[this.name]) {
                                    calculateRiskTol();
                                }
                            }).end()
                            .filter("[type=checkbox]").click(function(e) {
                                this.focus();
                                updateButtons(e, this, true);
                                if (this.value !== $qr.data("vals")[this.name]) {
                                    calculateRiskTol();
                                }
                            }).end()
                            .filter("[name=age]").each(function(){
                                // jquery does not yet support on input
                                this.oninput = function(e) {
                                    $(this).keypress();
                                }
                            }).bind("keypress keyup", function(e) {
                                var raw = this.value, val = ageFromDom(this), done = val != null;
                                $(this).toggleClass("invalid", !!raw && !done);
                                updateButtons(e, this, done);
                                if (val !== $qr.data("vals")[this.name]) {
                                    calculateRiskTol();
                                }
                            }).end()
                            .filter("[name=lnw]").bind("keypress keyup", function(e) {
                                var raw = this.value, val = amountFromDom(this), done = val != null && val >= accountMin;
                                $(this).toggleClass("invalid", !!raw && !done);
                                if(this.id=='salary'|| this.id=='rent' || this.id=='wages'){
                                    if($("#salary").attr("value")=="" || $("#rent").attr("value")=="" || $("#wages").attr("value")==""){
                                        done=false;
                                    }
                                    if(this.id=='rent'){
                                        $("#rents").html(parseFloat($("#rent").attr("value").replace(/,/g,'')));
                                        $("#xian").html(parseFloat($("#rent").attr("value").replace(/,/g,''))*3);
                                    }
                                }
                                updateButtons(e, this, done);
                                if (val !== $qr.data("vals")[this.name]) {
                                    calculateRiskTol();
                                }
                                if (done && this.selectionStart === raw.length) {
                                    this.value = w.formatNum(val, 0);
                                }
                            }).blur(function() {
                                var val = amountFromDom(this);
                                if (val != null) {
                                    this.value = w.formatNum(val, 0);
                                }
                            });

                    $("#q-back,#q-next").click(function(e) {
                        var back = this.id == "q-back";
                        if (back) {
                            w.trackEvent("OFA", "questionnaire_back");
                        } else {
                            w.trackEvent("OFA", "questionnaire_next", qPayload());
                        }
                        var new_q_num = $qr.data("q") + (back ? -1 : 1);
                        showQn(new_q_num);
                        if(this.id=='q-next' && new_q_num==6){
                           acta=0;
                        }
                    });
                    $("#q-submit").click(function(e) {
                        if(acta==1){

                            var salary= avge;
                            var rent= tot3;
                            var wages= avge-tot2;
                            $.post("/usersurvey/savescore2",{username:'<%= session[:webusername] %>',score:run(),pname:pnames,amount:amounts,variety:varietys,age:$("#age").attr("value"),arr:arr.toFixed(4),
                                debttype:debttypes,loan:loans,repayment:repayments,period:periods,
                                salary:salary,rent:rent,wages:wages,xian:xian,wen:wen,feng:feng,acta:1,level:level,meals:$("#meals").attr("value"),fare:$("#fare").attr("value"),shop:$("#shop").attr("value"),taste:$("#taste").attr("value"),education:$("#education").attr("value"),
                                family:$("#family").attr("value"),intercourse:$("#intercourse").attr("value"),income1:$("#income1").attr("value"),income2:$("#income2").attr("value"),income3:$("#income3").attr("value"),
                                income4:$("#income4").attr("value"),income5:$("#income5").attr("value"),income6:$("#income6").attr("value"),income7:$("#income7").attr("value"),income8:$("#income8").attr("value"),
                                income9:$("#income9").attr("value"),income10:$("#income10").attr("value"),income11:$("#income11").attr("value"),income12:$("#income12").attr("value")},function(data){
                                location.href='/usersurvey/measure/2';
                            });
                        }
                        else{
                            var salary= parseFloat($("#salary").attr("value").replace(/,/g, ""));
                        var rent= $("#rent").attr("value").replace(/,/g, "");
                        var wages= $("#wages").attr("value").replace(/,/g, "");

                        <% if session[:webusername]!=nil %>
                        $.post("/usersurvey/savescore",{username:'<%= session[:webusername] %>',score:run(),pname:pnames,amount:amounts,variety:varietys,age:$("#age").attr("value"),arr:arr.toFixed(4),
                                salary:salary,rent:rent,wages:wages,xian:xian,wen:wen,feng:feng,acta:0,level:level,debttype:debttypes,loan:loans,repayment:repayments,period:periods},function(data){
                            location.href='/usersurvey/measure/2';
                        });
                        <% end %>
                        }
                    });
                    function qPayload() {
                        var $n = $qr.find("input[tabindex=0]").filter(":checked");
                        if (!$n.length) {
                            $n = $n.end();
                        }
                        return $n.attr("name") + ":" + $n.val();
                    }

                    showQn(0);
                    if (doCalc) {
                        calculateRiskTol();
                    }
                });

        var num=0;  var bi=0;
        function showQn(i, immediately,e) {
            //if(e==1){复杂输入}
            if(i==0){$("#title").html("资产体检 系统介绍");}
            if(i==1){$("#title").html("流动性资产 介绍");}
            if(i==2){$("#title").html("保本型资产 介绍");}
            if(i==3){$("#title").html("风险型资产 介绍");}
            if(i==4){$("#title").html("基本信息");}
            if(i==5){$("#title").html("月收入支出");num=1;}else if(i!=6){num=0;}
            if(i==6){
              if(e!=1){
               if(num==1){
                var a1=parseInt($("#wages").attr("value").replace(/,/g, ""));
                var a2=parseInt($("#salary").attr("value").replace(/,/g, ""));
                  bi=parseInt(a1/a2*100);
                   if(bi>30){
                       $("#text").html('而现在，您用的是'+bi+'%的月收入比例，您会不会对自己过去苛刻了点？过于苛刻也许会让您无法长久的实施该计划，您觉得呢？')
                       $('#myModal4').modal('show');
                       acta=0;
                       normal=2;
                       return false;
                   }
                   else if(bi<20){
                       $("#text").html('而现在，您用的是'+bi+'%的月收入比例，会不会有点消费过度？您觉得呢？')
                       $('#myModal4').modal('show');
                       acta=0;
                       normal=2;
                       return false;
                   }
               }
              }
                $("#title").html("已有资产情况");
            }
            if(i==7){$("#title").html("资产净值估算-负债");}
            if(i==8){$("#title").html("资产体检 总结");}
            var ie = !-[1,];
            if(i==8){
                if(ie){
                    document.getElementsByClassName = function(){
                        var tTagName ="*";
                        if(arguments.length > 1){
                            tTagName = arguments[1];
                        }
                        if(arguments.length > 2){
                            var pObj = arguments[2]
                        }
                        else{
                            var pObj = document;
                        }
                        var objArr = pObj.getElementsByTagName(tTagName);
                        var tRObj = new Array();
                        for(var i=0; i<objArr.length; i++){
                            if(objArr[i].className == arguments[0]){
                                tRObj.push(objArr[i]);
                            }
                        }
                        return tRObj;
                    }
                }
                variety=document.getElementsByClassName("founder-name")  //资产品种
                amount=document.getElementsByClassName("init-share")  //资产金额
                pname=document.getElementsByClassName("pname")  //产品名称
                debttype=document.getElementsByClassName("found-name")  //贷款类型
                loan=document.getElementsByClassName("init")  //总负债
                repayment=document.getElementsByClassName("repayment")  //每月还贷
                period=document.getElementsByClassName("period")  //贷款年限
                xianjin=0;
                wenjian=0;
                fengxian=0;
                for(k=0;k<debttype.length;k++){
                    var c1=loan[k].value.replace(/,/g, "");
                    var c2=repayment[k].value.replace(/,/g, "");
                    if(c1==''){c1=0;}
                    if(c2==''){c2=0;}
                    if(k==0){
                        debttypes= debttype[k].value;
                        loans= c1;
                        repayments= c2;
                        periods= period[k].value;
                    }
                    else{
                        debttypes=debttypes+','+debttype[k].value;
                        loans=loans+','+c1;
                        repayments=repayments+','+c2;
                        periods=periods+','+period[k].value;
                    }
                }
                for(j=0;j<variety.length;j++){
                    var ccc=amount[j].value.replace(/,/g, "");
                    if(ccc==''){ccc=0;}
                    if(variety[j].value=="银行活期"){xianjin=xianjin+parseFloat(ccc);mea1=mea1+parseFloat(ccc)}
                    else if(variety[j].value=="余额宝"){xianjin=xianjin+parseFloat(ccc);mea2=mea2+parseFloat(ccc)}
                    else if(variety[j].value=="其他货币基金"){xianjin=xianjin+parseFloat(ccc);mea2=mea2+parseFloat(ccc)}
                    else if(variety[j].value=="银行理财产品"){wenjian=wenjian+parseFloat(ccc);mea3=mea3+parseFloat(ccc)}
                    else if(variety[j].value=="银行定期"){wenjian=wenjian+parseFloat(ccc);mea4=mea4+parseFloat(ccc)}
                    else if(variety[j].value=="债券型基金"){wenjian=wenjian+parseFloat(ccc);mea5=mea5+parseFloat(ccc)}
                    else if(variety[j].value=="股票"){fengxian=fengxian+parseFloat(ccc);mea6=mea6+parseFloat(ccc)}
                    else if(variety[j].value=="股票型基金"){fengxian=fengxian+parseFloat(ccc);mea6=mea6+parseFloat(ccc)}
                    else if(variety[j].value=="贵金属"){fengxian=fengxian+parseFloat(ccc);mea7=mea7+parseFloat(ccc)}
                    else if(variety[j].value=="其它"){fengxian=fengxian+parseFloat(ccc);mea7=mea7+parseFloat(ccc)}
                    if(j==0){
                        varietys=variety[j].value;
                        amounts=ccc;
                        pnames=pname[j].value;
                    }
                    else{
                        varietys=varietys+','+variety[j].value;
                        amounts=amounts+','+ccc;
                        pnames=pnames+','+pname[j].value;
                    }
                }
                jixu=xianjin+wenjian+fengxian;//积蓄
                if(acta==0){
                total=parseInt((parseFloat($("#wages").attr("value").replace(/,/g, ""))*12+jixu)/100)*100;//总资产
                xian=parseInt((parseFloat($("#rent").attr("value").replace(/,/g, ""))*3)/100)*100;
                }
                else{
                    total=parseInt((tot1+jixu)/100)*100;//总资产
                    xian=parseInt((parseFloat(tot3)*3)/100)*10;
                }
                feng=parseInt((total*(80-parseFloat($("#age").attr("value").replace(/,/g, "")))/100)/100)*100;
                wen=total-xian-feng;
                arr=parseFloat('<%= @hash["活期存款"][0] %>')*mea1/jixu+parseFloat('<%= @hash["货币基金"][0] %>')*mea2/jixu+parseFloat('<%= @hash["银行理财产品"][0] %>')*mea3/jixu+parseFloat('<%= @hash["定期存款"][0] %>')*mea4/jixu+
                    parseFloat('<%= @hash["债券基金"][0] %>')*mea5/jixu+parseFloat('<%= @hash["股票型基金"][0] %>')*mea6/jixu+0.03*mea7/jixu;

                if(acta==0){
                    if(parseFloat($("#salary").attr("value").replace(/,/g, ""))<parseFloat($("#rent").attr("value").replace(/,/g, ""))+parseFloat($("#wages").attr("value").replace(/,/g, ""))){
                        level=0;
                    }
                    else if(total<xian){
                        level=1;
                    }
                    else if(total<xian+feng){
                        level=2;
                    }
                    else{
                        level=3;
                    }
                }
                else if(acta==1){   //精确输入
                    if(avge<tot2){
                        level=0;
                    }
                    else if(jixu+tot1<xian){
                        level=1;
                    }
                    else if(jixu+tot1<xian+feng){
                        level=2;
                    }
                    else{
                        level=3;
                    }
                }

                if(xianjin/jixu>xian/total){
                    $(".liu").html("过高")
                }
                else if(xianjin/jixu<xian/total){
                    $(".liu").html("过低")
                }
                else{
                    $(".liu").html("适中")
                }
                if(wenjian/jixu>wen/total){
                    $(".bao").html('过高')
                }
                else if(wenjian/jixu<wen/total){
                    $(".bao").html('过低')
                }
                else{
                    $(".bao").html('适中')
                }
                if(fengxian/jixu>feng/total){
                    $(".feng").html('过高')
                }
                else if(fengxian/jixu<feng/total){
                    $(".feng").html('过低')
                }
                else{
                    $(".feng").html('适中')
                }

                if(acta==0){
                    if(bi<20){
                        $(".result").html("“您当前用"+bi+"%的月工资收入用来做储蓄投资，我们建议您能提高到20%~25%左右”。")
                    }
                }
                else{
                    if(bili<20){
                        $(".result").html("“您当前用"+bili+"%的月工资收入用来做储蓄投资，我们建议您能提高到20%~25%左右”。")
                    }
                }

                if(level==0){
                    $("#level0").show();
                    $("#level1").hide();
                    $("#level2").hide();
                    $("#level3").hide();
                }
                else if(level==1){
                    $("#level0").hide();
                    $("#level1").show();
                    $("#level2").hide();
                    $("#level3").hide();
                }
                else if(level==2){
                    $("#level0").hide();
                    $("#level1").hide();
                    $("#level2").show();
                    $("#level3").hide();
                }
                else if(level==3){
                    $("#level0").hide();
                    $("#level1").hide();
                    $("#level2").hide();
                    $("#level3").show();
                }

                animate(0,run());
                /*
                if(acta==0){
                    if(wen<=0){
                        alert("您每个月的零花钱会不会太多了？")
                        i=5;
                        $("#title").html("月收入支出");
                    }
                    else if(parseFloat($("#salary").attr("value").replace(/,/g, ""))-parseFloat($("#rent").attr("value").replace(/,/g, ""))-parseFloat($("#wages").attr("value").replace(/,/g, ""))<=0){
                        alert("月收入必须大于衣食住行与每月储蓄金额之和。");
                        i=5;
                        $("#title").html("月收入支出");
                    }
                    else if(xianjin<=0){
                        alert("我们看您没有输入活期存款金额，您应该不会身上一分钱现金都没有吧？");
                        i=6;
                        $("#title").html("已有资产情况");
                    }
                    else if(jixu>=500000){
                        alert("请不要把房屋资产也算进去哦。");
                    }
                }
                */
            }

            var $qns = $qr.children(".question");
            var $qn = $qns.eq(i);
            if (i >= 0 && $qn.length) {
                $qns.eq($qr.data("q")).find("input").attr("tabindex", "-1");

                $qr.data({q: i, transition: true});
                var newTop = -i * $qn.height() + "px";

                //  alert(newTop)
                if (immediately) {
                    $qr.css("top", newTop);
                }
                if (immediately || $qr.css("top") === newTop) {
                    setTimeout(onAtQn, 5);
                } else {
                    $qr.animate({"top": newTop}, onAtQn);
                }
                $("#q-back span").text(i === 0 ? "上一题" : "上一题");
                $("#q-back").attr("disabled", i == 0);

                var isLastQn = i == $qns.length - 1;
                $("#q-buttons").toggleClass("q-submit", isLastQn);

                var $i = $qn.find("input");
                var done = $i.is(":radio") ? $i.is(":checked") : !!$i.val();
            <% if session[:webusername]!=nil && @examination!=nil %>
                if(i==4 && '<%= @examination.age %>'!=""){done=true;}
            <% end %>
                $(isLastQn ? "#q-submit" : "#q-next").attr("disabled", !done);
                $qr.trigger("qr:nav", i);

                w.trackEvent("OFA", "question_display", (i+1) + "." + $i.attr("name"));
            }

            function onAtQn() {
                $qr.removeData("transition");
                $qn.find("input").attr("tabindex", "0")
                        .filter("[checked=true],input:first").focus().select();
            }
        }

        function updateButtons(e, inputEl, isDone) {
            if (e.keyCode == 9 || e.keyCode == 13) {
                return;
            }
            var $i = $(inputEl), $q = $i.closest(".question");
            var isLastQn = $q.nextAll(".question:first").length == 0;
            $(isLastQn ? "#q-submit" : "#q-next").attr("disabled", !isDone);
            $("#q-back").attr("disabled", $i.hasClass("invalid") || $q.is(".first"));
        }

        function calculateRiskTol() {
            var min = 0.1;
            var max = 10;
            var granularity = 10.0;
            var $i = $qr.find("input");
            var vals = valsFromDom($i);
            var tol = recommendRiskTolerance2(vals, min, max, granularity);
            var rec = tol.toFixed(1);
            $i.filter("[name=rec]").val(rec);
            vals.rec = +rec;
            $qr.data("vals", vals);
            $qr.triggerHandler("qr:change", +rec);
        }
    });
</script>
<script>
    $(function() {
        var currentModelNumber = "4"; //SAA201210
        var moveMeter = attachRiskMeter("#risk-meter");

        var $n = $("#q-numbers"), $qr = $("#questionnaire"), $qs = $qr.find(".question");
        $n.find(".q-num").each(function(i) {
            if ($qs.eq(i).find("input").filter(function() {return this.type == "radio" ? this.checked : !!this.value}).length) {
                $(this).addClass("past");
            } else {
                return false;
            }
        });
        $qr.bind("qr:nav", function(e, i) {
            var $n = $("#q-numbers");
            $n.children(".q-num.curr").removeClass("curr").addClass("past");
            $n.children().eq(i).removeClass("past").addClass("curr");
        })
                .bind("qr:change", function(e, tol) {
                    moveMeter(tol / 10);
                })
                .submit(function(e) {
                    e.preventDefault();
                    var $qr = $(this);
                    if (!$qr.data("submitted")) {
                        $qr.data("submitted", true);
                        var cookieName = "asset_allocation";
                        var o = deserializePlan(w.cookie(cookieName)) || {};
                        $.each($qr.serializeArray(), function(i,v) {
                            o[v.name] = v.value.replace(/[$,]/g, "");
                        });
                        o.tol = o.rec;
                        o.amount = o.amount || o.lnw;
                        var check=document.getElementsByName("stability");
                        o.stability="";
                        for(var i=0;i<check.length;i++){
                            if(check[i].checked==true){
                                if(o.stability==""){
                                    o.stability=check[i].value;
                                }
                                else{
                                    o.stability=o.stability+check[i].value;
                                }
                            }
                        }
                        w.cookie(cookieName, serializePlan(o, currentModelNumber), 14);
                        location = $qr.attr("action");
                    }
                })
                .data("init")(true);
    });
</script>




<script>
    var eCalcShareHolders = new Object();
    var debug = false;

    function addFounder(founder, isFirst)
    {
        var aaa = genId(eCalcShareHolders);
        var f = founder;
        if(f == null) // create a new share holder
        {
            f = new ShareHolder();
            f.setupShareHolder(true, false, false);
            f.id= "founder-" + aaa;
            f.name = "Founder " + getNewNameNumber(eCalcShareHolders, "founder");
            eCalcShareHolders[f.id] = f;
        }

        if(!isFirst)
        {
            var fi = $("div.founder-inputs div.op-input").last().clone().removeClass("first");
            $(fi).find(".icon-remove-sign").show();
            var fid = f.id;
            $(fi).attr("fid", fid);
            // put values in
            $(fi).find(".founder-name").attr("id",'variety'+aaa);
            $(fi).find(".init-share").val(0);
            $(fi).find(".init-share").attr("id",'amount'+aaa);
            $(fi).find(".pname").attr("id",'pname'+aaa);
            $("div.founder-inputs").append(fi);
        }
    }

    function add(found, isFirst)
    {
        var aaa = genId(eCalcShareHolders);
        var f = found;
        if(f == null) // create a new share holder
        {
            f = new ShareHolder();
            f.setupShareHolder(true, false, false);
            f.id= "found-" + aaa;
            f.name = "Found " + getNewNameNumber(eCalcShareHolders, "found");
            eCalcShareHolders[f.id] = f;
        }

        if(!isFirst)
        {
            var fi = $("div.found-inputs div.op-input").last().clone().removeClass("first");
            $(fi).find(".icon-remove-sign").show();
            var fid = f.id;
            $(fi).attr("fid", fid);
            // put values in
            $(fi).find(".found-name").attr("id",'debttype'+aaa);
            $(fi).find(".init").val(0);
            $(fi).find(".init").attr("id",'loan'+aaa);
            $(fi).find(".repayment").attr("id",'repayment'+aaa);
            $(fi).find(".period").attr("id",'period'+aaa);
            $("div.found-inputs").append(fi);
        }
    }

    var ShareHolder = function()
    {
        this.isFounder = true;
        this.isEmployee = false;
        this.isSeries = false;
        this.percentStake = 0;
        this.exitValue = 0;
        this.totalShares = 0;
        this.name = "name";
        this.id = null;

        this.setFounder = function()
        {
            this.isFounder = true;
            this.isEmployee = false;
            this.isSeries = false;
        }

        this.setSeries = function()
        {
            this.isFounder = false;
            this.isEmployee = false;
            this.isSeries = true;
        }

        this.setEmployee = function()
        {
            this.isFounder = false;
            this.isEmployee = true;
            this.isSeries = false;
        }

        this.setupShareHolder = function(isFounder, isEmployee, isSeries)
        {
            if(isFounder)
            {
                this.isFounder = true;
                this.isEmployee = false;
                this.isSeries = false;
            }
            else if(isEmployee)
            {
                this.isFounder = false;
                this.isEmployee = true;
                this.isSeries = false;
            }
            else if(isSeries)
            {
                this.isFounder = false;
                this.isEmployee = false;
                this.isSeries = true;
            }
        }

        // Use to create a JSON object from the Founder
        this.renderJson = function()
        {
            return {
                isFounder: this.isFounder, isEmployee: this.isEmployee,
                isSeries: this.isSeries, percentStake: this.percentStake,
                totalShares: this.totalShares, id: this.id, name:this.name
            };
        }
    }

    function genId(map)
    {
        //cslog("Generating id for object.");
        var tId = 0;
        for(var id in map)
        {
            var count = id.split("-")[1];
            if(getInteger(count) > tId)
            {
                tId = count;
            }
        }
        return getInteger(tId) + 1;
    }

    function getInteger(v)
    {
        if (v != null && typeof(v) == 'string' & v != "")
        {
            v = v.replace(/\$/, "");
            v = v.replace(/,/g, "");
            v = v.replace(/\..*/g, "");
            var r = parseInt(v, 10);
            if (!isNaN(r))
                return r;
        }
        if (typeof(v) == "number")
        {
            return parseInt(v, 10);
        }

        return 0;
    }


    function getNewNameNumber(shareHolders, type)
    {
        var fRegex = /founder\s\d/i;
        if(type == "employee")
        {
            fRegex = /employee\s\d/i;
        }
        var latestId = 1;
        for(var id in shareHolders)
        {
            if(type != "employee" && shareHolders[id].isFounder && fRegex.test(shareHolders[id].name))
            {
                var curNum = getInteger(fRegex.exec(shareHolders[id].name)[0].split(" ")[1]);
                if(curNum >= latestId)
                {
                    latestId  = curNum + 1;
                }
            }
            else if(type == "employee" && shareHolders[id].isEmployee && fRegex.test(shareHolders[id].name))
            {
                var curNum = getInteger(fRegex.exec(shareHolders[id].name)[0].split(" ")[1]);
                if(curNum >= latestId)
                {
                    latestId  = curNum + 1;
                }
            }
        }
        return latestId;
    }

    function removeFounder(e)
    {
        var fi = $(e).closest("div.op-input");
        var fid = $(fi).attr("fid");
        delete eCalcShareHolders[fid];
        $(fi).detach();
    }
    /*
    $("#age-decrease0").click(function(){
        if(parseInt(xian*0.9)<parseInt($("#xian1").attr("value")) && parseInt(feng*1.1)>parseInt($("#feng1").attr("value")) && parseInt($("#xian1").attr("value"))>=200){
            $("#xian1").attr("value",parseInt($("#xian1").attr("value"))-100);
            $("#feng1").attr("value",parseInt($("#feng1").attr("value"))+100);
            $("#xian0").html((parseInt($("#xian1").attr("value"))/total*100).toFixed(1).toString()+'%');
            $("#feng").html((parseInt($("#feng1").attr("value"))/total*100).toFixed(1).toString()+'%');
            $("#xian1").removeClass("invalid");
            $("#feng1").removeClass("invalid");
            $(".alert").hide();
        }
        else{
            if(parseInt(xian*0.9)>=parseInt($("#xian1").attr("value"))){$("#xian1").addClass("invalid");}
            if(parseInt(feng*1.1)<=parseInt($("#feng1").attr("value"))){$("#feng1").addClass("invalid");}
            $(".alert").show();
        }
    });
    $("#age-increase0").click(function(){
        if(parseInt(xian*1.1)>parseInt($("#xian1").attr("value")) && parseInt(feng*0.9)<parseInt($("#feng1").attr("value"))  && parseInt($("#feng1").attr("value"))>=200){
            $("#xian1").attr("value",parseInt($("#xian1").attr("value"))+100);
            $("#feng1").attr("value",parseInt($("#feng1").attr("value"))-100);
            $("#xian0").html((parseInt($("#xian1").attr("value"))/total*100).toFixed(1).toString()+'%');
            $("#feng").html((parseInt($("#feng1").attr("value"))/total*100).toFixed(1).toString()+'%');
            $("#xian1").removeClass("invalid");
            $("#feng1").removeClass("invalid");
            $(".alert").hide();
        }
        else{
            if(parseInt(xian*1.1)<=parseInt($("#xian1").attr("value"))){$("#xian1").addClass("invalid");}
            if(parseInt(feng*0.9)>=parseInt($("#feng1").attr("value"))){$("#feng1").addClass("invalid");}
            $(".alert").show();
        }
    });

    $("#age-decrease1,#age-increase2").click(function(){
        if(parseInt(wen*0.9)<parseInt($("#wen1").attr("value")) && parseInt(feng*1.1)>parseInt($("#feng1").attr("value")) && parseInt($("#wen1").attr("value"))>=200){
            $("#wen1").attr("value",parseInt($("#wen1").attr("value"))-100);
            $("#feng1").attr("value",parseInt($("#feng1").attr("value"))+100);
            $("#wen").html((parseInt($("#wen1").attr("value"))/total*100).toFixed(1).toString()+'%');
            $("#feng").html((parseInt($("#feng1").attr("value"))/total*100).toFixed(1).toString()+'%');
            $("#wen1").removeClass("invalid");
            $("#feng1").removeClass("invalid");
            $(".alert").hide();
        }
        else{
            if(parseInt(wen*0.9)>=parseInt($("#wen1").attr("value"))){$("#wen1").addClass("invalid");}
            if(parseInt(feng*1.1)<=parseInt($("#feng1").attr("value"))){$("#feng1").addClass("invalid");}
            $(".alert").show();
        }
    });
    $("#age-increase1,#age-decrease2").click(function(){
        if(parseInt(wen*1.1)>parseInt($("#wen1").attr("value")) && parseInt(feng*0.9)<parseInt($("#feng1").attr("value"))  && parseInt($("#feng1").attr("value"))>=200){
            $("#wen1").attr("value",parseInt($("#wen1").attr("value"))+100);
            $("#feng1").attr("value",parseInt($("#feng1").attr("value"))-100);
            $("#wen").html((parseInt($("#wen1").attr("value"))/total*100).toFixed(1).toString()+'%');
            $("#feng").html((parseInt($("#feng1").attr("value"))/total*100).toFixed(1).toString()+'%');
            $("#wen1").removeClass("invalid");
            $("#feng1").removeClass("invalid");
            $(".alert").hide();
        }
        else{
            if(parseInt(wen*1.1)<=parseInt($("#wen1").attr("value"))){$("#wen1").addClass("invalid");}
            if(parseInt(feng*0.9)>=parseInt($("#feng1").attr("value"))){$("#feng1").addClass("invalid");}
            $(".alert").show();
        }
    });
    */
    function run(){
        if(jixu!=0 && total!=0){
        var score=(3-(Math.abs(xian/total-xianjin/jixu)+Math.abs(wen/total-wenjian/jixu)+Math.abs(feng/total-fengxian/jixu)))*100/3
        }
        else{
            var score=0;
        }
        return  score.toFixed(1);
    }

    $(document).ready(function(){
        <% if session[:webusername]==nil %>
           location.href="/sales/login?start=1";
        <% end %>

        <% if session[:webusername]!=nil && @examination!=nil %>
        <% if @examination.age!=nil %>$("#age").attr("value",parseInt('<%= @examination.age %>'));<% end %>
        <% if @examination.salary!=nil %>$("#salary").attr("value",parseInt('<%= @examination.salary %>'));<% end %>
        <% if @examination.rent!=nil %>$("#rent").attr("value",parseInt('<%= @examination.rent %>'));<% end %>
        <% if @examination.wages!=nil %>$("#wages").attr("value",parseInt('<%= @examination.wages %>'));<% end %>
        <% if @examination.meals!=nil %>$("#meals").attr("value",parseInt('<%= @examination.meals %>'));<% end %>
        <% if @examination.fare!=nil %>$("#fare").attr("value",parseInt('<%= @examination.fare %>'));<% end %>
        <% if @examination.shop!=nil %>$("#shop").attr("value",parseInt('<%= @examination.shop %>'));<% end %>
        <% if @examination.taste!=nil %>$("#taste").attr("value",parseInt('<%= @examination.taste %>'));<% end %>
        <% if @examination.education!=nil %>$("#education").attr("value",parseInt('<%= @examination.education %>'));<% end %>
        <% if @examination.family!=nil %>$("#family").attr("value",parseInt('<%= @examination.family %>'));<% end %>
        <% if @examination.intercourse!=nil %>$("#intercourse").attr("value",parseInt('<%= @examination.intercourse %>'));<% end %>
        <% if @examination.income1!=nil %>$("#income1").attr("value",parseInt('<%= @examination.income1 %>'));<% end %>
        <% if @examination.income2!=nil %>$("#income2").attr("value",parseInt('<%= @examination.income2 %>'));<% end %>
        <% if @examination.income3!=nil %>$("#income3").attr("value",parseInt('<%= @examination.income3 %>'));<% end %>
        <% if @examination.income4!=nil %>$("#income4").attr("value",parseInt('<%= @examination.income4 %>'));<% end %>
        <% if @examination.income5!=nil %>$("#income5").attr("value",parseInt('<%= @examination.income5 %>'));<% end %>
        <% if @examination.income6!=nil %>$("#income6").attr("value",parseInt('<%= @examination.income6 %>'));<% end %>
        <% if @examination.income7!=nil %>$("#income7").attr("value",parseInt('<%= @examination.income7 %>'));<% end %>
        <% if @examination.income8!=nil %>$("#income8").attr("value",parseInt('<%= @examination.income8 %>'));<% end %>
        <% if @examination.income9!=nil %>$("#income9").attr("value",parseInt('<%= @examination.income9 %>'));<% end %>
        <% if @examination.income10!=nil %>$("#income10").attr("value",parseInt('<%= @examination.income10 %>'));<% end %>
        <% if @examination.income11!=nil %>$("#income11").attr("value",parseInt('<%= @examination.income11 %>'));<% end %>
        <% if @examination.income12!=nil %>$("#income12").attr("value",parseInt('<%= @examination.income12 %>'));<% end %>
        var variety='<%= @examination.variety %>'.split(",");
        var amount='<%= @examination.amount %>'.split(",");
        var pname='<%= @examination.pname %>'.split(",");
        var debttype='<%= @examination.debttype %>'.split(",");
        var loan='<%= @examination.loan %>'.split(",");
        var repayment='<%= @examination.repayment %>'.split(",");
        var period='<%= @examination.period %>'.split(",");
        for(i=0;i<variety.length;i++){
            if(i==0){
                $("#variety").attr("value",variety[i]);
                $("#amount").attr("value",amount[i]);
                $("#pname").attr("value",pname[i]);
            }
            else{
                addFounder(null, false);
                $("#variety"+i).attr("value",variety[i]);
                $("#amount"+i).attr("value",amount[i]);
                $("#pname"+i).attr("value",pname[i]);
            }
        }
        for(k=0;k<debttype.length;k++){
            if(k==0){
                $("#debttype").attr("value",debttype[k]);
                $("#loan").attr("value",loan[k]);
                $("#repayment").attr("value",repayment[k]);
                $("#period").attr("value",period[k]);
            }
            else{
                add(null, false);
                $("#debttype"+(i+k-1).toString()).attr("value",debttype[k]);
                $("#loan"+(i+k-1).toString()).attr("value",loan[k]);
                $("#repayment"+(i+k-1).toString()).attr("value",repayment[k]);
                $("#period"+(i+k-1).toString()).attr("value",period[k]);
            }
        }
        <% end %>
        initPieChart();
    });
</script>

<%= javascript_include_tag "excanvas.js" %>
<%= javascript_include_tag "jquery.easy-pie-chart.js" %>
<script type="text/javascript">
    var initPieChart = function() {
        $('.percentage').easyPieChart({
            animate: 1000
        });
    };
    function animate(i,a){
        if(i<a){
            $('.percentage').each(function() {
                $(this).data('easyPieChart').update(i);
                $('span', this).text(i);
            });
            setTimeout("animate("+(i+1).toString()+','+a+")",50);
        }
        else{
            $('.percentage').each(function() {
                $(this).data('easyPieChart').update(a);
                $('span', this).text(a);
            });
        }
    }
</script>