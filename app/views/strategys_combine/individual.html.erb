<%= javascript_include_tag "My97DatePicker/WdatePicker.js" %>
<%= javascript_include_tag "jQuery.validity.min.js" %>
<%= stylesheet_link_tag "jquery.validity.css" %>
<%= javascript_include_tag "jquery.autocomplete.js" %>
<%= stylesheet_link_tag "jquery.autocomplete.css" %>
<%= stylesheet_link_tag "jslider.css" %>
<%= stylesheet_link_tag "jslider.plastic.css" %>
<%= javascript_include_tag "jshashtable-2.1_src.js" %>
<%= javascript_include_tag "jquery.numberformatter-1.2.3.js" %>
<%= javascript_include_tag "tmpl.js" %>
<%= javascript_include_tag "jquery.dependClass-0.1.js" %>
<%= javascript_include_tag "draggable-0.1.js" %>
<%= javascript_include_tag "jquery.slider.js" %>
<%= render "side" %>
<div class="centerrightframe">
  <div class="strategy_config">
    <h2>套利策略配置</h2>
  <div class="strategy_config_selecting">
    <h3>策略选择：</h3>

      <form id="form1" runat="server">
      <div>
          <input id="keyword1" value="点击我 选择策略" onclick="this.value=''" onmousemove="$('#keyword1').focus();"/>
      </div>
      </form>
      <div id="selectedstrategy">
        <p>选择结果：<%= @strategyweb.name %></p>
      </div>
  </div>

<script type="text/javascript">
  search("#keyword1","#getValue1");
    function search(keywardid,getvalueid) {
        function setdata(name,control,action,id){
            this.name=name;
            this.control=control;
            this.action=action;
            this.id=id;
        }
        var data=new Array();
        <% for i in 0..@strategywebs.size-1%>
          data[<%= i %>]=new setdata('<%= @strategywebs[i].name%>','<%= @strategywebs[i].control%>','<%= @strategywebs[i].action%>','<%= @strategywebs[i].id%>')
        <% end%>
        //var data = [{name:'1',controls:"xx"},{name:'2',controls:"xx"},{name:'3',controls:"xx"}];

        var searchdate;
        function findValueCallback(event, data, formatted) {
        		//$("#content").html("<strong>"+(!data ? "没有匹配！" : "您选择的是：" + formatted)+"</strong>");
            $("#selectedstrategy").html("选择结果："+(!data ? "没有匹配！" :  formatted)+"</strong>");
            searchdate=data;
            location.href="/strategys_combine/individual/"+searchdate.id
        	}
        $(keywardid).autocomplete(data, {
                             max: 12,    //列表里的条目数
                             minChars: 0,    //自动完成激活之前填入的最小字符
                             width: 400,     //提示的宽度，溢出隐藏
                             scrollHeight: 300,   //提示的高度，溢出显示滚动条
                             matchContains: true,    //包含匹配，就是data参数里的数据，是否只要包含文本框里的数据就显示
                             autoFill: false,    //自动填充
                             formatItem: function(data, i, total) {
                                 return "<I>"+data.name+"</I>";
                             },
                             formatMatch: function(data, i, total) {
                                 return data.name;
            		         },
                             formatResult: function(data) {
                                 return data.name;
                             }
        });
       $(keywardid).result(findValueCallback);

        $(getvalueid).click(function() {
            if($(keywardid).attr("value")==""){
                alert("请选择策略！")
            }
            else
            $(keywardid).search(location.href="/strategys_combine/strategy_s1/"+searchdate.id)
        });

    }
</script>

<div class="strategy_config_para">
<h3>策略参数配置:</h3>
<%= form_tag do %>
    <% for i in 0..@strategy_params.size-1 %>
        <%= @strategy_params[i].paramname  %><span style="display: inline-block; width: 200px; padding: 0 5px;"><input id="<%= @strategy_params[i].paramname  %>" name="<%= @strategy_params[i].paramname  %>" title="<%= @strategy_params[i].paramname  %>" type="slider" value="50"/></span><br><br>
        <script type="text/javascript" charset="utf-8">
          jQuery("#<%= @strategy_params[i].paramname  %>").slider({
            from: -100,
            to: 100,
            step: 1,
            dimension: '',
            skin: 'plastic',
            scale: ['-100', '|', '-50', '|', '0', '|', '50', '|', '100']
          });
        </script>
     <% end %>
</div>
   <div class="strategy_config_commodity">
    <h3>策略品种：</h3>
     <% if @strategyweb.strategyid.slice(0,2)=="04" %>
    <% for i in 0..@rightids_arr_d.size-1 %>
        <p><%= check_box_tag 'commoditynames[]',@rightids_arr_d[i],:checked=>true%><%= @rightids_arr_d[i] %></p>
    <% end %>
        <% else %>
    <% for i in 0..@rightids_arr.size-1 %>
        <p><%= check_box_tag 'commoditynames[]',@rightids_arr[i],:checked=>true%><%= @rightids_arr[i] %></p>
    <% end %>
    <% end %>
    </input>
   </div>

    <div class="strategy_config_startdate">
    <h3>评估开始时间：</h3>
    <%= text_field_tag :startdate, params[:startdate] ,:onClick=>"WdatePicker()",:class=>"Wdate",:id=>"startdate",:name=>"startdate",:title=>" 策略开始时间"%><br>
    </div>

    <div class="button_confirm_2"><a href="#ensure_test" class="login-window">提交</a></div>
     <br>


            <div id="ensure_test" class="login-popup">
            <a href="#" class="close"><%= image_tag ("close_pop.png"), :class=>"btn_close" ,:title=>"Close Window" ,:alt=>"Close"%></a>
              <div style="width: 200px;height: 200px;background-color: white;">
                我想在
                <% for i in 0..@rightids_arr.size-1 %>
                    <%= @rightids_arr[i] %>&nbsp;
                <% end %>
                上，用<%= @strategyweb.name %>测试。
                <%= submit_tag "确定测试"%>
                <a class="close">取消</a>
              </div>
    		</div>

<% end %>

 <script type="text/javascript">

   var rightid=new Array();
   <% if @strategyweb.strategyid.slice(0,2)=="04" %>
   <% for i in 0..@rightids_arr.size-1 %>
       rightid[<%= i%>]='<%= @rightids_arr_d[i] %>'
   <% end %>
   <% else %>
       rightid[<%= i%>]='<%= @rightids_arr[i] %>'
   <% end %>
    var checked_flag=0
   for(var i=0;i<rightid.length;i++){
       if($("input[value$="+rightid[i]+"]").attr("checked")=="checked"){
           checked_flag=1;
           break;
       }
   }
     $(function() {
         $("form").validity(function() {
             $("#period")
                 .require()
                 .match("number");
             $("#losses")
                 .require()
                 .match("number");
             $("#wins")
                 .require()
                 .match("number");
             if(checked_flag==0){
             $("#checkbox1")
                 .require()  }
             $("#objecttype")
                 .require();
             $("#startdate")
                 .require();
         });
     });
 </script>
  </div>
</div>