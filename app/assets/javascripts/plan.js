w=w||{};w.plan={riskToIndex:function(a,b){return Math.round(a*b)-1},cleanRisk:function(a,b,c,d){a=Math.min(Math.max(c,a),b);return Math.round(a*d)/d},getAllocation:function(a,b){var a=w.plan.cleanRisk(a,b.max_risk,b.min_risk,b.granularity),c=w.plan.riskToIndex(a,b.granularity),d={};_.each(b.allocations,function(a,b){a[c]&&(d[b]=a[c])});return d},allocationAsPie:function(a,b){return _.map(a,function(a,d){return{id:d,value:a,orderIndex:b[d]}})}};var dataStub={data:function(){return $.noop}};
function serializePlan(a,b){function c(a){return(""+(a||"")).replace(/[$,]/g,"")}b=parseInt(b||4);return[b,c(a.amount),a.tol,a.rec,a.age,c(a.lnw),c(a.income),a.stability,a.goal,a.options,a.angel,a.concern,a.response,a.portfolio].join("|")}function deserializePlan(a){a=a.split("|");if(0<=a[0])return{amount:a[1],tol:a[2],rec:a[3],age:a[4],lnw:a[5],income:a[6],stability:a[7],goal:a[8],options:a[9],angel:a[10],concern:a[11],response:a[12],portfolio:a[13]}}
function valsFromDom(a){return{age:ageFromDom(a.filter("[name=age]")[0]),stability:a.filter("[name=stability]:checked").val(),options:a.filter("[name=options]:checked").val(),angel:a.filter("[name=angel]:checked").val(),goal:a.filter("[name=goal]:checked").val(),concern:a.filter("[name=concern]:checked").val(),response:a.filter("[name=response]:checked").val(),portfolio:a.filter("[name=portfolio]:checked").val(),lnw:amountFromDom(a.filter("[name=lnw]")[0]),income:amountFromDom(a.filter("[name=income]")[0]),
rec:parseFloat(a.filter("[name=rec]").val())}}function ageFromDom(a){a=a.value;return a.match(/^\d{1,2}$/)?+a:null}function amountFromDom(a){a=a.value.replace(/[\$,]/g,"");return a.match(/^\d+$/)?+a:null}
function attachAllocationPie(a,b){if(!window.w.hasSVG())return $.noop;var b=$.extend({gradients:{"plan-pie-grad-0":["#70c046","#ace98c"],"plan-pie-grad-1":["#b847af","#f369e8"],"plan-pie-grad-2":["#2293bb","#6ac9ea"],"plan-pie-grad-3":["#ebab17","#f4cf66"],"plan-pie-grad-4":["#5d4ef9","#8c81ff"],"plan-pie-grad-5":["#dc570e","#ff7e00"],"plan-pie-grad-6":["#a57005","#daa73e"],"plan-pie-grad-7":["#e19e7d","#ffc8ad"],"plan-pie-grad-8":["#ef45a8","#ff7bc7"],"plan-pie-grad-9":["#b8124a","#f7296c"],"plan-pie-grad-10":["#065190",
"#1a72bd"],"plan-pie-grad-11":["#296c30","#52a95b"]},color:function(a){return"url(#plan-pie-grad-"+a+")"}},b||{}),c=$(a),d=c.width(),i=c.height(),h=Math.min(d,i)/2,g=h-(b.shadowPx||0),p=d3.svg.arc().startAngle(function(a){return a.startAngle}).endAngle(function(a){return a.endAngle}).innerRadius(0).outerRadius(g),e=d3.layout.pie().sort(null)(b.allocation),m=d3.select(c[0]).append("svg:svg").attr("width",d).attr("height",i).append("svg:g").attr("transform","translate("+d/2+","+i/2+")"),d=b.gradients||
b.shadowPx?m.append("svg:defs"):null;if(b.gradients)for(var j in b.gradients)i=b.gradients[j],c=d.append("svg:radialGradient").attr("id",j).attr("gradientUnits","userSpaceOnUse").attr("cx",0).attr("cy",0).attr("r",g),c.append("svg:stop").attr("offset",0).attr("stop-color",i[1]),c.append("svg:stop").attr("offset",0.3).attr("stop-color",i[1]),c.append("svg:stop").attr("offset",1).attr("stop-color",i[0]);if(b.shadowPx){j="pie-shadow-"+(""+Math.random()).substring(2);c=d.append("svg:radialGradient").attr("id",
j).attr("gradientUnits","userSpaceOnUse").attr("cx",0).attr("cy",0).attr("r",h);g=1-g/(4*h);for(d=0;5>d;d++)i=g+(1-g)*(d+1)/5,c.append("svg:stop").attr("offset",i).attr("stop-color","#000").attr("stop-opacity",d&&10*(i-1)*(i-1));m.append("svg:circle").attr("r",h).style("fill","url(#"+j+")")}m.selectAll("path").data(e).enter().append("svg:path").attr("d",p).style("fill",function(a,c){return b.color(c)}).each(b.eachSlice||$.noop);return function(a,b){var c=e,d=d3.layout.pie().sort(null)(a);m.selectAll("path").data(d).transition().duration(b).attrTween("d",
function(a,b){var j=d3.interpolateObject(c[b],d[b]);return function(a){return p(j(a),b)}});e=d}}
function attachAllocationPie2(a,b){if(!window.w.hasSVG())return $.noop;var b=$.extend({},b||{}),c=$(a),d=c.width(),i=c.height(),h=Math.min(d,i)/2-(b.shadowPx||0),g=d3.svg.arc().startAngle(function(a){return a.startAngle}).endAngle(function(a){return a.endAngle}).innerRadius(0).outerRadius(h),p=d3.layout.pie().sort(null)(b.allocation),e=d3.select(c[0]).append("svg:svg").attr("width",d).attr("height",i).append("svg:g").attr("transform","translate("+d/2+","+i/2+")");e.selectAll("path").data(p).enter().append("svg:path").attr("d",
g).attr("class",function(a,b){return"legend-color-fill-"+(b+1)}).each(b.eachSlice||$.noop);return function(a,b){var c=p,d=d3.layout.pie().sort(null)(a);e.selectAll("path").data(d).transition().duration(b).attrTween("d",function(a,b){var f=d3.interpolateObject(c[b],d[b]);return function(a){return g(f(a),b)}});p=d}}
function attachGrowingBar(a,b){if(!window.w.hasSVG())return{reset:$.noop,draw:$.noop};var c=$(a),d=b.data,i=d.length,h=c.width(),g=c.height(),p=b.subtext?24:15,e=(h-30*i)/(i+1),m=d3.scale.linear().domain([0,b.maxValue]).range([0,g-22.5-p]),j=d3.select(c[0]).append("svg:svg").attr("width",h).attr("height",g).append("svg:g").attr("transform","scale(1,-1) translate(0,-"+g+")");j.selectAll("line").data(d).enter().append("svg:line").attr("x1",function(a,b){return(b+1)*e+30*b}).attr("y1",22.5).attr("x2",
function(a,b){return(b+1)*(e+30)}).attr("y2",22.5).style("stroke","#999").style("stroke-width","1px");j.selectAll("rect").data(d).enter().append("svg:rect").attr("x",function(a,b){return(b+1)*e+30*b+5}).attr("y",22.5).attr("width",20).attr("height",m).style("fill",function(a,c){return b.color(c)});var n=j.append("svg:g").attr("transform","scale(1,-1)");n.selectAll("text").data(d).enter().append("svg:text").attr("text-anchor","middle").attr("x",function(a,b){return(b+1)*e+30*(b+0.5)}).style("font-size",
"9pt").style("fill","#333");if(b.subtext){var k=j.append("svg:g").attr("transform","scale(1,-1)");k.selectAll("text").data(d).enter().append("svg:text").attr("text-anchor","middle").attr("x",function(a,b){return(b+1)*e+30*(b+0.5)}).style("font-size","7pt").style("fill","#777")}if(b.axisLabels)for(var r=0;2>r;r++)j.append("svg:g").attr("transform","scale(1,-1)").selectAll("text").data(d).enter().append("svg:text").attr("text-anchor","middle").attr("x",function(a,b){return(b+1)*e+30*(b+0.5)}).attr("y",
10*r-11).style("font-size","7pt").style("fill","#333").text(function(a,c){return b.axisLabels[c][r]||""});return{reset:function(){j.selectAll("rect").data(d).attr("height",0);n.selectAll("text").text("");k.selectAll("text").text("")},draw:function(a,c){j.selectAll("rect").data(a).transition().duration(c).attr("height",m);n.selectAll("text").data(a).transition().delay(c).duration(0).text(b.format).attr("y",function(a){return-(22.5+m(a)+(b.subtext?14:5))});b.subtext&&k.selectAll("text").data(a).transition().delay(c).duration(0).text(function(a){return a?
b.subtext:""}).attr("y",function(a){return-(22.5+m(a)+5)})}}}
function attachRiskMeter(a,b){function c(a,b,c,d){var f="rotate("+a*l+")";u.transition().duration(c).ease(b).attrTween("transform",function(a,b,c){return d3.interpolateString(c,f)});d&&setTimeout(d,c)}function d(a,b){var c=-(e+b),d=a*f;return{x:c*Math.cos(d),y:c*Math.sin(d)}}if(!window.w.hasSVG())return $.noop;var b=b||{},i=!1!==b.showNumbers,h=b.scaling||1,g=225*h,p=125*h,e=100*h,m=108*h,j=110*h,n=d3.range(0,11),k=1.5*Math.PI,r=Math.PI,l=r*(180/Math.PI),f=r/(n.length-1),g=d3.select(a).append("svg:svg").attr("width",
g).attr("height",p).append("svg:g").attr("transform","translate("+g/2+","+(p-10*h)+")");g.selectAll("path").data([0,2,4,6,8]).enter().append("svg:path").style("fill",function(a){return d3.hsl(120-15*a,(90+a)/100,(34+3.5*a)/100).rgb().toString()}).attr("d",d3.svg.arc().startAngle(function(a){return k+a*f}).endAngle(function(a){return k+(a+2)*f}).innerRadius(e).outerRadius((m+j)/2));g.append("svg:path").style("fill","#444").attr("d",d3.svg.arc().startAngle(k).endAngle(k+r).innerRadius(m).outerRadius(j));
i&&g.selectAll("text").data([0,2,4,6,8,10]).enter().append("svg:text").attr("x",function(a){return d(a,-20*h-2).x}).attr("y",function(a){return d(a,-20*h-2).y+2*h+1}).style("text-anchor","middle").text(function(a){return a});var s=-6/l,q=g.append("svg:line").attr("x1",0).attr("y1",0).attr("x2",-e+35*h).attr("y2",0).style("stroke","#999").style("stroke-width","2px").style("stroke-dasharray","2,1").style("display","none"),u=g.append("svg:line").attr("id","needle").attr("transform","rotate("+s*l+")").attr("x1",
0).attr("y1",0).attr("x2",-e+35*h).attr("y2",0).style("stroke","#444").style("stroke-width","2px");g.append("svg:circle").attr("r",4*h).style("fill","#444").style("stroke","#444").style("stroke-width","2px");g.selectAll(".ticks").data(n).enter().append("svg:line").style("stroke","#444").style("shape-rendering",function(a){return a%10?"auto":"crispEdges"}).attr("x1",function(a){return-e+10/(1+a%2)*h}).attr("x2",-j).attr("transform",function(a){return"rotate("+a*f*(180/Math.PI)+")"});return function(a,
b){c(a,"elastic",1E3);null!=b&&q.attr("transform","rotate("+b*l+")").style("display","");0.025>=Math.abs(a-s)&&c(a+0.016,"sin",200,function(){c(a-0.016,"sin",250,function(){c(a,"linear",1E3/3)})});s=a}}
function attachProjectionChart(a,b,c,d,i,h){function g(a,b){function c(a){return C?a.transition().duration(D):a}var d=d3.scale.linear().domain([0,h*a]).ticks(10).pop();o.domain([0,d]);$(F.node()).data("update")();$(G.node()).data("update")();var f=function(a){return a.p01/d},g=function(a){return a.p20/d},e=function(a){return a.pMode/d},i=function(a){return a.p50/d},n=function(a){return Math.min(1,a.p80/d)},q=function(a){return Math.min(1,a.p95/d)},s=function(a,b){return 1-a.pdf20/a.pdfMode*(1-b/j/
1.5)},A=function(a,b){return b/j/1.5},v=function(a,b){return 1-a.pdf50/a.pdfMode*(1-b/j/1.5)},x=function(a,b){var c=1-a.pdf80/a.pdfMode*(1-b/j/1.5);if(a.p80<=d)return c;var f=(d-a.p50)/(a.p80-a.p50);return f*c+(1-f)*(1-a.pdf50/a.pdfMode*(1-b/j/1.5))},B=function(a,b){if(a.p95<=d)return 1;var c=(d-a.p80)/(a.p95-a.p80);return 1*c+(1-c)*(1-a.pdf80/a.pdfMode*(1-b/j/1.5))};if(z){var C=!0;z.data(b);c(z.select(":nth-child(1)")).attr("offset",f);c(z.select(":nth-child(2)")).attr("offset",g).attr("stop-opacity",
s);c(z.select(":nth-child(3)")).attr("offset",e).attr("stop-opacity",A);c(z.select(":nth-child(4)")).attr("offset",i).attr("stop-opacity",v);c(z.select(":nth-child(5)")).attr("offset",n).attr("stop-opacity",x);c(z.select(":nth-child(6)")).attr("offset",q).attr("stop-opacity",B)}else z=S.selectAll("[id]").data(b).enter().append("svg:linearGradient").attr("id",function(a,b){return M+b}).attr("x2",0).attr("y2",1).each(function(a,b){var c=d3.select(this);c.append("svg:stop").attr("offset",f).attr("stop-opacity",
1).attr("stop-color","#fff");c.append("svg:stop").attr("offset",g).attr("stop-opacity",s(a,b)).attr("stop-color","#fff");c.append("svg:stop").attr("offset",e).attr("stop-opacity",b/j/1.5).attr("stop-color","#fff");c.append("svg:stop").attr("offset",i).attr("stop-opacity",v(a,b)).attr("stop-color","#fff");c.append("svg:stop").attr("offset",n).attr("stop-opacity",x(a,b)).attr("stop-color","#fff");c.append("svg:stop").attr("offset",q).attr("stop-opacity",B(a,b)).attr("stop-color","#fff");N.append("svg:rect").style("fill",
"url(#"+(M+b)+")").attr("x",y(b)-2).attr("y",l).attr("width",3).attr("height",u)});c(t.style("display","")).attr("height",o(a));c(R.style("display","")).attr("y",o(a)).attr("height",k-r-o(a));c(T.text(w.assetsAmount(a))).attr("y",-o(a)+4);m.data("amount",a).data("amounts",b);p(+H.attr("x1"),!0)}function p(a,b){function c(a){return b?a.transition().duration(D):a}0<=a||(a=y(12*i),b=!1);var d=Math.round(Math.min(j,Math.max(1,y.invert(a)))),g=Math.round(y(d)),e=m.data("amount"),h=m.data("amounts"),k=
h[d].p01,t=h[d].p50,n=o(e),p=o(k),k=o(t);c(A).attr("transform","translate("+g+","+(l-9)+")");c(H).attr("x1",g).attr("x2",g);c(U).style("display","none").attr("d","M"+(g-2)+" "+n+"h4V"+p+"h-4Z");c(V).attr("cx",g+0.5).attr("cy",k);W.text(w.assetsAmount(t));X.text(w.formatNum(100*(Math.pow(t/e,12/d)-1),2));Y.text(Math.round(h[d].loss));$.each([v,E],function(a,b){var c=b.node(),d=c.parentNode;d.removeChild(c);d.appendChild(c)});d=v.node().getBoundingClientRect().width+10;e=E.node().getBoundingClientRect().width+
10;k=Math.round(k+10);n=Math.round(n-(O+4));h=f+q-g<d+10;t=g+(h?-d-3:4);g+=h?-e-3:4;Z.attr("width",d);aa.attr("width",e);h&&b&&(x.attr("transform",x.attr("transform").replace(/translate.*?,/,"translate("+t+",")),I.attr("d",I.attr("d").replace(/M.*? /,"M"+(d-4)+" ")));c(x).attr("transform","translate("+t+","+k+")");c(I).attr("d",h?"M"+(d-4)+" 0h-8l12 -7Z":"M4 0h8l-12 -7Z");c(J).attr("transform","translate("+g+","+n+")")}function e(a,c,d){for(var f=Array(j+1),h=0;h<=j;h++){var e=projectPerf(c,b,a,h,
d),i=getCumulativeParameters(c,b,a,h,d),k=i[0],i=i[1],t=Math.exp(k-i*i);f[h]={p01:a*e.p01,p20:a*e.p20,pMode:a*t,p50:a*e.p50,p80:a*e.p80,p95:a*e.p95,loss:e.loss,pdf20:logNormalPdf(k,i,e.p20),pdfMode:logNormalPdf(k,i,t),pdf50:logNormalPdf(k,i,e.p50),pdf80:logNormalPdf(k,i,e.p80)}}g(a,f)}if(!window.w.hasSVG())return dataStub;var m=$(a),j=12*d,n=m.width(),k=m.height(),r=5,l=42,f=54,s=n-f-3*j,q=n-f-s,u=k-r-l,y=d3.scale.linear().domain([0,j]).range([f,f+q]),o=d3.scale.linear().domain([0,c*h]).range([l,
l+u]),D=500,a=d3.select(a).insert("svg:svg").attr("width",n).attr("height",k).append("svg:g").attr("transform","scale(1,-1) translate(0,-"+k+")"),t=a.append("svg:rect").attr("class","loss").attr("x",f).attr("y",l).attr("height",o(c)).attr("width",q).style("fill","#777").style("display","none"),R=a.append("svg:rect").attr("class","gain").attr("x",f).attr("y",o(c)).attr("height",k-r-o(c)).attr("width",q).style("fill","#080").style("display","none");a.append("svg:rect").attr("class","track").attr("x",
f-2).attr("y",l-10).attr("height",4).attr("width",q+4).attr("rx",2).attr("ry",2).attr("fill","#f2f2f2");(""+Math.random()).substring(2,8);var M="plan-perf-gradient-"+(""+Math.random()).substring(2,8)+"-",N=a.append("svg:g").attr("class","cloud"),S=N.append("svg:defs"),z,d=d3.scale.linear().domain([0,d]).ticks(d+1);a.append("svg:g").attr("class","x-labels").attr("transform","scale(1,-1)").attr("text-anchor","middle").style("fill","#777").style("font-size","8pt").selectAll("text").data(d).enter().append("svg:text").attr("x",
function(a){return y(12*a)}).attr("y",26-l).text(function(a){return a});a.append("svg:g").attr("class","x-lines").style("fill","#000").style("opacity",".06").selectAll("rect").data(d).enter().append("svg:rect").attr("x",function(a,b){return y(12*b)}).attr("y",l).attr("width",1).attr("height",u);a.append("svg:line").attr("class","x-ticks").attr("x1",f).attr("y1",l+2).attr("x2",f+q+1).attr("y2",l+2).style("stroke","#ddd").style("stroke-width","3").style("stroke-dasharray","0 9 1 8 1 8 1 8");a.append("svg:line").attr("class",
"x-ticks").attr("x1",f).attr("y1",l+4).attr("x2",f+q+1).attr("y2",l+4).style("stroke","#ddd").style("stroke-width","2").style("stroke-dashoffset","18").style("stroke-dasharray","1 35");var F=a.append("svg:g").style("shape-rendering","crispEdges").style("stroke","#000").style("opacity",".06");$(F.node()).data("update",function(){var a=F.selectAll("line").data(o.ticks(10)).attr("y1",o).attr("y2",o);a.enter().append("svg:line").attr("x1",f).attr("x2",f+q).attr("y1",o).attr("y2",o);a.exit().remove()}).data("update")();
var G=a.append("svg:g").attr("transform","scale(1,-1)").style("fill","#777").style("font-size","8pt");$(G.node()).data("update",function(){var a=G.selectAll("text").data(o.ticks(10)).attr("y",function(a){return-o(a)+4}).text(function(a){return w.assetsAmount(a)});a.enter().append("svg:text").attr("x",f+q+10).attr("y",function(a){return-o(a)+4}).text(function(a){return w.assetsAmount(a)});a.exit().remove()}).data("update")();d=a.append("svg:g").attr("transform","scale(1,-1)").attr("class","labels").style("fill",
"black").style("font-size","8pt");d.append("svg:text").style("font-size","9pt").style("text-anchor","middle").attr("x",f+q/2).attr("y",-2).text("Investment Duration (years)");var T=d.append("svg:text").attr("text-anchor","end").attr("x",f-6).attr("y",-o(c)+4).style("fill","#333").text(w.assetsAmount(c)),c=a.append("svg:g").attr("class","data"),H=c.append("svg:line").style("stroke","#000").style("stroke-width","1").style("stroke-dasharray","1").style("shape-rendering","crispEdges").attr("x1",-5).attr("y1",
l-2).attr("x2",-5).attr("y2",l+u),U=c.append("svg:path").style("stroke","#b33").style("stroke-width","1").style("fill","none").style("shape-rendering","crispEdges"),V=c.append("svg:circle").attr("cx",-5).attr("r",3).style("stroke","#000").style("stroke-width","1").style("fill","#fff").style("shape-rendering","geometricPrecision"),x=c.append("svg:g").attr("transform","translate(-100,0)"),J=c.append("svg:g").attr("transform","translate(-100,0)"),O=16,Z=x.append("svg:rect").attr("height",32).attr("rx",
4).attr("ry",4).style("fill","#000").style("opacity",".7").style("stroke","none"),aa=J.append("svg:rect").attr("height",O).attr("rx",4).attr("ry",4).style("fill","#000").style("opacity",".7").style("stroke","none"),I=x.append("svg:path").style("fill","#000").style("opacity",".7").style("stroke","none");x.append("svg:text").attr("transform","scale(1,-1)").attr("x",5).attr("y",-20).attr("fill","#fff").style("font-size","7pt").style("font-weight","bold").text("Median Outcome");var v=x.append("svg:text").attr("transform",
"scale(1,-1)").attr("x",5).attr("y",-6).attr("fill","#fff").style("font-size","7.5pt"),W=v.append("svg:tspan").style("font-size","9pt"),X=v.append("svg:tspan").attr("dx",7);v.append("svg:tspan").text("%");v.append("svg:tspan").attr("dx",2).text("/");v.append("svg:tspan").attr("dx",2).text("year");var E=J.append("svg:text").attr("transform","scale(1,-1)").attr("x",5).attr("y",-5).attr("fill","#fff").style("font-size","7pt").style("font-weight","bold"),Y=E.append("svg:tspan");E.append("svg:tspan").text("% Chance of Loss");
var c=a.append("svg:g").attr("class","key").attr("transform","translate("+(n-68-10.5)+","+(l+(u-112)/2)+")").style("shape-rendering","crispEdges"),B=c.append("svg:defs"),d="plan-perf-gradient-"+(""+Math.random()).substring(2,8),P="plan-perf-gradient-"+(""+Math.random()).substring(2,8),Q=B.append("svg:linearGradient").attr("id",d).attr("x2",0).attr("y2",1);Q.append("svg:stop").attr("offset",0).attr("stop-color","#fff");Q.append("svg:stop").attr("offset",1).attr("stop-color","#080");B=B.append("svg:linearGradient").attr("id",
P).attr("x2",0).attr("y2",1);B.append("svg:stop").attr("offset",0).attr("stop-color","#fff");B.append("svg:stop").attr("offset",1).attr("stop-color","#777");c.append("svg:rect").attr("width",6).attr("height",40).attr("x",35).attr("y",27).style("stroke","none").style("fill","url(#"+d+")");c.append("svg:rect").attr("width",6).attr("height",40).attr("x",29).attr("y",27).style("stroke","none").style("fill","url(#"+P+")");c.append("svg:line").attr("x1",14).attr("y1",95).attr("x2",54).attr("y2",95).style("stroke",
"#ddd").style("stroke-width","1");c=c.append("svg:g").attr("transform","scale(1,-1)").style("font-size","7pt").style("fill","#333");c.append("svg:text").attr("x",35).attr("y",-99).style("fill","#888").style("text-anchor","middle").text("Key");c.append("svg:text").attr("x",35).attr("y",-18).style("text-anchor","middle").text("Less").append("svg:tspan").attr("x",35).attr("dy",10).text("Likely");c.append("svg:text").attr("x",35).attr("y",-82).style("text-anchor","middle").text("More").append("svg:tspan").attr("x",
35).attr("dy",10).text("Likely");var A=a.append("svg:g").attr("transform","translate(-25,"+(l-9)+")").attr("class","slider").style("cursor","ew-resize"),C=A.append("svg:defs").append("svg:linearGradient"),K="plan-perf-gradient-"+(""+Math.random()).substring(2,8);C.attr("id",K).attr("x2",0).attr("y2",1);C.append("svg:stop").attr("offset",0).attr("stop-color","#c8cbce");C.append("svg:stop").attr("offset",1).attr("stop-color","#f5f7f9");var L=A.append("svg:path").attr("d","M5.5 5.5a5,5 0 0,0 0,-10h-10a5,5 0 0,0 0,10Z").style("stroke",
"#000").style("stroke-width",".5").style("fill","url(#"+K+")");A.append("svg:line").attr("x1",-3).attr("x2",5).attr("y1",1).attr("y2",1).style("stroke","#999").style("stroke-width","4").style("stroke-dasharray","1").style("shape-rendering","crispEdges");A.append("svg:line").attr("x1",-4).attr("x2",4).attr("y1",2).attr("y2",2).style("stroke","#fff").style("stroke-width","4").style("stroke-dasharray","1").style("shape-rendering","crispEdges");A.append("svg:rect").attr("x",-3).attr("width",7).attr("height",
u+9).style("stroke","none").style("fill","#000").style("opacity","0");$(L.node()).hover(function(){C.select("stop").attr("stop-color","#d8dbde")},function(){C.select("stop").attr("stop-color","#c8cbce")});m.mousedown(function(a){a.preventDefault();if(a.target.parentNode===A.node()){L.style("fill","#ddd");m.find("text").andSelf().css("cursor","ew-resize");var b=a.pageX-H.node().getBoundingClientRect().left,c=function(a){a=Math.min(n-s,Math.max(f,a.pageX-b-m[0].getBoundingClientRect().left));p(a)},
d=function(){L.style("fill","url(#"+K+")");m.find("text").andSelf().css("cursor","default");$(this).unbind("mousemove",c).unbind("mouseup",d)};$("body").mousemove(c).mouseup(d)}});m.data("update",e);return e}
function attachHistoricalChart(a,b,c,d,i,h){function g(a,c,d){var e=Math.max(h*d,Math.max.apply(Math,a),Math.max.apply(Math,c)),e=d3.scale.linear().domain([i*d,1.1*e]).ticks(10),g=e.pop();f.domain([e[0],g]);$(s.node()).data("update")();$(q.node()).data("update")();o.data([a]);c=c||[[b]];y.data([c]);$.each([o,y],function(){this.transition().duration(500).attr("d",D)});u.text(w.assetsAmount(d)).attr("y",-f(d)+4)}var p=d-c;if(!window.w.hasSVG())return dataStub;var e=$(a),m=12*p,j=e.width(),n=e.height(),
k=j-54-76,r=n-5-42,l=d3.scale.linear().domain([0,m]).range([54,54+k]),f=d3.scale.linear().range([42,42+r]),a=d3.select(a).insert("svg:svg").attr("width",j).attr("height",n).append("svg:g").attr("transform","scale(1,-1) translate(0,-"+n+")"),d=d3.scale.linear().domain([c,d]);a.append("svg:g").attr("class","x-labels").attr("transform","scale(1,-1)").attr("text-anchor","middle").style("fill","#777").style("font-size","8pt").selectAll("text").data(d.ticks(p/2)).enter().append("svg:text").attr("x",function(a){return l(12*
(a-c))}).attr("y",-16).text(function(a){return"'"+(10>a%100?"0"+a%100:a%100)});a.append("svg:g").attr("class","x-lines").style("fill","#000").style("opacity",".06").selectAll("rect").data(d.ticks(p+1)).enter().append("svg:rect").attr("x",function(a,b){return l(12*b)}).attr("y",42).attr("width",1).attr("height",r);a.append("svg:line").attr("class","x-ticks").attr("x1",54).attr("y1",44).attr("x2",54+k+1).attr("y2",44).style("stroke","#ddd").style("stroke-width","3").style("stroke-dasharray","0 7 1 6 1 6 1 6");
a.append("svg:line").attr("class","x-ticks").attr("x1",54).attr("y1",46).attr("x2",54+k+1).attr("y2",46).style("stroke","#ddd").style("stroke-width","2").style("stroke-dashoffset","14").style("stroke-dasharray","1 27");var s=a.append("svg:g").style("shape-rendering","crispEdges").style("stroke","#000").style("opacity",".06");$(s.node()).data("update",function(){var a=s.selectAll("line").data(f.ticks(10)).attr("y1",f).attr("y2",f);a.enter().append("svg:line").attr("x1",54).attr("x2",54+k).attr("y1",
f).attr("y2",f);a.exit().remove()}).data("update")();var q=a.append("svg:g").attr("transform","scale(1,-1)").style("fill","#777").style("font-size","8pt");$(q.node()).data("update",function(){var a=q.selectAll("text").data(f.ticks(10)).attr("y",function(a){return-f(a)+4}).text(function(a){return w.assetsAmount(a)});a.enter().append("svg:text").attr("x",54+k+10).attr("y",function(a){return-f(a)+4}).text(function(a){return w.assetsAmount(a)});a.exit().remove()}).data("update")();var u=a.append("svg:g").attr("transform",
"scale(1,-1)").attr("class","labels").style("fill","black").style("font-size","8pt").append("svg:text").attr("text-anchor","end").attr("x",48).attr("y",-f(b)+4).style("fill","#333").text(w.assetsAmount(b)),y=a.append("svg:g").attr("class","benchmark").append("svg:path"),o=a.append("svg:g").append("svg:path"),D=d3.svg.line().x(function(a,b){return l(b)}).y(function(a){return f(a)});e.data("update",g);return g};
