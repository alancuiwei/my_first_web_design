var currentOverlay=null;function startInputSection(){$("div#inputs .general .input-group").click(function(e){expandInputs(e.currentTarget.id);});$("div#inputs .general .input-group input").focus(function(e){var c=$(e.currentTarget).closest(".input-group");expandInputs(c.attr("id"));});$("div#inputs .inputs-block").keydown(function(e){if(e.keyCode==27&&!smartasset.inputs.isforced){closeOverlay();}});}var lastIndicatorTop=null;function openInput(id){if(currentOverlay!=null){$("div#inputs #overlay-"+currentOverlay).slideUp(function(){currentOverlay=null;expandInputs(id);});}else{expandInputs(id);}}function showInputs(id){if(id==null||id==""){return;}var beforeShow=$("div#inputs #overlay-"+id+" .inputs-block").attr("onBeforeShow");if(beforeShow!=null&&beforeShow!=""){eval(beforeShow);}if(smartasset.inputs.isforced){$("div#inputs #overlay-"+id+" .inputs-block .input-buttons .cancel").hide();}else{$("div#inputs #overlay-"+id+" .inputs-block .input-buttons .cancel").show();}var afterShow=$("div#inputs #overlay-"+id+" .inputs-block").attr("onAfterShow");$("div#inputs #main-inputs").css("display","none");$("div#inputs #overlay-"+id).slideDown(function(){if(afterShow!=null&&afterShow!=""){eval(afterShow);lastIndicatorTop=$("div#indicator").position().top;showIndicator($("div#inputs #overlay-"+id+" h2").position().top,300);}});currentOverlay=id;}function expandInputs(id){if(id==null||id==""){return;}var beforeShow=$("div#inputs #overlay-"+id+" .inputs-block").attr("onBeforeShow");if(beforeShow!=null&&beforeShow!=""){eval(beforeShow);}if(smartasset.inputs.isforced){$("div#inputs #overlay-"+id+" .inputs-block .input-buttons .cancel").hide();}else{$("div#inputs #overlay-"+id+" .inputs-block .input-buttons .cancel").show();}var afterShow=$("div#inputs #overlay-"+id+" .inputs-block").attr("onAfterShow");$("div#inputs #main-inputs").slideUp();$("div#inputs #overlay-"+id).slideDown(function(){if(afterShow!=null&&afterShow!=""){eval(afterShow);lastIndicatorTop=$("div#indicator").position().top;showIndicator($("div#inputs #overlay-"+id+" h2").position().top-3,300);}else{lastIndicatorTop=$("div#indicator").position().top;showIndicator($("div#inputs #overlay-"+id+" h2").position().top-3,300);}});currentOverlay=id;}function inputTrackFieldChanges(field){$("#"+field).focus(function(){var p=smartasset.data.get("last-input-popup");var v=$(this).val();$(this).attr("old-value",v);eventTrack("Popup Field Focus",{popup:p,field:field,old_value:v},"["+v+"] "+field);});}function closeOverlayOnly(){if(currentOverlay!=null){$("div#inputs #overlay-"+currentOverlay).slideUp();}currentOverlay=null;}function closeOverlayTrackCancel(inputType){eventTrack("Inputs Cancel",{input:inputType},"Cancelled: "+inputType);closeOverlay();}function closeOverlay(){if(currentOverlay!=null){$("div#inputs #overlay-"+currentOverlay).slideUp();$("div#inputs #main-inputs").slideDown(function(){if(lastIndicatorTop!=null&&lastIndicatorTop>20){showIndicator(lastIndicatorTop,300);}else{if(firstInput!=null&&firstInput!=""){showIndicator($("#inputs-"+firstInput));}else{showIndicator(0,300);}}lastIndicatorTop=null;});}currentOverlay=null;}function showLoadingButton(i){i.removeClass("btn-success").html("<img src='"+urlBase+"/files/images/other/loadingg.gif'/>");}function hideLoadingButton(i){}function showIndicator(o,d){}function showInputTip(id){}function hideInputTips(){}function coverInteraction(){$(".main-body .page-interaction .interaction-overlay").css("display","block");$(".main-body .page-interaction .interaction-content").addClass("faded");$("#interaction-overlay").html("Updating values...");}function openAdvancedInputs(){showLoading();eventTrack("Advanced Inputs",{page:smartasset.data.get("page_key")},"page: "+smartasset.data.get("page_key"));$.ajax({url:"/ajax/render/advanced",success:showAdvancedInputs,});}function showAdvancedInputs(data){hideLoading();$("#popup-overlay").show();$("#popup-window .head .inner span").html("Advanced Settings");$("#popup-window .scroller").html(data);$("#popup-window").show();}function setSkippedLogin(){eventTrack("Skipped Login",{skippedLogin:"true"},"User Skipped Login.");$.getJSON("/ajax/tools/set",{key:"ud-skipped-login",value:"1"},function(){refreshPage();});}function startLoginClickMonitor(){$(document).on("mouseup",loginMouseUpHandler);$(document).on("keyup",loginKeyUpHandler);}function loginMouseUpHandler(e){var container=$("#login-form");if(container.has(e.target).length===0){loginPageDismiss();}}function loginKeyUpHandler(e){if(e.keyCode==27){loginPageDismiss();}if(e.keyCode==13){if(e.target.id.match(/.*login-field/i)){userLogin(e.target);}else{if(e.target.id.match(/.*create-field/i)){userRegister(e.target);}else{if(e.target.id.match(/.*forgot-field/i)){userForgotPassword(e.target);}}}}}function loginPageShowHeader(sectionIdentifier){$("#login-header #login-form .login-container").hide();$("#login-header").show();$("#login-header #login-form").show();$("div#link-box").addClass("active");$(sectionIdentifier).show();$(sectionIdentifier+" input").first().focus();startLoginClickMonitor();}function resetLoginDefaultSection(){$("#login-form .login-container").hide();$("#login-form #main-login").show();}function loginPageShowSection(e,sectionIdentifer){var parent=getParentObject(e);console.log("PARENT: "+parent);if(parent=="#overlay-inputs-login"){$(parent+" .login-back-button").show();$(parent+" #pwdconfirm-button").hide();}$(parent+" .login-container").hide();$(parent+" "+sectionIdentifer).show();$(parent+" "+sectionIdentifer+" input").first().focus();}function dismissLoginEvent(e){if(e.id=="pwdconfirm-button"){loginPageDismiss();refreshPage();}}function loginPageDismiss(){$("#login-header #login-form").hide();$("div#link-box").removeClass("active");$("#login-header").hide();$(document).off("mouseup",loginMouseUpHandler);$(document).off("keyup",loginKeyUpHandler);}function loginPageResetInputs(){$("#login-form .input-field").attr("value","");}function loginPageRemoveErrors(e){var parent=getParentObject(e);$(parent+" #login-form .input-field").removeClass("error");$(parent+" #login-form .validation-message").css("display","none");}function loginGetEmailPassword(parent,section){var data=new Object();data.email=$(parent+" #login-form #email"+section+"-field").val();data.password=$(parent+" #login-form #password"+section+"-field").val();return data;}function getParentObject(e){var x=$(e).closest("#login-header");if(x!=null&&x.length>0){return"#login-header";}x=$(e).closest("#login-popup");if(x!=null&&x.length>0){return"#login-popup";}x=$(e).closest("#second-login-space");if(x!=null&&x.length>0){return"#second-login-space";}return"#overlay-inputs-login";}function userLogin(e){var parent=getParentObject(e);loginPageRemoveErrors(e);var data=loginGetEmailPassword(parent,"login");var email=data.email;var password=data.password;$(parent+" #login-field-button").attr("disabled","disabled");$(parent+" #next-loading").css("visibility","visible");eventTrack("Login",{email:email},"email / "+email);$.getJSON(urlBase+"/ajax/tools/login",{email:email,pwd:password},function(data){$(parent+" #next-loading").css("visibility","hidden");$(parent+" #login-field-button").removeAttr("disabled");if(data!=null){if(data.status=="nok"){if(data.message.match(/Email address .* was not found in our database/i)){eventTrack("Login Error",{email:email},"email not found / "+email);$(parent+" #login-form #emaillogin-field").addClass("error");$(parent+" #login-form #email-validation").html("Email not found.");$(parent+" #login-form #email-validation").css("display","block");}else{if(data.message.match(/.*That does not seem to be the correct password..*/i)){eventTrack("Login Error",{email:email},"bad password / "+email);$(parent+" #login-form #passwordlogin-field").addClass("error");$(parent+" #login-form #password-validation").html("Incorrect password.");$(parent+" #login-form #password-validation").css("display","block");}else{if(data.message.match(/Email .* registered through Facebook. Please Log in with Facebook./i)){$(parent+" #login-form #email-validation").html("Email registered through Facebook. Please log in with Facebook.");$(parent+" #login-form #email-validation").css("display","block");}}}}else{eventTrack("Login",{email:email},"login success / "+email);refreshPage();}}});}function userRegister(e){var parent=getParentObject(e);loginPageRemoveErrors(e);var data=loginGetEmailPassword(parent,"create");var email=data.email;var password=data.password;if(!email.match(/\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b/i)){$(parent+" #login-form #emailcreate-field").addClass("error");$(parent+" #login-form #emailcreate-validation").html("That seems to be an invalid email.");$(parent+" #login-form #emailcreate-validation").css("display","block");return false;}$(parent+" #createact-loading").css("visibility","visible");eventTrack("Create Account",{email:email},"email / "+email);$.getJSON(urlBase+"/ajax/tools/signup",{email:email,pwd:password},function(data){$(parent+" #createact-loading").css("visibility","hidden");if(data!=null){if(data.status=="nok"){if(data.message.match(/.*Password must be at least 3 characters long.*/i)){eventTrack("Create Account Error",{email:email},"Password to short.");$(parent+" #login-form #passwordcreate-field").addClass("error");$(parent+" #login-form #passwordcreate-validation").html("Password is too short.");$(parent+" #login-form #passwordcreate-validation").css("display","block");}else{if(data.message.match(/Email .* is already registered. Please log in./i)){eventTrack("Create Account Error",{email:email},"Email already registered.");$(parent+" #login-form #emailcreate-field").addClass("error");$(parent+" #login-form #emailcreate-validation").html("Email is already registered.");$(parent+" #login-form #emailcreate-validation").css("display","block");}else{if(data.message.match(/Email .* registered through Facebook. Please Log in with Facebook./i)){$(parent+" #login-form #emailcreate-validation").html("Email registered through Facebook. Please log in with Facebook.");$(parent+" #login-form #emailcreate-validation").css("display","block");}}}}else{eventTrack("Create Account",{email:email},"create account success / "+email);if(parent=="#second-login-space"){eventTrack("Second Chance Signup Conversion",{email:email},"create account success / "+email);}refreshPage();}}else{clog("Something went wrong submitting /tools/signin");}});return true;}function userForgotPassword(e){var parent=getParentObject(e);loginPageRemoveErrors(e);var data=loginGetEmailPassword(parent,"forgot");var email=data.email;$(parent+" #resetact-loading").css("visibility","visible");$.getJSON(urlBase+"/ajax/tools/forgot",{email:email},function(data){$(parent+" #resetact-loading").css("visibility","hidden");if(data!=null){if(data.status=="nok"){if(data.message.match(/Email address .* was not found in our database/i)){$(parent+" #login-form #emailforgot-field").addClass("error");$(parent+" #login-form #emailforgot-validation").html("Email not found");$(parent+" #login-form #emailforgot-validation").css("display","block");}else{if(data.message.match(/Email .* registered through Facebook. Please Log in with Facebook./i)){$(parent+" #login-form #emailforgot-validation").html("Email registered through Facebook. Please log in with Facebook.");$(parent+" #login-form #emailforgot-validation").css("display","block");}}}else{loginPageShowSection(e," #login-form #passwordconf-login");}}else{clog("Something went wrong submitting /tools/signin");}});}function fbLogin(e){var parent=getParentObject(e);loginPageRemoveErrors(e);FB.login(function(response){if(response.authResponse){FB.api("/me",function(me){var email=me.email;var fbId=me.id;clog(me);eventTrack("Facebook Login",{email:email},"email / "+email);$.getJSON(urlBase+"/ajax/tools/fblogin",{email:email,facebookId:fbId},function(data){$(parent+" #createact-loading").css("visibility","hidden");if(data!=null){if(data.status=="nok"){if(data.message.match(/Use regular login./i)){if(parent=="#second-login-space"){$(parent+" .fb-validation").show().html("Email already registered. Please use log in.");}else{if($(e).html().match(/Sign Up with Facebook/i)){$(parent+" #login-form #emailcreate-validation").html("Email already registered. Please use log in.");$(parent+" #login-form #emailcreate-validation").css("display","block");}else{$(parent+" #login-form #email-validation").html("Email already registered. Please use log in.");$(parent+" #login-form #email-validation").css("display","block");}}}return false;}else{eventTrack("Facebook Login",{email:email},"Facebook login success / "+email);if(parent=="#second-login-space"){eventTrack("Second Chance Signup Conversion",{email:email},"Facebook login success / "+email);}refreshPage();return true;}}else{clog("Something went wrong submitting /tools/fblogin");return false;}});});}else{clog("Not logged in with Facebook");}},{scope:"email, user_about_me",});}function loginShowPopup(){$("#popup-overlay").show();$("#login-popup").show();}var headerQtip;var headerNotification;var browserTimer=null;function startHeaderSection(){createHeaderTip();createHeaderNotification();attachHeaderNotifications();attachBrowserEvents();}function createHeaderNotification(){headerNotification={position:{my:"center right",at:"center left",viewport:$(window),adjust:{method:"",resize:true,y:0,x:2,},},content:{text:"This is the notification",},show:{event:"",ready:false,},hide:{event:"click",},style:{classes:"ui-tooltip-light ui-tooltip-rounded header-notifications",tip:{corner:true,width:5,height:10,offset:0,}}};}function createHeaderTip(){headerQtip={position:{my:"top right",at:"bottom right",viewport:$(window),effect:false,adjust:{method:"flip",resize:true,y:2,x:-2,},},content:{ajax:{url:urlBase+"/ajax/render/popup/email",loading:false,once:false,},text:"&nbsp;",},show:{event:"mouseover",ready:false,},hide:{event:"",},events:{show:function(event,api){var e=api.elements.target[0];$(e).addClass("highlight");setOverlay($(e));},visible:function(){},hide:function(event,api){$("#linkbox img").removeClass("highlight");hideOverlay();}},style:{classes:"ui-tooltip-light ui-tooltip-rounded header-popup",tip:{mimic:"top center",corner:true,width:24,height:12,offset:30,}}};}function attachHeaderTips(){console.log("BASE: "+urlBase);$("#hdr-icon-save").qtip($.extend({},headerQtip,{content:{ajax:{url:urlBase+"/ajax/render/popup/email",once:false,loading:false,},text:"&nbsp;",},}));}function attachHeaderNotifications(){$("#header-email").qtip($.extend({},headerNotification,{content:{text:"<div class='inner'>Start here</div>",},}));}function showBrowser(){if($("#browser-popup").css("display")=="block"){closeBrowserPopup();return;}var p=$("#browser span");p.addClass("active");var o=p.position();$("#browser-popup").css("top",(o.top+p.outerHeight()-2)+"px");$("#browser-popup").css("left",o.left+"px");$("#browser-popup").css("display","block");setOverlay(p);}function attachBrowserEvents(){$("#browser-popup").mouseleave(startBrowserLeaveTimer);$("#browser-popup").mouseenter(stopBrowserTimer);}function stopBrowserTimer(){if(browserTimer!=null){clearTimeout(browserTimer);}}function startBrowserLeaveTimer(){browserTimer=setTimeout("closeBrowserPopup();",200);}function closeBrowserPopup(){hideOverlay();$("#browser span").removeClass("active");$("#browser-popup").css("display","none");}var buttonQtip;var buttonNotification;function startButtonSection(){createButtonTip();attachButtonTips();}function createButtonTip(){buttonQtip={position:{my:"bottom center",at:"top center",viewport:$(window),adjust:{method:"shift flip",resize:true,y:-2,x:0,},},content:{ajax:{url:urlBase+"/ajax/render/popup/email",loading:false,once:false,},text:"&nbsp;",},show:{event:"mouseover",ready:false,},hide:{delay:300,event:"unfocus mouseleave",fixed:true,},events:{show:function(event,api){var e=api.elements.target[0].id;clog("E: "+e);$("#"+e).addClass("highlight");},visible:function(){},hide:function(event,api){}},style:{classes:"ui-tooltip-light ui-tooltip-rounded button-popup",tip:{mimic:"center",corner:true,width:24,height:12,offset:0,}}};}function attachButtonTips(){$("#button-next").qtip($.extend({},buttonQtip,{content:{ajax:{url:urlBase+"/ajax/render/popup/next",once:false,loading:false,},text:"&nbsp;",},}));}var BreadcrumbQtip;var BreadcrumbNotification;function startBreadcrumbSection(){}function createBreadcrumbTip(){BreadcrumbQtip={position:{my:"top center",at:"bottom center",viewport:$(window),adjust:{method:"shift flip",resize:true,y:0,x:0,},},content:{ajax:{url:urlBase+"/ajax/render/popup/email",loading:false,once:false,},text:"&nbsp;",},show:{event:"mouseover",ready:false,},hide:{delay:100,event:"unfocus mouseleave",fixed:true,},events:{show:function(event,api){var e=api.elements.target[0].id;console.log("E: "+e);$("#"+e).addClass("highlight");},visible:function(){},hide:function(event,api){$("#breadcrumbs .crumbs a").removeClass("highlight");}},style:{classes:"ui-tooltip-light ui-tooltip-rounded button-popup breadcrumbs-popup",tip:{mimic:"top center",corner:true,width:24,height:12,offset:0,}}};}function attachBreadcrumbTips(){$("#breadcrumb-understand-affordability").qtip($.extend({},BreadcrumbQtip,{content:{ajax:{url:urlBase+"/ajax/render/popup/next",once:false,loading:false,},text:"&nbsp;",},}));}
